####START####d9bcfaa4ae43
Merge changes I27335d47,I54cd86d2 into sc-v2-dev am: 5f3fb9bbfb am: 5b750311c5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302843

Change-Id: I14ae95ee62021577740669a8f35c902d18b96d0d

####END####
####START####603bda15e85c
Prevent NPE when dropping app icon to split

Fix: 194154810
Test: drop to split won't trow NPE.
Change-Id: Ie3a6e9a606206cc1c5c26da131551616e29d03da

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/SplitScreenController.java

####START####314687f810eb
Merge "Fix a potential NPE when allocating space for compressed apex" into sc-dev am: 607cadc918

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15328970

Change-Id: I191fead109858ebf38cff2cb11aa698ffdf92e4a

####END####
####START####86d3bbb4cf06
Merge "ActivityManagerService: add new lmkd kill reason" into sc-dev am: c0ee8e009b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15327974

Change-Id: I94abcbe61fed5f473a5c0499649737f71278c61e

####END####
####START####607cadc918bb
Merge "Fix a potential NPE when allocating space for compressed apex" into sc-dev
####END####
####START####5b750311c505
Merge changes I27335d47,I54cd86d2 into sc-v2-dev am: 5f3fb9bbfb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302843

Change-Id: I5a13ab81fe11b0bda05cc4d1054ef1b78af0860c

####END####
####START####c0ee8e009bb3
Merge "ActivityManagerService: add new lmkd kill reason" into sc-dev
####END####
####START####d316cc49aeb4
profcollect: Add verbose logging for ota status updates

Test: presubmit
Bug: 178561556
Change-Id: I4cd6b9bdb15fec4e115fefbef69c0c1e687d2392

####END####
services/profcollect/src/com/android/server/profcollect/ProfcollectForwardingService.java

####START####5f3fb9bbfb16
Merge changes I27335d47,I54cd86d2 into sc-v2-dev

* changes:
  Split activity organizer in WM Extensions
  Add base container classes for reference Jetpack organizer

####END####
####START####9dd4bc8bf435
Add hasRunningActivity in TaskFragmentInfo

... for TaskFragmentOrganizer to finish adjacent Activities
altogether.

Test: presubmit
Bug: 189386466
Change-Id: I1fddd9c6708bc9eabec3186433f5ccb34a1e6c2c

####END####
core/java/android/window/TaskFragmentInfo.java
services/core/java/com/android/server/wm/ActivityRecord.java
services/core/java/com/android/server/wm/TaskFragment.java

####START####7943597405ec
Merge "Update TV input list upon package state changes in Kids profile" into sc-dev am: a93719505c am: 98baf0a456

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330816

Change-Id: I2e72c9aeedc36c505311c4a049835bafc7f258c1

####END####
####START####d19233b32050
Merge "Update TV input list upon package state changes in Kids profile" into sc-dev am: a93719505c am: 7a3826d55a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330816

Change-Id: If26eadca65ae0dc5ea9bc21fad30f200456943d9

####END####
####START####7769bbdaaac5
RESTRICT AUTOMERGE Restart recognition when failing to deliver event

If the client does not know that recognition is not running due to a
recognition event not having been delivered, we should attempt to
restart it.

Bug: 193579626
Test: Manual verification of the scenario described in the bug.


Change-Id: I4fc3b3e8defed59a900fd156273e9e695a322b0c

####END####
services/core/java/com/android/server/soundtrigger_middleware/SoundTriggerMiddlewarePermission.java
services/core/java/com/android/server/soundtrigger_middleware/SoundTriggerMiddlewareValidation.java

####START####8c67051b9797
Do not preload recents activity if it will be visible

Before, even if the launcher was not launched, RecentsAnimation would
start the activity in background as invisible. It would cause issue
because ensureVisibility would make it visible because there is no
opaque activity on top, while that may not be collected in any app
transition.

Now, in case the recents activity should be visible, we ignore the
 preload recents activity.

Bug: 193565751
Test: pass failed launcher test
Change-Id: I93f5a716177bcbf69f5e4d5915826bd9f61f53a4

####END####
services/core/java/com/android/server/wm/RecentsAnimation.java
services/core/java/com/android/server/wm/Task.java
services/core/java/com/android/server/wm/Transition.java

####START####98baf0a456bc
Merge "Update TV input list upon package state changes in Kids profile" into sc-dev am: a93719505c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330816

Change-Id: I6250c29ad2ac89cf003edb0b8912f377bb845be3

####END####
####START####9f88d45330a1
Merge "Update TV input list upon package state changes in Kids profile" into sc-dev am: a93719505c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330816

Change-Id: I28e71bc6ca24978d86082e25f7892f4673f39517

####END####
####START####a93719505c2a
Merge "Update TV input list upon package state changes in Kids profile" into sc-dev
####END####
####START####4593d929fed8
Keep the native mdns daemon alive for pre-S application

Roll back the behavior changes by checking the target SDK to ensure that
there are no compatibility issues with the pre-S application.
If the target SDK of the application <S, NsdManager will actively send a
cmd to start the native daemon, and NsdService will keep the daemon
until the last client with the target SDK <S disconnects.

Test: atest NsdManagerTest NsdServiceTest
Bug: 191844585
Change-Id: Ie93d5d585e126fe220ae865bbc7274f21a925984

####END####
core/java/android/net/nsd/NsdManager.java
services/core/java/com/android/server/NsdService.java

####START####06fa43aff8dc
More descriptive error message

Make the error message of package verification more descriptive
to help debugging.

Before the change, the error message is:
"Package Verification Result".
After the change, the error message will be like:
"some error message".

* Add VerificationParams.mErrorMessage to remember the error
  message as well as the error code.
* All changes to mRet/mErrorMessage must be via setReturnCode().

Bug: 181092466
Test: atest StagedInstallTest
Test: atest GtsSecurityHostTestCases
Test: atest CtsAtomicInstallTestCases
Test: atest GkiInstallTest
Change-Id: I3e0135e69cf6e745b0ccb7cbae3c9b40ef556c1e

####END####
services/core/java/com/android/server/pm/PackageManagerService.java

####START####2f0edbf85608
Keep the native mdns daemon alive for pre-S application

Roll back the behavior changes by checking the target SDK to ensure that
there are no compatibility issues with the pre-S application.
If the target SDK of the application <S, NsdManager will actively send a
cmd to start the native daemon, and NsdService will keep the daemon
until the last client with the target SDK <S disconnects.

Test: atest NsdManagerTest NsdServiceTest
Bug: 191844585
Change-Id: Ie93d5d585e126fe220ae865bbc7274f21a925984

####END####
core/java/android/net/nsd/NsdManager.java
services/core/java/com/android/server/NsdService.java

####START####ef2636a43a5d
Logging the caller uid state with AlarmScheduled atom

Test: statsd_testdrive 368
Test: atest FrameworksMockingServicesTests:AlarmManagerServiceTest
Test: atest CtsAlarmManagerTestCases
Test: atest CtsStatsdAtomHostTestCases:AlarmStatsTests

Bug: 194249875
Change-Id: Ia55306b3a4839aadc4bc2fdd873878b1a4e591fb

####END####
apex/jobscheduler/service/java/com/android/server/alarm/AlarmManagerService.java
apex/jobscheduler/service/java/com/android/server/alarm/MetricsHelper.java
services/tests/mockingservicestests/src/com/android/server/alarm/AlarmManagerServiceTest.java

####START####4883cbd81442
Merge "Apply package visibility to PACKAGE_DATA_CLEARED"
####END####
####START####735fe40581af
Merge "Add hidden ATM method to use in TaskFragmentOrganizer" into sc-v2-dev am: 74ab64c0c3 am: f91708631c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302841

Change-Id: I231cb2f078e47cc79ac29ddddc77a045b374acec

####END####
####START####f91708631c20
Merge "Add hidden ATM method to use in TaskFragmentOrganizer" into sc-v2-dev am: 74ab64c0c3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302841

Change-Id: I3b6faf1f1218839edf018ede00b090b5e6396cb5

####END####
####START####74ab64c0c308
Merge "Add hidden ATM method to use in TaskFragmentOrganizer" into sc-v2-dev
####END####
####START####41e510ce907e
Merge "FGS PendingIntent also use BroadcastOptions' temp allowlist duration." into sc-dev am: 5d5661a5fd am: 53a679b40e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15338525

Change-Id: I1a4833721e51220089152fef82236a1ec74ed377

####END####
####START####8d763151effb
Merge "Allow GenericDocument accept a String property longer than 20_000." into sc-dev am: 2873eb7d83 am: 4816863ed4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15306276

Change-Id: Ibe3c15a0592969e4dfd3cbeda67c1a5513a94047

####END####
####START####10e8a3557b27
Merge "FGS PendingIntent also use BroadcastOptions' temp allowlist duration." into sc-dev am: 5d5661a5fd am: dafe681b28

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15338525

Change-Id: I12e449bfabcc413dca3f67ba37d1f9c780ca8ffb

####END####
####START####e86335d09c4e
Merge "Allow GenericDocument accept a String property longer than 20_000." into sc-dev am: 2873eb7d83 am: 77a3a5242c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15306276

Change-Id: Ib0f48c370ee4856b4a5b460bd915eaf5ddb8861e

####END####
####START####53a679b40ef5
Merge "FGS PendingIntent also use BroadcastOptions' temp allowlist duration." into sc-dev am: 5d5661a5fd

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15338525

Change-Id: I5aeffd308ee599024b368e71dc7b282792a4732e

####END####
####START####bab1f92896f5
Merge "FGS PendingIntent also use BroadcastOptions' temp allowlist duration." into sc-dev am: 5d5661a5fd

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15338525

Change-Id: I732a45bc0c9ebd06510162bce168caf59d39cc16

####END####
####START####5d5661a5fd1d
Merge "FGS PendingIntent also use BroadcastOptions' temp allowlist duration." into sc-dev
####END####
####START####4816863ed441
Merge "Allow GenericDocument accept a String property longer than 20_000." into sc-dev am: 2873eb7d83

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15306276

Change-Id: I308181c64bba0eca474fe1b0831e50d47c667d13

####END####
####START####332a72f84e09
Merge "Allow GenericDocument accept a String property longer than 20_000." into sc-dev am: 2873eb7d83

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15306276

Change-Id: I48bc72375d71cd2ba7b050e406cb5ef6e8d9b6a5

####END####
####START####85986bf974ce
Split activity organizer in WM Extensions

Reference implementation for the client-side organizer
for side-by-side split activity UI.

Bug: 190433398
Bug: 190432728
Bug: 190433500
Bug: 190433972
Bug: 191163577
Bug: 191163638
Test: Manual, using the sample in WM Jetpack
Change-Id: I27335d47f4f544e2b9f63c5daaac9bd1c272a89f

####END####
core/java/android/app/ActivityThread.java
libs/WindowManager/Jetpack/src/androidx/window/extensions/SampleExtensionImpl.java
libs/WindowManager/Jetpack/src/androidx/window/extensions/organizer/SplitController.java
libs/WindowManager/Jetpack/src/androidx/window/extensions/organizer/SplitPresenter.java

####START####5b98c13db8f5
Merge "Perform the minimal dimension restrictions on leaf Task" into sc-v2-dev am: e5c6355a2e am: 10fd7ac895

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15280153

Change-Id: I986e7687214205c7063f619466a50a7c8d4629bb

####END####
####START####2873eb7d8391
Merge "Allow GenericDocument accept a String property longer than 20_000." into sc-dev
####END####
####START####10fd7ac895f6
Merge "Perform the minimal dimension restrictions on leaf Task" into sc-v2-dev am: e5c6355a2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15280153

Change-Id: Ic93b67efe7b06d9cee87f5006377d4227d825b6c

####END####
####START####e5c6355a2e5b
Merge "Perform the minimal dimension restrictions on leaf Task" into sc-v2-dev
####END####
####START####d2122dabfd19
Merge "Consolidate handling occluded initializing activity" into sc-v2-dev am: 2f119a90a5 am: 542b8289a0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340170

Change-Id: Ic75cbf604dd8153139662d441f419fd11c6328c6

####END####
####START####fcdb62892c32
Merge "Fix entering PiP transition in button navigation mode" into sc-dev am: 73ef335c0f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329896

Change-Id: I73c79942f7fc7fb44d881929121100aa768e53cd

####END####
####START####542b8289a08a
Merge "Consolidate handling occluded initializing activity" into sc-v2-dev am: 2f119a90a5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340170

Change-Id: I90d9acd975f3bcf77cae5e16b80dc43af023e5df

####END####
####START####73ef335c0f06
Merge "Fix entering PiP transition in button navigation mode" into sc-dev
####END####
####START####2f119a90a519
Merge "Consolidate handling occluded initializing activity" into sc-v2-dev
####END####
####START####801a4cfaf7ff
Merge "Set TRANSPORT_PRIMARY for VCN NetworkOffers and NetworkAgents" am: d92daec786 am: 697971f693 am: 2a1b0ab7cd am: 730d70a7f8

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1772025

Change-Id: Ic9a3f83b08568027b39aee1274e6553f9fea9654

####END####
####START####730d70a7f87b
Merge "Set TRANSPORT_PRIMARY for VCN NetworkOffers and NetworkAgents" am: d92daec786 am: 697971f693 am: 2a1b0ab7cd

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1772025

Change-Id: Id69848c8f94771414b18cab1536d29e0d43aab3d

####END####
####START####8d35744f98c1
Set TRANSPORT_PRIMARY for VCN NetworkOffers and NetworkAgents

This change sets TRANSPORT_PRIMARY for all NetworkScore objects passed
to ConnectivityService by the VCN. Without this patch, a VCN in safe
mode will never get any NetworkRequests, since the new Policy-based
NetworkRanker always prioritizes a existing satisfier of a network,
regardless of score. However, a higher-priority policy check ensures
that a TRANSPORT_PRIMARY request is used if it exists. This changes the
VCN to utilize that functionality.

Bug: 194122634
Test: atest FrameworksVcnTests
Original-Change: https://android-review.googlesource.com/1772025
Merged-In: I3a298a6c4c594c6e224f3f05764614802c00e9b0
Change-Id: I3a298a6c4c594c6e224f3f05764614802c00e9b0

####END####
services/core/java/com/android/server/vcn/Vcn.java
tests/vcn/java/com/android/server/vcn/VcnNetworkProviderTest.java

####START####2a1b0ab7cdff
Merge "Set TRANSPORT_PRIMARY for VCN NetworkOffers and NetworkAgents" am: d92daec786 am: 697971f693

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1772025

Change-Id: I3d678a8d3315f884bacfd3052218416604bf3e2c

####END####
####START####77362426e689
Merge "DropBoxManager: Fix doc build error" into sc-dev am: 019189c35a am: a945369393

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15341836

Change-Id: If40ca51dc06560536eb80bd02adebfaa43b55244

####END####
####START####082976799979
Merge "DropBoxManager: Fix doc build error" into sc-dev am: 019189c35a am: fd0f972819

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15341836

Change-Id: I965e36ca78d4cbc3c1b971012f2e3dad7a771b3f

####END####
####START####a945369393ae
Merge "DropBoxManager: Fix doc build error" into sc-dev am: 019189c35a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15341836

Change-Id: Iacd649005d0055d9b4b0dd087f0350b128314a9a

####END####
####START####09b6ee6bfd6a
Merge "DropBoxManager: Fix doc build error" into sc-dev am: 019189c35a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15341836

Change-Id: I3c184816f6d17a46eb5f0e67984e2c66e3fb791d

####END####
####START####300471913419
Merge "Revert "Revert "Add MATCH_ANY_USER flag when get valid package uid"""
####END####
####START####4b9b350245b6
Merge "Add flag MATCH_ANY_USER to query the package uid."
####END####
####START####52ba0c41f7c4
Merge "Revert "Revert "Add the checking of the package installed state"""
####END####
####START####074f760b88ea
Merge "Ensure calling user is the same as requested user." into sc-dev am: 34a952cf94 am: 4837c4f6d8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315615

Change-Id: I2f8ed60397529df91c25119e693d667aea7ed876

####END####
####START####c13531574d74
Merge "Ensure calling user is the same as requested user." into sc-dev am: 34a952cf94 am: 17794719c1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315615

Change-Id: I5acc5e01b46d943bb8ec72531fb79814a019a1b7

####END####
####START####d92daec78633
Merge "Set TRANSPORT_PRIMARY for VCN NetworkOffers and NetworkAgents"
####END####
####START####1241c9b6f20d
Revert "Add systrace tag for system property"

Revert "Add systrace tag for system property"

Revert "Adding system property tracing"

Revert submission 1403568-sysprop_trace

Reason for revert: makes property get/set non-reentrant
Reverted Changes:
I6f85f3f52:Add systrace tag for system property
Id2b93acb2:Adding system property tracing
Id78992d23:Add systrace tag for system property
I1ba9fc7bd:Add systrace tag for system property

Bug: 193050299
Change-Id: Iaf522b403e51abcf1d49804f35a184b4aa0d3209
Merged-In: Iaf522b403e51abcf1d49804f35a184b4aa0d3209
Test: build and boot a device
(cherry picked from commit 137d78bb672e3470e0d3bf8f6e65a9c6b872244d)

####END####
core/java/android/os/Trace.java

####START####019189c35a9f
Merge "DropBoxManager: Fix doc build error" into sc-dev
####END####
####START####2f7df33498f3
Merge "Ensure calling user is the same as requested user." into sc-dev am: 34a952cf94

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315615

Change-Id: I15463c214ccefad437ca172664c6a4cfb3eeebd5

####END####
####START####4837c4f6d8b1
Merge "Ensure calling user is the same as requested user." into sc-dev am: 34a952cf94

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315615

Change-Id: I6987764b74ff8ec32b0ad539893e6080ece1b030

####END####
####START####80dc45dd7ef4
UserTypeDetails - new enabled option

Adds an option for enabling/disabling a user type.

enabled=0 means disabled (otherwise it is enabled).
We use an int (rather than a boolean) to make it clear
what String value does what (1 vs. 0). If we had used a
boolean, we'd have to worry about true/True/TRUE/1/etc.;
with an int, the device will fail to boot if a non-int is
given.

If a user type is diabled, pre-existing users of that type
are unaffected. However, no new users of that type may be
created.

We do NOT simply use the maxAllowed option (setting it to 0
to simulate disalbing) for ease-of-use and to avoid
any potential complications with pre-created users.

Bug: 192577100
Bug: 142482943
Test: atest UserManagerServiceUserTypeTest
Change-Id: I3db25f3a48f9ba18a5dd3e74f6ac9b7638980497

####END####
services/core/java/com/android/server/pm/UserManagerService.java
services/core/java/com/android/server/pm/UserTypeDetails.java
services/core/java/com/android/server/pm/UserTypeFactory.java
services/tests/servicestests/src/com/android/server/pm/UserManagerServiceUserTypeTest.java

####START####34a952cf94bb
Merge "Ensure calling user is the same as requested user." into sc-dev
####END####
####START####95ccc85b7326
Merge "Fix concurrency of BatteryStats cleanup after user removal"
####END####
####START####4e637524d3aa
Merge "Use a different context when constructing an EdgeBackGestureHandler." into sc-dev am: 16ff25f5a7 am: ba15251dcd

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331207

Change-Id: Ia97c0cfc2abf56580cd65688384bceab1b62c8ea

####END####
####START####ba15251dcd67
Merge "Use a different context when constructing an EdgeBackGestureHandler." into sc-dev am: 16ff25f5a7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331207

Change-Id: I2eb4e379514ef2dff8bcded1dc02efc1d24e4395

####END####
####START####a90a2609824c
Merge "Add default implementation of TaskFragmentOrganizer" into sc-v2-dev am: f7224f068f am: b9d3f51aca

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15130807

Change-Id: Ibbb1bf28a1e43c8a658a20c6198e6e85d06af9e9

####END####
####START####f7f77d0e2bab
Merge "Use a different context when constructing an EdgeBackGestureHandler." into sc-dev am: 16ff25f5a7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331207

Change-Id: I2125e33aa25dc5e63b3cd036da68bde6e4aa8100

####END####
####START####1e2187cfea28
Add hidden ATM method to use in TaskFragmentOrganizer

getActivityBelow() is necessary to check if a split rule should
be applied for two activities on top of each other. This will
only report an activity that belongs to the same process.

When an application starts an activity B on top of an existing
activity A normally, there might be a split rule to put them
side-by-side. Organizer needs to know that activities A and B
are on top of each other to check, so it can either intercept
new activity launch or observe it after it happens and check the
rules then. The second approach results in a cleaner implementation,
but it also means that the organizer needs a reliable way to check
which activity is directly below the launched one. There is no
reliable source of info for that on the client side yet.

Bug: 190433398
Bug: 190433500
Test: Manual, using the reference implementation of the organizer.
Change-Id: I0e0116b1b0144e0ba4d19039d78c34495fbe4457

####END####
core/java/android/app/ActivityClient.java
services/core/java/com/android/server/wm/ActivityClientController.java
services/core/java/com/android/server/wm/ActivityRecord.java
services/core/java/com/android/server/wm/ActivityStarter.java
services/core/java/com/android/server/wm/ActivityTaskManagerService.java
services/core/java/com/android/server/wm/RootWindowContainer.java

####START####7ae2cae674c4
Add base container classes for reference Jetpack organizer

- TaskFragmentContainer corresponds to a TaskFragment record.
- SplitContainer has a record of two containers combined in a split
  with a given rule.

Bug: 190433398
Test: Manual, using the reference implementation.
Change-Id: I54cd86d2047aac2fa392189ed355760b1a32b6c4

####END####
libs/WindowManager/Jetpack/src/androidx/window/extensions/organizer/SplitContainer.java
libs/WindowManager/Jetpack/src/androidx/window/extensions/organizer/TaskFragmentContainer.java

####START####3e705d0f26a4
Merge "ZipUtils: use FileChannel#size" am: d0798d7117 am: f92201554a am: 0c60cbf8c0 am: 1cbe6e0d72

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1765685

Change-Id: Ifb16c4b8f6cffeca9c7fc6f1a906137a7c65572d

####END####
####START####b9d3f51aca1e
Merge "Add default implementation of TaskFragmentOrganizer" into sc-v2-dev am: f7224f068f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15130807

Change-Id: I1dcbaff4206f0e81a13d4113808430398a741f54

####END####
####START####8bab52a7837b
Merge "Camera: Improve logical camera RAW capture docs" into sc-dev am: 3e72b3e16f am: 53a6b7de48

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15114380

Change-Id: I0cce2ba453917c60ab427bd4c616b4d9da97bff2

####END####
####START####8d6f7c728023
Set TRANSPORT_PRIMARY for VCN NetworkOffers and NetworkAgents

This change sets TRANSPORT_PRIMARY for all NetworkScore objects passed
to ConnectivityService by the VCN. Without this patch, a VCN in safe
mode will never get any NetworkRequests, since the new Policy-based
NetworkRanker always prioritizes a existing satisfier of a network,
regardless of score. However, a higher-priority policy check ensures
that a TRANSPORT_PRIMARY request is used if it exists. This changes the
VCN to utilize that functionality.

Bug: 194122634
Test: atest FrameworksVcnTests
Change-Id: I3a298a6c4c594c6e224f3f05764614802c00e9b0

####END####
services/core/java/com/android/server/vcn/Vcn.java
tests/vcn/java/com/android/server/vcn/VcnNetworkProviderTest.java

####START####0d47a9da799f
Merge "Camera: Improve logical camera RAW capture docs" into sc-dev am: 3e72b3e16f am: 02a00aba16

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15114380

Change-Id: I458985283a4f93ed8aa62140f5ba31d63293713e

####END####
####START####1cbe6e0d7221
Merge "ZipUtils: use FileChannel#size" am: d0798d7117 am: f92201554a am: 0c60cbf8c0

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1765685

Change-Id: I0cdb5778b34957c712da6d0a4fd470c17df9da97

####END####
####START####16ff25f5a702
Merge "Use a different context when constructing an EdgeBackGestureHandler." into sc-dev
####END####
####START####63c90bb8dfa2
Fix BatteryStatsSamplingTimerTest#testEndSampleAndContinueWhenTimeOrCountDecreases

The test failure was caused by https://cs.android.com/android/_/android/platform/frameworks/base/+/7293dfca7cbedbc6eb2414f0c1e8f97c5f106f88
Bug: 180015146
Test: atest FrameworksCoreTests:BatteryStatsSamplingTimerTest#testEndSampleAndContinueWhenTimeOrCountDecreases

Change-Id: I79b5bd9526b6a0e7dad236b14548dca362ce1449

####END####
core/tests/coretests/src/com/android/internal/os/BatteryStatsSamplingTimerTest.java

####START####3662a98bbd5b
Fix enrollment preview surface leak

Bug: 189057897
Test: adb shell dumpsys SurfaceFlinger | grep -A 10 Offscreen | grep EnrollActivity
Change-Id: I9e11d0f1efc4428f2181370cb8be1b933aa5f548

####END####
core/java/android/hardware/face/FaceManager.java
services/core/java/com/android/server/biometrics/sensors/face/FaceService.java
services/core/java/com/android/server/biometrics/sensors/face/ServiceProvider.java
services/core/java/com/android/server/biometrics/sensors/face/aidl/BiometricTestSessionImpl.java
services/core/java/com/android/server/biometrics/sensors/face/aidl/FaceEnrollClient.java
services/core/java/com/android/server/biometrics/sensors/face/aidl/FaceProvider.java
services/core/java/com/android/server/biometrics/sensors/face/hidl/BiometricTestSessionImpl.java
services/core/java/com/android/server/biometrics/sensors/face/hidl/Face10.java
services/core/java/com/android/server/biometrics/sensors/face/hidl/FaceEnrollClient.java

####START####441843bdc369
Remove all biometrics if user is removed.

Test: Verified face & fingerprint get corresponding calls to delete
if a guest profile is removed.
Bug: 193926097

Change-Id: I50f3a02d7578907acfcb901e011939165bfd8534

####END####
services/core/java/com/android/server/locksettings/LockSettingsService.java

####START####174ce49b3440
Merge "Clean up previous DA organizer when registering" into sc-dev am: 2c4f6e1ae6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15333816

Change-Id: I9370fe66f4fca3ee2d620ef7d834b0e5c2d50e78

####END####
####START####f7224f068f78
Merge "Add default implementation of TaskFragmentOrganizer" into sc-v2-dev
####END####
####START####7f9dbc369618
Merge "Camera: Improve logical camera RAW capture docs" into sc-dev am: 3e72b3e16f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15114380

Change-Id: I7f0fdcec867aff22ad56f47a3c6aa44c2f96b5ec

####END####
####START####02a00aba160d
Merge "Camera: Improve logical camera RAW capture docs" into sc-dev am: 3e72b3e16f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15114380

Change-Id: I3fc9174671d3789fd6c3131a064742f2d3671d95

####END####
####START####0c60cbf8c00a
Merge "ZipUtils: use FileChannel#size" am: d0798d7117 am: f92201554a

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1765685

Change-Id: I07df9fab5a971cc8cc5a4029a5935845efce27b0

####END####
####START####2c4f6e1ae634
Merge "Clean up previous DA organizer when registering" into sc-dev
####END####
####START####3e72b3e16fd7
Merge "Camera: Improve logical camera RAW capture docs" into sc-dev
####END####
####START####bb07463bfb82
Move KEY_OEM_SETUP_VERSION to system provider

Bug: 172977193
Test: manual test
Change-Id: I93534ea01cb9a1b9bf53ecd84d4a9f61350a7500
(cherry picked from commit 013788079ca377165f76e7a8c95888fb06a72549)

####END####
core/java/android/provider/Settings.java
packages/SettingsProvider/src/android/provider/settings/validators/GlobalSettingsValidators.java
packages/SettingsProvider/test/src/android/provider/SettingsBackupTest.java

####START####45d3d840ba1f
Merge "Stop removing all APP_STANDBY_BUCKET_CHANGED messages." into sc-dev am: 5b6a2aff21 am: e6f790f8e0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331033

Change-Id: I39876ccabf982bb04b901a44416d76c6fa1f8b9c

####END####
####START####22503bcd4d06
Merge "[Provider Model] Sync solution from sc"
####END####
####START####972319003b61
Merge "Stop removing all APP_STANDBY_BUCKET_CHANGED messages." into sc-dev am: 5b6a2aff21

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331033

Change-Id: Id73767774382250f7e3e9089dd498c2adc72f627

####END####
####START####e6f790f8e00e
Merge "Stop removing all APP_STANDBY_BUCKET_CHANGED messages." into sc-dev am: 5b6a2aff21

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331033

Change-Id: I5f693a14d6801104c8a2aafbb0f38b5b6f45d72b

####END####
####START####34f676239d29
Merge "Use a different context when constructing an EdgeBackGestureHandler."
####END####
####START####201353591289
Merge "Fix entering PiP transition in button navigation mode" into sc-v2-dev am: e2a5a72266 am: 732ad85e3f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340838

Change-Id: I720d1b29df5ad8c2eb21236eb8c32cd804f9b492

####END####
####START####d0798d711767
Merge "ZipUtils: use FileChannel#size"
####END####
####START####5a7c74d3f45d
Merge "Simplify ResultCallbacks by not using WeakReference"
####END####
####START####33c3fcc67175
Fix entering PiP transition in button navigation mode

Included in this CL
- when there is no source rect hint, use a content overlay during the transition
- otherwise, take account the display cutout to offset/inset the source
  rect hint

Test with following variants when entering PiP in button nav
- from 0 / 90 / 270 rotation
- with or without source rect hint
- display cutout mode set to default or shortEdge

Video: http://recall/-/aaaaaabFQoRHlzixHdtY/cxk4vy8VenQPSv83vHEs22
Bug: 191310680
Test: manual, see the test cases listed and video above
Change-Id: Ie54a54de6e55397e25024373ea4e2855fde2d9f7
Merged-In: Ie54a54de6e55397e25024373ea4e2855fde2d9f7

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipAnimationController.java
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipTaskOrganizer.java
services/core/java/com/android/server/wm/DisplayContent.java
services/core/java/com/android/server/wm/PinnedTaskController.java
services/core/java/com/android/server/wm/Task.java

####START####5b6a2aff21db
Merge "Stop removing all APP_STANDBY_BUCKET_CHANGED messages." into sc-dev
####END####
####START####732ad85e3f2c
Merge "Fix entering PiP transition in button navigation mode" into sc-v2-dev am: e2a5a72266

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340838

Change-Id: I92256b1df8aad0174acc7d19edb64775ca4e9d83

####END####
####START####d4b32b130890
Merge "Revert "Launch admin policies settings screen if not possible to launch help page"" into sc-dev am: 277047bc1e am: c762b2dcf8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340583

Change-Id: I4d4222fb2cd43633e9cb73caeeed9bd17387fe54

####END####
####START####64f764370f98
Merge "Revert "Launch admin policies settings screen if not possible to launch help page"" into sc-dev am: 277047bc1e am: f235b1e8dc

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340583

Change-Id: Iafa1cbefa3a2991051f035e754ce8b43fd576d9c

####END####
####START####e2a5a7226656
Merge "Fix entering PiP transition in button navigation mode" into sc-v2-dev
####END####
####START####c762b2dcf820
Merge "Revert "Launch admin policies settings screen if not possible to launch help page"" into sc-dev am: 277047bc1e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340583

Change-Id: If33dab989f66aa6b94eed055f49c5771143746ee

####END####
####START####e37cf4686b74
Merge "Revert "Launch admin policies settings screen if not possible to launch help page"" into sc-dev am: 277047bc1e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15340583

Change-Id: I70e70f74d3cb7ccdf7a68f7ed55c4d29a417b4b7

####END####
####START####a00ce4e75f51
DropBoxManager: Fix doc build error

Test: make doc-comment-check-docs
Bug: 194230402
Change-Id: I38da2bbfbe7ed0a660274ec4d07e2b176a2a7542

####END####
core/java/android/os/DropBoxManager.java

####START####3a39bd35b6d8
Merge "6/n: Add support for additional coex cases" into sc-dev am: e086c96b2e am: 8d1c724b2f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330269

Change-Id: If4a7705a4830e84e4381892728cc9c51e2f93dd0

####END####
####START####f517ff656c33
Merge "6/n: Add support for additional coex cases" into sc-dev am: e086c96b2e am: d5470fa8d1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330269

Change-Id: I346d23e29c3d60486eb681d81a0d1aacccd6fbae

####END####
####START####ece4ef73939d
Fix concurrency of BatteryStats cleanup after user removal

Bug: 193742542
Bug: 180015146
Test: atest --rerun-until-failure 20 FrameworksCoreTests:BatteryStatsUserLifecycleTests#testNoCpuDataForRemovedUser

Change-Id: If45cbf0be6c29fc99771053c6a0ec34c60e293a8

####END####
core/java/com/android/internal/os/BatteryStatsImpl.java
core/tests/coretests/src/com/android/internal/os/BatteryStatsCpuTimesTest.java
core/tests/coretests/src/com/android/internal/os/BatteryStatsUserLifecycleTests.java
core/tests/coretests/src/com/android/internal/os/MockBatteryStatsImpl.java
services/core/java/com/android/server/am/BatteryExternalStatsWorker.java

####START####00d3ad743e7d
Fix some shell transitions bugs breaking splashscreen cts

Splashscreen CTS uses its own HOME activity that gets placed
on top of the normal launcher. Prevent the launcher's remote
transition from responding in that case by adding a component
filter to the TransitionFilter class.

Bug: 194112093
Test: atest SplashscreenTests
Change-Id: Iaf4572279b84953ca20abd7e34c64d7e19700b09

####END####
core/java/android/window/TransitionFilter.java
packages/SystemUI/shared/src/com/android/systemui/shared/system/RemoteTransitionCompat.java

####START####00471fb4c9ef
Accounting for image scaling when calculating color extraction

> Also caching display size instead of making RPC in every frame

Bug: 194232172
Test: Manual
Change-Id: I1b71a2316e7b8b7fde6190abd75be89330e2d051

####END####
packages/SystemUI/src/com/android/systemui/ImageWallpaper.java

####START####277047bc1e53
Merge "Revert "Launch admin policies settings screen if not possible to launch help page"" into sc-dev
####END####
####START####55ce56f40a2c
Merge "6/n: Add support for additional coex cases" into sc-dev am: e086c96b2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330269

Change-Id: I8b60143a8a086e2094406893240439a6f04e5f5c

####END####
####START####8d1c724b2fc0
Merge "6/n: Add support for additional coex cases" into sc-dev am: e086c96b2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15330269

Change-Id: I4df4655d4faafabbe87e4852dcc777e220afa82d

####END####
####START####e086c96b2edd
Merge "6/n: Add support for additional coex cases" into sc-dev
####END####
####START####e7f82da5955b
Add callstack back into trace for AccessibilityInteractionClient.

Test: adb shell cmd accessibility start-trace -t AccessibilityInteractionClient IAccessibilityInteractionConnectionCallback
Bug: 157601519, 194230052
Change-Id: Ieecb597637c80b3eb4baf2ba6405a2386f5f9785

####END####
core/java/android/view/accessibility/AccessibilityInteractionClient.java

####START####fdf7b58a43d7
Add a system API UpdateEngine to switch the slot back and forth

In some cases, the OTA update want to flip the slot to source
without cancelling the entire update. The functionality was
achieved by ResetStatus(). However ResetStatus() will clean up
the update progress and free up space to support virtual A/B.

Details in http://go/no-virtual-ab-switch-off

Test: build
Bug: 187321613
Change-Id: I2abcf8289f5fd573d2b55fa7004ab4dcd175252f

####END####
core/java/android/os/UpdateEngine.java

####START####11268f8b366c
Merge "Clean up previous DA organizer when registering" into sc-v2-dev am: fd370d0b40 am: 530c7ef63f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15339432

Change-Id: I6d8653cc5f911a2a2d70c9bb28537155ae1d6948

####END####
####START####7f788abaa53b
Merge "Ensure notification visibility on stopForeground(false)" into sc-dev am: 2591e466c1 am: fadfa6cc2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15288334

Change-Id: I41c475316cd833ba0a6b4ef5f577f540471414f6

####END####
####START####f5fdeb6e4d0c
Merge "5/n: Add support for initial coex cases" into sc-dev am: 30a9a9b5ec am: 06977e5bdc

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329699

Change-Id: I750ebee6fc9bca0de0ddcbc8c18418ba1cc163c5

####END####
####START####bd36cb996252
Merge "Ensure notification visibility on stopForeground(false)" into sc-dev am: 2591e466c1 am: 37bac5320b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15288334

Change-Id: I531ce3bb35ad0f037c0c45611a3833dc2444778f

####END####
####START####0f6ef1192185
Merge "5/n: Add support for initial coex cases" into sc-dev am: 30a9a9b5ec am: a022da385b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329699

Change-Id: I9fb77f685f6598fa3261f25d602f935b7ca78122

####END####
####START####530c7ef63ffb
Merge "Clean up previous DA organizer when registering" into sc-v2-dev am: fd370d0b40

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15339432

Change-Id: I91cf644a54935bf84e2be9cee4fbeba7686e2eff

####END####
####START####37bac5320b34
Merge "Ensure notification visibility on stopForeground(false)" into sc-dev am: 2591e466c1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15288334

Change-Id: I58e7c559452c7b671edc85a5e71c12595344e7ec

####END####
####START####a022da385bb2
Merge "5/n: Add support for initial coex cases" into sc-dev am: 30a9a9b5ec

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329699

Change-Id: I9750720a2b54bb8351f14c2fe01c6eaef50425b5

####END####
####START####807ad83df57f
Merge "Ensure notification visibility on stopForeground(false)" into sc-dev am: 2591e466c1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15288334

Change-Id: I22f9d2141fcc2d286cc8f1206752b27c7cdd1c52

####END####
####START####b3d1ab40ef5a
Merge "5/n: Add support for initial coex cases" into sc-dev am: 30a9a9b5ec

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329699

Change-Id: I53d0fe494e0f414d4977c8005dacf82a51921728

####END####
####START####2591e466c1d4
Merge "Ensure notification visibility on stopForeground(false)" into sc-dev
####END####
####START####74d6d5fde950
make non-organized tasks visible when their activity is made visible

This is necessary in a few cases (CTS) where a task is NOT organized but
had its visibility changed within its direct parent. An example of this
is if an alternate home leaf-task HB is started atop the normal home
leaf-task HA: these are both in the Home root-task HR, so there will be a
transition containing HA and HB where HA surface is hidden. If a standard task SA is
launched on top, then HB finishes, no transition will happen since neither home is
visible. When SA finishes, the transition contains HR rather than HA. Since home
leaf-tasks are NOT organized, HA won't be in the transition and thus its surface
wouldn't be shown. Just show is safe here since all other properties will have
already been reset by the original hiding-transition's finishTransaction (we can't
show in the finishTransaction because by then the activity doesn't hide until
surface placement).

Bug: 194112093
Test: atest SplashscreenTests
Change-Id: I885d688b3f505d33e04d9c2e4857928ada1c4fb0

####END####
services/core/java/com/android/server/wm/Transition.java

####START####cfabf151e5e4
Clean up previous DA organizer when registering

- There is no guarantee that binderDied() will come in for the old
  process before it tries to re-register. Instead, force clean up
  the existing organizer if another organizer is registered for the
  same feature
- Also unlink the death recipient when unregistering/cleaning up the
  organizer

Fixes: 190786551
Test: Kill SysUI and ensure it doesn't throw
Test: atest DisplayAreaTest
Change-Id: I1204818eefd96d2eb1fb6d195e186f36fd47efac
Merged-In: I1204818eefd96d2eb1fb6d195e186f36fd47efac

####END####
services/core/java/com/android/server/wm/DisplayAreaOrganizerController.java
services/tests/wmtests/src/com/android/server/wm/DisplayAreaTest.java

####START####fd370d0b400b
Merge "Clean up previous DA organizer when registering" into sc-v2-dev
####END####
####START####9e0cd05a4156
Merge "Use correct intent key in AbstractAccountAuthenticator JavaDoc."
####END####
####START####30a9a9b5ec04
Merge "5/n: Add support for initial coex cases" into sc-dev
####END####
####START####1cad82c3bc54
Use a different context when constructing an EdgeBackGestureHandler.

Fixes: 193758967
Test: atest SystemUITests

Change-Id: I7417ccd3899ffba05411ebb4e56c255f6ef09f54
Merged-In: I7417ccd3899ffba05411ebb4e56c255f6ef09f54

####END####
packages/SystemUI/src/com/android/systemui/Dependency.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarView.java
packages/SystemUI/src/com/android/systemui/navigationbar/gestural/EdgeBackGestureHandler.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarButtonTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTransitionsTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NavigationBarContextTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NearestTouchFrameTest.java

####START####85b5dee2f109
Reset messages when the keyguard isn't showing

- biometric error messages require a minimum amount of time
to be shown but aren't relevant once the device is unlocked,
so clear the keyguard indication messages once the keyguard
isn't showing anymore
- don't show any face errors for co-ex

Test: manual, atest SystemUITests
Fixes: 192981147
Change-Id: Ia11ffc740e5505aafb7f96635909bf7f5cd10341

####END####
packages/SystemUI/src/com/android/systemui/statusbar/KeyguardIndicationController.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardIndicationTextView.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/KeyguardIndicationControllerTest.java

####START####1626a96b585b
Merge "PiP: Allow customization of PiP minimum size." into sc-dev am: c312c6481b am: 9b550d2c36

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14077517

Change-Id: I03bd0ddb2472c66a59a43ec1c316405940bba524

####END####
####START####1ff459512bbc
Merge "PiP: Allow customization of PiP minimum size." into sc-dev am: c312c6481b am: d87deceb6e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14077517

Change-Id: Ia578db3b102826c6d41eeb69d056995eb7312b7e

####END####
####START####6118fbfe09b4
Merge "Stop processing jobs whose state hasn't changed."
####END####
####START####9b550d2c36ce
Merge "PiP: Allow customization of PiP minimum size." into sc-dev am: c312c6481b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14077517

Change-Id: I69aff8f023f206d42b9c09d593a880c6fa7b9b90

####END####
####START####09755b5477c7
Merge "PiP: Allow customization of PiP minimum size." into sc-dev am: c312c6481b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14077517

Change-Id: Ief4c4e03a5042e08e17d358f7f16380bcaacea1e

####END####
####START####ca704f4879b3
Merge "Introduce action affordability checking."
####END####
####START####1ce14dda7e86
Fix entering PiP transition in button navigation mode

Included in this CL
- when there is no source rect hint, use a content overlay during the transition
- otherwise, take account the display cutout to offset/inset the source
  rect hint

Test with following variants when entering PiP in button nav
- from 0 / 90 / 270 rotation
- with or without source rect hint
- display cutout mode set to default or shortEdge

Video: http://recall/-/aaaaaabFQoRHlzixHdtY/cxk4vy8VenQPSv83vHEs22
Bug: 191310680
Test: manual, see the test cases listed and video above
Change-Id: Ie54a54de6e55397e25024373ea4e2855fde2d9f7

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipAnimationController.java
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipTaskOrganizer.java
services/core/java/com/android/server/wm/DisplayContent.java
services/core/java/com/android/server/wm/PinnedTaskController.java
services/core/java/com/android/server/wm/Task.java

####START####c312c6481ba1
Merge "PiP: Allow customization of PiP minimum size." into sc-dev
####END####
####START####9cdcfd741a7f
Merge "Track active AttributionSources, and finish chains on death" into sc-dev am: a4d18e767a am: 4e897cb01f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312052

Change-Id: I336dd00509a58d0d8bf1eb7b8fd0c67d557a26fc

####END####
####START####9affacd3f8ce
6/n: Add support for additional coex cases

If UDFPS succeeds while face is scanning, send haptic+callbacks,
and cancel face auth.

Bug: 193089985
Test: atest CoexCoordinatorTest
Change-Id: Ia261ec35308c70f2c2efcadada41c6c155ec8650

####END####
services/core/java/com/android/server/biometrics/sensors/BiometricScheduler.java
services/core/java/com/android/server/biometrics/sensors/CoexCoordinator.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/CoexCoordinatorTest.java

####START####7778c2ea38b2
5/n: Add support for initial coex cases

1) Adds a way to enable/disable this. By default, this is disabled on
   top of tree (so this change should be a no-op. By default, tests
   enable the advanced behavior.
2) Adds a dump to "adb shell dumpsys biometric"

Bug: 193089985
Test: atest CoexCoordinatorTest
Test: atest com.android.server.biometrics
Test: adb shell dumpsys biometric (with and without secure setting)

Change-Id: I9fe553e9d4b78e34a20b9130f854143a355275bc

####END####
services/core/java/com/android/server/biometrics/BiometricService.java
services/core/java/com/android/server/biometrics/sensors/BiometricScheduler.java
services/core/java/com/android/server/biometrics/sensors/CoexCoordinator.java
services/core/java/com/android/server/biometrics/sensors/face/aidl/Sensor.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/Udfps.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintAuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintEnrollClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/Fingerprint21UdfpsMock.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/FingerprintAuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/FingerprintDetectClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/FingerprintEnrollClient.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/CoexCoordinatorTest.java

####START####63541f764a06
Merge "Track active AttributionSources, and finish chains on death" into sc-dev am: a4d18e767a am: ecd62ac657

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312052

Change-Id: Ib36fd65f60fcc4e1c497cb78483e330ab128817d

####END####
####START####4e897cb01f96
Merge "Track active AttributionSources, and finish chains on death" into sc-dev am: a4d18e767a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312052

Change-Id: Ia455d6dd5cd41c4ed98f798a31bad64182d464d7

####END####
####START####e5a8428a576c
Merge "Track active AttributionSources, and finish chains on death" into sc-dev am: a4d18e767a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312052

Change-Id: I5512e339bb1093325d11ea17c7a366686b4c3366

####END####
####START####bd268448fa2e
Merge "Enable specification of 5G network info and carrier configs for ONS changes"
####END####
####START####346be3887c91
Fix hidden EmptyShadeView

Fixes: 193897657
Test: validate that HUNs show
Test: validate that "no notifications" text shows
Change-Id: I2fcd5b2712a5f4a28a8913cd8d0e29f635530e96

####END####
packages/SystemUI/src/com/android/systemui/statusbar/notification/stack/StackScrollAlgorithm.java

####START####a4d18e767a90
Merge "Track active AttributionSources, and finish chains on death" into sc-dev
####END####
####START####7984edf5d454
Merge "adb shell pm remove-user --wait"
####END####
####START####27971da7fdb8
Stop processing jobs whose state hasn't changed.

Only process (check the status) of jobs that the controller says had a
state change. That way, we regularly only process a subset of jobs.

Bug: 138469672
Test: atest frameworks/base/services/tests/mockingservicestests/src/com/android/server/job
Test: atest frameworks/base/services/tests/servicestests/src/com/android/server/job
Test: atest CtsJobSchedulerTestCases
Change-Id: I866d358797e4745b8ab5b9d855c96ec6006985e0

####END####
apex/jobscheduler/framework/java/android/app/job/JobParameters.java
apex/jobscheduler/service/java/com/android/server/job/JobSchedulerService.java
apex/jobscheduler/service/java/com/android/server/job/StateChangedListener.java
apex/jobscheduler/service/java/com/android/server/job/controllers/BackgroundJobsController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/BatteryController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/ComponentController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/ConnectivityController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/ContentObserverController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/DeviceIdleJobsController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/IdleController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/QuotaController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/StorageController.java
apex/jobscheduler/service/java/com/android/server/job/controllers/TimeController.java
apex/jobscheduler/service/java/com/android/server/job/restrictions/ThermalStatusRestriction.java
services/tests/mockingservicestests/src/com/android/server/job/controllers/QuotaControllerTest.java

####START####ee8699e51e62
Introduce action affordability checking.

Allow clients to indicate that they want to be told about an app's
ability to afford specific actions. This allows clients to know when to
stop ongoing work/prevent further actions and when has the ability to
pay for intended actions.

Removing the BalanceChangeListener since clients won't be able to make
use of solvency/insolvency information (becoming solvent doesn't mean an
app can pay for an action and becoming insolvent only matters if the
cost of an action is greater than 0).

Bug: 158300259
Test: atest FrameworksServicesTests:AgentTest
Change-Id: I7a7bdde1d385991a8d4d35b89fc278fa3c4fe3e7

####END####
apex/jobscheduler/service/java/com/android/server/tare/Agent.java
apex/jobscheduler/service/java/com/android/server/tare/EconomyManagerInternal.java
apex/jobscheduler/service/java/com/android/server/tare/InternalResourceService.java
services/tests/servicestests/src/com/android/server/tare/AgentTest.java

####START####1ae18bb7168f
Merge "Temporarily disable wearable system services."
####END####
####START####a1b01afddb83
Merge "Add requested permissions to the package state hash."
####END####
####START####bc76f61f0da3
Merge "Remove CPU file updating code."
####END####
####START####c2d03889621b
Revert "Launch admin policies settings screen if not possible to launch help page"

This reverts commit 75077a17a4c583460b8ccc0acff4649c4a85d43c.

Reason for revert: DroidMonitor-triggered revert due to breakage https://android-build.googleplex.com/builds/quarterdeck?branch=git_sc-dev&target=errorprone&lkgb=7566424&lkbb=7566443&fkbb=7566443, bug b/194207719

Change-Id: I40603378f3e6f125639169176e21680980e2a93e

####END####
packages/SettingsLib/src/com/android/settingslib/enterprise/ActionDisabledByAdminControllerFactory.java
packages/SettingsLib/src/com/android/settingslib/enterprise/ActionDisabledLearnMoreButtonLauncher.java
packages/SettingsLib/src/com/android/settingslib/enterprise/ManagedDeviceActionDisabledByAdminController.java
packages/SettingsLib/tests/robotests/src/com/android/settingslib/enterprise/ManagedDeviceActionDisabledByAdminControllerTest.java

####START####bc237ba1634e
Remove @FastNative annotation from TextRunShaper

Bug: 194208524
Test: N/A
Change-Id: Ia504b61d7d021f47607a1a657ac60a716b46ff0e

####END####
graphics/java/android/graphics/text/TextRunShaper.java

####START####45c0aae079d6
Merge "Scale stack dump timeout with HW_TIMEOUT_MULTIPLIER." am: cf89aac24b am: 3c3fcf6865 am: 8ea2bd3c2e am: 02df88ff8c

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768622

Change-Id: Ica935ec382fd30ee63b1c7e1c5daf596fb4bf061

####END####
####START####d2baa3717161
Merge changes I31ddbed9,I702a2449 am: a730b44c86 am: e2d2a4be1f am: 50395a1268 am: 176206e5f3

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489240

Change-Id: Ifc099b79b056a6f26aad946428741f51547a7324

####END####
####START####c73ec3c2a1bc
HDMICEC: Add equals test for DeviceConfig am: 555aa8a7fd am: c6204b79fb am: 2a948644ad am: bea63474fa

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489239

Change-Id: I1a5f5551fd477d113f72349e18c9c13878e02c89

####END####
####START####283aa38efc35
Merge "Launch admin policies settings screen if not possible to launch help page" into sc-dev am: 144dab97be am: 8322262e0c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286676

Change-Id: I0f8b102200f0b98fd540a8cde2dc6a2f8f17acf1

####END####
####START####06e6eeb04f7f
Update orientation on rotation changes

The rotation can change without the phyiscal
orientation of the phone changing.

Test: manual, atest UdfpsControllerTest AuthControllerTest
SidefpsControllerTest
Fixes: 193975552

Change-Id: I621ea06984f17954e9be138e9e5669aeb3cfb3fe

####END####
packages/SystemUI/src/com/android/systemui/biometrics/AuthController.java
packages/SystemUI/src/com/android/systemui/biometrics/SidefpsController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/AuthControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/UdfpsControllerTest.java

####START####02df88ff8cb0
Merge "Scale stack dump timeout with HW_TIMEOUT_MULTIPLIER." am: cf89aac24b am: 3c3fcf6865 am: 8ea2bd3c2e

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768622

Change-Id: I53e8c14949999899d497cb7c86f369ca35057343

####END####
####START####176206e5f328
Merge changes I31ddbed9,I702a2449 am: a730b44c86 am: e2d2a4be1f am: 50395a1268

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489240

Change-Id: Idaf3b817edbbefffb94ac2eeb44ece13c861ee93

####END####
####START####bea63474faad
HDMICEC: Add equals test for DeviceConfig am: 555aa8a7fd am: c6204b79fb am: 2a948644ad

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489239

Change-Id: I97dacc4dacf5100047a6c79d48f5ce47740d10c8

####END####
####START####8ea2bd3c2e4c
Merge "Scale stack dump timeout with HW_TIMEOUT_MULTIPLIER." am: cf89aac24b am: 3c3fcf6865

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768622

Change-Id: Ic7d4f4ffd65cb05adc3225f90c083ea2aa01b354

####END####
####START####50395a126820
Merge changes I31ddbed9,I702a2449 am: a730b44c86 am: e2d2a4be1f

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489240

Change-Id: I5c5abbb066032b7599f66ffb73767b8ab33b9c57

####END####
####START####2a948644ad03
HDMICEC: Add equals test for DeviceConfig am: 555aa8a7fd am: c6204b79fb

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489239

Change-Id: I00131e803c63014416c69a55c3a0f1e4ab4b967f

####END####
####START####2e0b02becd04
Merge "Launch admin policies settings screen if not possible to launch help page" into sc-dev am: 144dab97be am: 1daa3f00c0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286676

Change-Id: Ie505280cfe837e2f6f8751e722f9dcc77d65731a

####END####
####START####fa4be31a96f4
Merge "Add bug link for androidx screenshot API TODO."
####END####
####START####674b160164da
Unify the mismatch in the byte order of the address.

Bluetooth address should check MSB for AddrType based on Spec.
(BT Core Spec v 5.2 | Vol 6, Part B, 1.3 DEVICE ADDRESS)
Bluetooth address meaning is not unified in the current Android framework layer.
Because of this, cannot register scanfilter with the intended address format.

Bug: 180466950
Test: manual
Tag: #compatibility
Change-Id: I59a1b5538e4f3fea77a98cba2aa46649fc32ac6b
Merged-In: I59a1b5538e4f3fea77a98cba2aa46649fc32ac6b

####END####
core/java/android/bluetooth/BluetoothAdapter.java

####START####cce24f573ba9
FGS PendingIntent also use BroadcastOptions' temp allowlist duration.

For FGS PendingIntent, if the BroadcastOptions parameter passed in PendingIntentRecord.send()
call has a non-zero temp allowlist duration, treat this duration the
same as the FGS PendingIntent's temp allowlist duration.

Previously only setExact() alarm's "broadcasts" are exempt from BG-FGS-start
restriction using BroadcastOptions. This CL exempts setExact() alarm's "FGS PendingIntent"
from BG-FGS-start restriction.

BYPASS_INCLUSIVE_LANGUAGE_REASON=Pre-existing API
Bug: 193011829
Test: b/193011829 POC app, with this fix,
ForegroundServiceStartNotAllowedException is not seen.

Change-Id: Ifb095a8bcc458ab27c9259ca4af4d759835f2e1c

####END####
services/core/java/com/android/server/am/PendingIntentRecord.java

####START####1daa3f00c07d
Merge "Launch admin policies settings screen if not possible to launch help page" into sc-dev am: 144dab97be

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286676

Change-Id: Ib75110c1e32f9fd4e6ea95cbb60186ba0ad940d6

####END####
####START####018d6bcbb65b
Merge "Test apexd behaves correctly when not in fs-checkpoint mode" into sc-dev am: b713ec62bb am: 1d508e5822

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302099

Change-Id: If3fc3715d1b336aa8475cc5a73fd52c10ed1c291

####END####
####START####7256f792f680
Merge "Revert "Add systrace tag for system property"" into sc-dev-plus-aosp am: bd811a080f am: 7a5beb3219

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15298117

Change-Id: Id1dc82002506babb33255d71e06967f1876315c9

####END####
####START####2c7e6ce26a04
Merge "Launch admin policies settings screen if not possible to launch help page" into sc-dev am: 144dab97be

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286676

Change-Id: Ibd0828cc25da8d5e3aecf878c8d9b2bd662555c6

####END####
####START####e6f79d9ea3d9
Merge "MidiService: synchronize mDeviceConnections" into sc-dev am: e65c02b278 am: d36d69ada6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15317991

Change-Id: I7d54cf96694e814aefaf17dc8cdcfe1c4b973530

####END####
####START####7989a89b5685
Merge "Test apexd behaves correctly when not in fs-checkpoint mode" into sc-dev am: b713ec62bb am: 7e0cbf4d28

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302099

Change-Id: I29f6106e32073af86d466a37450ae28c4b09632e

####END####
####START####144dab97beed
Merge "Launch admin policies settings screen if not possible to launch help page" into sc-dev
####END####
####START####c6204b79fb04
HDMICEC: Add equals test for DeviceConfig am: 555aa8a7fd

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489239

Change-Id: I4aceffebbeface4723bcb5409063053740c0fdce

####END####
####START####7e0cbf4d289d
Merge "Test apexd behaves correctly when not in fs-checkpoint mode" into sc-dev am: b713ec62bb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302099

Change-Id: I25a8ee1135352b2a5ccc201e7652011782a35991

####END####
####START####e807f57d9a75
Merge "Test apexd behaves correctly when not in fs-checkpoint mode" into sc-dev am: b713ec62bb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302099

Change-Id: I2edfb53a54d4d784296eb648be8d2cf29b542250

####END####
####START####ff28d4f74761
Merge "Clear binder calling identity before calling callback" into sc-dev am: 520eb40850

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302831

Change-Id: I912f086fd659eb078009776230ae659412d26302

####END####
####START####9b58e266affa
Merge "MidiService: synchronize mDeviceConnections" into sc-dev am: e65c02b278 am: 947827c67f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15317991

Change-Id: Id3420969efcbde71c3b94eac90ae197839f92291

####END####
####START####947827c67fd8
Merge "MidiService: synchronize mDeviceConnections" into sc-dev am: e65c02b278

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15317991

Change-Id: I96a6bd857d110aca0ecd82ea96d2e6c4aa318cc8

####END####
####START####918c8a99498e
Merge "MidiService: synchronize mDeviceConnections" into sc-dev am: e65c02b278

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15317991

Change-Id: I1d121f6bb49f16f38c8e1914f76401c1341a4d22

####END####
####START####9259249ff6f0
Merge "Change the doc to reflect the default status of preferential network service" into sc-dev am: c03fb15e29 am: 702f32505d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329706

Change-Id: I14aa7500e7ef40c8fe6705875a56f51780323a79

####END####
####START####57b380f4babb
Add display specific brightness configurations

Add brightness configuration to display state, within the persistentDataStore. The original brightness configurations remain under the name "mGlobalBrightnessConfigurations".
Expose methods to get and set brightness configurations specific to each display. Indexed by uniqueId of the physical display. Where necessary, the primary physical display device of the logical display is used when identifying this.

Bug: 181767734
Test: atest PersistentDataStoreTest BrightnessConfigurationTest BrightnessTest

Change-Id: Idaed53e8f4abe548784781c4fb610dbada46ab19

####END####
core/java/android/hardware/display/DisplayManager.java
core/java/android/hardware/display/DisplayManagerGlobal.java
services/core/java/com/android/server/display/DisplayDeviceRepository.java
services/core/java/com/android/server/display/DisplayManagerService.java
services/core/java/com/android/server/display/DisplayManagerShellCommand.java
services/core/java/com/android/server/display/LogicalDisplayMapper.java
services/core/java/com/android/server/display/PersistentDataStore.java
services/tests/servicestests/src/com/android/server/display/DisplayManagerServiceTest.java
services/tests/servicestests/src/com/android/server/display/PersistentDataStoreTest.java

####START####64172cbc5d4d
Hide RSSI next to single carrier name

If there's exactly one SIM, do not show the RSSI next to the name in
QSBH. Instead, show it with the other icons. If there's more than one
SIM, show each RSSI next to the carrier name, and not with the other
icons (not even in QQS).

Test: atest com.android.systemui.qs
Test: manual single sim
Bug: 187654917
Bug: 194178072
Change-Id: I8b80bb14b8f60872d44d5a92ddfa7c5903420874

####END####
packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeader.java
packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeaderController.java
packages/SystemUI/src/com/android/systemui/qs/carrier/QSCarrier.java
packages/SystemUI/src/com/android/systemui/qs/carrier/QSCarrierGroupController.java
packages/SystemUI/src/com/android/systemui/qs/dagger/QSFragmentModule.java
packages/SystemUI/src/com/android/systemui/qs/dagger/QSModule.java
packages/SystemUI/src/com/android/systemui/statusbar/dagger/StatusBarDependenciesModule.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusIconContainer.java
packages/SystemUI/tests/src/com/android/systemui/qs/carrier/QSCarrierGroupControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/qs/carrier/QSCarrierTest.java

####START####25811888dd83
Don't forward touches to udfps if notification panel is expanding

Test: manual
Fixes: 192755873
Change-Id: Id4dc631d1beada6b4bd9e684445317e931b2c848

####END####
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsKeyguardViewController.java

####START####682df9edbc96
Simplify ResultCallbacks by not using WeakReference

This is a follow up CL to my previous CL [1], which introduced
ResultCallbacks in a bit conservative way, that is, to always wrap
Completable.* with WeakReference in case the target app fails to
respond for some reasons.

Using WeakReference would make sense if otherwise we would put more
stress on the memory than holding WeakReference object itself.  In our
case the expected memory stress on extending lifetime of Completable.*
objects is still comparable with the memory cost of holding
WeakReference objects instead.  Let's remove WeakReference from
ResultCallbacks in favor of simplicity.

This change should be completely transparent to other layers since
there is no change in the semantics (except for the lifetime itself of
Completable.* object, which is technically observable with APIs such
as java.lang.ref.Cleaner).

 [1]: Ic65a95eb5d0fd56f505a02fd9083bcf6694b6734
      f87f75088899d0f7513132e0f397b0edbf373d71

Bug: 192412909
Test: atest -c CtsInputMethodTestCases
Change-Id: I43966494ccb4fceb8e7f8c60bd6ce3cc7fbfdd82

####END####
core/java/com/android/internal/inputmethod/ResultCallbacks.java

####START####b713ec62bb4c
Merge "Test apexd behaves correctly when not in fs-checkpoint mode" into sc-dev
####END####
####START####59c65885d235
Merge "Update maybe-batching logic."
####END####
####START####899e64490ae4
Merge "Change the doc to reflect the default status of preferential network service" into sc-dev am: c03fb15e29 am: 5dbbd226ae

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329706

Change-Id: I92c8d9682c53ad18ab97878c3bfe841ef4d621d5

####END####
####START####7a5beb321924
Merge "Revert "Add systrace tag for system property"" into sc-dev-plus-aosp am: bd811a080f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15298117

Change-Id: I084ca8e5ac09465ca7972846ed6c9bda83f090c7

####END####
####START####f7067b2477d9
Do not cache wildcard users (UserManager)

Bug: 186778818

PropertyInvalidatedCache queries that contain wildcard user IDs are no
longer cached.  Some simple multi-user tests show that no current
caches use wildcard user IDs, so the change has no effect on
performance.  The bypass() mechanism is used to avoid the cache when
necessary.

Test: atest
 * FrameworksServicesTests:UserManagerServiceCreateProfileTest
Change-Id: I68868b7f4142417d98b101504cb38c829b220e47

####END####
core/java/android/accounts/AccountManager.java
core/java/android/os/UserManager.java

####START####8d6900e01173
Do not cache wildcard users (PackageManager)

Bug: 186778818

PropertyInvalidatedCache queries that contain wildcard user IDs are no
longer cached.  Some simple multi-user tests show that no current
caches use wildcard user IDs, so the change has no effect on
performance.  The bypass() mechanism is used to avoid the cache when
necessary.

Test: atest
 * FrameworksServicesTests:UserManagerServiceCreateProfileTest

Change-Id: I092d1385cc254b3f595ae3d0322f77dbaf456b65

####END####
core/java/android/app/ApplicationPackageManager.java
core/java/android/content/pm/PackageManager.java

####START####520eb4085062
Merge "Clear binder calling identity before calling callback" into sc-dev
####END####
####START####9e223a8c9a93
Invoke insets animation callbacks when resizing system bars

This gives the app a chance to react to the animation of resizing system
bars.

Fix: 191269755
Test: atest InsetsAnimationControlImplTest InsetsControllerTest
            InsetsStateTest
Change-Id: Ibf47047c131867983064bef4e9ac011daf66ea18

####END####
core/java/android/view/InsetsAnimationControlCallbacks.java
core/java/android/view/InsetsAnimationControlImpl.java
core/java/android/view/InsetsAnimationThreadControlRunner.java
core/java/android/view/InsetsController.java
core/java/android/view/InsetsResizeAnimationRunner.java
core/java/android/view/InsetsState.java
core/java/android/view/ViewRootImpl.java
core/java/android/view/WindowInsetsAnimationController.java
core/tests/coretests/src/android/view/InsetsAnimationControlImplTest.java
core/tests/coretests/src/android/view/InsetsControllerTest.java
core/tests/coretests/src/android/view/InsetsStateTest.java
libs/WindowManager/Shell/src/com/android/wm/shell/startingsurface/TaskSnapshotWindow.java
packages/SystemUI/shared/src/com/android/systemui/shared/system/WindowManagerWrapper.java
services/core/java/com/android/server/wm/ActivityRecord.java
services/core/java/com/android/server/wm/InsetsPolicy.java
services/core/java/com/android/server/wm/RecentsAnimationController.java
services/core/java/com/android/server/wm/TaskSnapshotController.java
services/core/java/com/android/server/wm/WindowState.java

####START####c7b59dbebf69
Apply setAlwaysOnTop when recycling Task.

Moved the logic to startActivityUnchecked() to apply it for both a new
task and a recycling task.

Bug: 193837989
Test: follow the reproduce steps in b/193837989.
Change-Id: I1bee13a88da1fe2cf3af2cb117071a758095fb9f

####END####
services/core/java/com/android/server/wm/ActivityStarter.java

####START####e27a7f93c801
Merge "Add lock or sleep power button behavior."
####END####
####START####4a66d8e54282
Changing DEVICE_NR_CAPABILITY type and renaming getMaxActiveInternetData

DEVICE_NR_CAPABILITY_*: Using int array instead of bitmask
Rename getMaxActiveInternetData and remove SystemAPI
Rename getMaxActivePacketSwitchedVoiceCalls

Bug: 180419672
Test: atest CtsTelephonyTestCases:android.telephony.cts.TelephonyManagerTest#testGetPhoneCapabilityAndVerify
atest CellularNetworkValidatorTest
atest PhoneCapabilityTest
atest PhoneSwitcherTest
atest TelephonyRegistryTest

Change-Id: Ia394537ec57900a410b283ddffdcead017e6d9c6
Merged-In: Ia394537ec57900a410b283ddffdcead017e6d9c6

####END####
telephony/java/android/telephony/PhoneCapability.java

####START####cf89aac24ba9
Merge "Scale stack dump timeout with HW_TIMEOUT_MULTIPLIER."
####END####
####START####70c7a4148a81
Clean up previous DA organizer when registering

- There is no guarantee that binderDied() will come in for the old
  process before it tries to re-register. Instead, force clean up
  the existing organizer if another organizer is registered for the
  same feature
- Also unlink the death recipient when unregistering/cleaning up the
  organizer

Bug: 190786551
Test: Kill SysUI and ensure it doesn't throw
Change-Id: I1204818eefd96d2eb1fb6d195e186f36fd47efac

####END####
services/core/java/com/android/server/wm/DisplayAreaOrganizerController.java
services/tests/wmtests/src/com/android/server/wm/DisplayAreaTest.java

####START####8e0bf818e5bc
Temporarily disable wearable system services.

Wearable system service code has been disabled due to compile issues. We
need to temporarily disable these services in system server to unblock
system bring up.

Bug: 191419780
Bug: 191493915
Fix: 191493915
Fix: 191419780

Test: class not found error is gone.
Change-Id: I177f04ff1ff5b43c242367d9741e829550ed8e36

####END####
services/java/com/android/server/SystemServer.java

####START####d69660fc6ad4
Add bug link for androidx screenshot API TODO.

Bug: 194183980
Test: TH
Change-Id: I02a88ceb5ce079886f7aae9b688598c85e25a2c0

####END####
graphics/java/android/graphics/HardwareRenderer.java

####START####e65c02b278f6
Merge "MidiService: synchronize mDeviceConnections" into sc-dev
####END####
####START####c45b4a0a536d
Merge "Change the doc to reflect the default status of preferential network service" into sc-dev am: c03fb15e29

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329706

Change-Id: Id3afae60a414750b735d171cc679122418465f99

####END####
####START####5dbbd226aec2
Merge "Change the doc to reflect the default status of preferential network service" into sc-dev am: c03fb15e29

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329706

Change-Id: Ia7c2fe2f8b3eaba0bf1445d4edfb29e237770ca0

####END####
####START####a730b44c86df
Merge changes I31ddbed9,I702a2449

* changes:
  HDMICEC: Add equals test for HdmiCecMessage
  HDMICEC: Add equals test for DeviceConfig

####END####
####START####e7ba3801fdf2
Consolidate handling occluded initializing activity

Since task fragment is introduced, forAllOccludedActivities may
not work as expected because individual task fragment has its
own occluding relationship. Without correcting that, it may
remove active starting window.

Though the method can be fixed by iterating task fragment with
bounds check, it increases the complexity to maintain another
partial logic of EnsureActivitiesVisibleHelper.

So it may be more efficient and simpler by reusing the core of
visibility update to call cancelInitializing. And because the
visibility update is common to be called when resuming, it can
provide the same effect. In this way, the long loop executed
every time (cancelInitializingActivities) when resuming any
activity is also eliminated.

Also
- Remove mStartingWindowState because the nullity of mStartingData
  has already indicated that.
- Move transferSplashScreenIfNeeded to removeStartingWindow because
  when calling removeStartingWindowAnimation, it should do the
  removal directly.

Bug: 189385912
Bug: 194193397
Test: ActivityRecordTests#testTransferStartingWindowFromFinishingActivity
      RootTaskTests#testClearUnknownAppVisibilityBehindFullscreenActivity
Change-Id: I4621c2215807e713d9142acc7814786de50d88c4

####END####
services/core/java/com/android/server/wm/ActivityRecord.java
services/core/java/com/android/server/wm/EnsureActivitiesVisibleHelper.java
services/core/java/com/android/server/wm/RootWindowContainer.java
services/core/java/com/android/server/wm/Task.java
services/tests/wmtests/src/com/android/server/wm/ActivityRecordTests.java
services/tests/wmtests/src/com/android/server/wm/RootTaskTests.java

####START####bd811a080f40
Merge "Revert "Add systrace tag for system property"" into sc-dev-plus-aosp
####END####
####START####bb36f79f0930
Merge "Use touch usage on camera shortcut vibration" into sc-dev am: 831024c836 am: e283586a5b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15328598

Change-Id: I05d419414decd87f3d2581a82ba34d490a4749f5

####END####
####START####fc211764879d
Merge "Use touch usage on camera shortcut vibration" into sc-dev am: 831024c836 am: eef3d75108

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15328598

Change-Id: Ifd0e17921510964679c129e2508ec4e8e6175bfa

####END####
####START####c03fb15e2938
Merge "Change the doc to reflect the default status of preferential network service" into sc-dev
####END####
####START####87603bee7d01
Merge "Improve logic for RESTRICTED stop reason."
####END####
####START####eb2e346e780b
Merge "Fix charging reporting logic."
####END####
####START####eef3d75108ee
Merge "Use touch usage on camera shortcut vibration" into sc-dev am: 831024c836

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15328598

Change-Id: I15e8efeee50116b287e084bc856b8062313c17ee

####END####
####START####d801b4a10bf0
Merge "Use touch usage on camera shortcut vibration" into sc-dev am: 831024c836

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15328598

Change-Id: I97e4bcb02c7ffa67e4f04f7490f2717f42523b37

####END####
####START####0c13fd19ecbb
Add getPhoneCapability function in TelephonyManager

- Add a resource for Device's Nr information.
- Expose below as systemApi
  - getDeviceNrCapabilityBitmask()
  - getMaxActiveInternetData()
  - getMaxActivePacketSwitchedVoiceCalls()
Bug: 175711587
Test: atest TelephonyManager#testGetPhoneCapability
atest PhoneCapabilityTest
atest PhoneConfigurationManagerTest
atest CellularNetworkValidatorTest
atest PhoneSwitcherTest
atest TelephonyRegistryTest
atest PhoneCapabilityTest

Change-Id: Ide25344787c15b3a57a9e6621766ad02a906f12e
Merged-In: Ide25344787c15b3a57a9e6621766ad02a906f12e

####END####
telephony/java/android/telephony/PhoneCapability.java
telephony/java/android/telephony/TelephonyManager.java

####START####831024c83630
Merge "Use touch usage on camera shortcut vibration" into sc-dev
####END####
####START####ffc06d6b53a8
Merge "Fix potential memory leak of FrameTracker" into sc-dev am: aef0db8f94 am: 51b46e36b9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15334110

Change-Id: I18558faf8bec3395a30b5dbd5ee222dc29b90e43

####END####
####START####5595804b3d02
Merge "Fix potential memory leak of FrameTracker" into sc-dev am: aef0db8f94 am: d1cb83dd08

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15334110

Change-Id: I2d10193d8215229218919070967ace99b4d50c06

####END####
####START####51b46e36b9cb
Merge "Fix potential memory leak of FrameTracker" into sc-dev am: aef0db8f94

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15334110

Change-Id: I8fc1922802a844530d43dc9462fc8d801094f3e9

####END####
####START####4a5ea0ecce6b
Merge "Fix potential memory leak of FrameTracker" into sc-dev am: aef0db8f94

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15334110

Change-Id: I93c2f29eff492356d1618501450d2079eccf6aaf

####END####
####START####32a4e9d29516
Tidy up annotations in timedetector, etc.

Platform annotations like @Nullable / @NonNull are not TYPE_USE
annotations. Move usages on fields to before access modifiers for
consistency.

@IntDef / @StringDef can apparently be TYPE_USE and TYPE_PARAMETER, so
switch to using them as such. Also fix retention policy at the same
time.

Bug: 165832200
Test: compiler only (treehugger)
Change-Id: I621ea50d09262807963a8a74c3838ff1b516bc26

####END####
services/core/java/com/android/server/timedetector/ServerFlags.java
services/core/java/com/android/server/timedetector/TimeDetectorStrategy.java
services/core/java/com/android/server/timezonedetector/MetricsTimeZoneDetectorState.java
services/core/java/com/android/server/timezonedetector/OrdinalGenerator.java
services/core/java/com/android/server/timezonedetector/ServiceConfigAccessor.java
services/core/java/com/android/server/timezonedetector/location/LocationTimeZoneProvider.java
services/core/java/com/android/server/timezonedetector/location/TimeZoneProviderEvent.java

####START####fa9e9d3f04c0
Merge "Propagate launch root task for consecutive launch" into sc-v2-dev am: 3a2efa41f2 am: a080251513

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301153

Change-Id: Ia7abf656a2b5f9e4da386b1bb08f4417e69a57e0

####END####
####START####aef0db8f94ee
Merge "Fix potential memory leak of FrameTracker" into sc-dev
####END####
####START####161e9b74a1fa
HDMICEC: Add equals test for HdmiCecMessage

Bug: 168713324
Test: atest HdmiCecMessageTest#testEqualsHdmiCecMessage
Change-Id: I31ddbed919ccf7a52824a0252c8d1db35bb6ebd9
Merged-In: I31ddbed919ccf7a52824a0252c8d1db35bb6ebd9

####END####
services/tests/servicestests/src/com/android/server/hdmi/HdmiCecMessageTest.java

####START####a08025151383
Merge "Propagate launch root task for consecutive launch" into sc-v2-dev am: 3a2efa41f2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301153

Change-Id: I406a380a9bc242066c56a113a00b75f7c3b02e67

####END####
####START####643fdc6e7e19
Merge "Stop animation when screen times out and the user turns on the phone." into sc-dev am: a16f9cc218 am: c495b42a83

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302103

Change-Id: I026d1607b954fb8a1c10fdaa6074eab3a1515989

####END####
####START####6b6a813e6d4f
Merge "Stop animation when screen times out and the user turns on the phone." into sc-dev am: a16f9cc218 am: 1837f8673a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302103

Change-Id: I48f4abaa2575d7480b4b4d6690587669a2ec2bb1

####END####
####START####3a2efa41f213
Merge "Propagate launch root task for consecutive launch" into sc-v2-dev
####END####
####START####c495b42a833c
Merge "Stop animation when screen times out and the user turns on the phone." into sc-dev am: a16f9cc218

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302103

Change-Id: Ia2b5acea0c6f192daf9e577645aa854005f5c9f7

####END####
####START####2a237b7426e2
Merge "Stop animation when screen times out and the user turns on the phone." into sc-dev am: a16f9cc218

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302103

Change-Id: I2d2b108d84c6dd5cafe5fa2eaca8552288ea48c2

####END####
####START####e7c539f8d7a2
Update maybe-batching logic.

1. Don't re-evaluate state for already running jobs. If the state
   changed, JobSchedulerService would be notified about it.
2. Only send a MSG_STOP_JOB message for jobs that are actually running.
   If the job isn't running, then just remove it from the pending list
   (if applicable).

Bug: 138469672
Bug: 141645789
Test: atest CtsJobSchedulerTestCases
Change-Id: Ia0d9f8845c81fe927193e63a0957f6a3ae0e202a

####END####
apex/jobscheduler/service/java/com/android/server/job/JobSchedulerService.java
services/tests/mockingservicestests/src/com/android/server/job/JobSchedulerServiceTest.java

####START####24b99ef4e71a
Hook up the sysui backend for status bar content rects

StatusBarContentInsetsProvider provides the sysui backend for the
windowmanager api to communicate the location of the privacy indicators
to apps.

This CL hooks up that backend to the dot view controller and the
PhoneStatusBarView, which provides us with a stronger guarantee that
things are working and codifies the places where status bar content
layout can be changed. Also in this CL is a better dot positioning
algorithm that will ensure there is no flickering when the dot needs to
rotate.

Test: manual
Bug 187973222

Change-Id: I3dba7719ac4c4d178c9ec5265865961dbd0450f9

####END####
packages/SystemUI/src/com/android/systemui/Dependency.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/CollapsedStatusBarFragment.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBarView.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/dagger/StatusBarPhoneModule.java
packages/SystemUI/src/com/android/systemui/statusbar/policy/ConfigurationController.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/CollapsedStatusBarFragmentTest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarTest.java
packages/SystemUI/tests/src/com/android/systemui/utils/leaks/FakeConfigurationController.java

####START####867992c865b8
Improve logic for RESTRICTED stop reason.

Now that we have explicit stop reasons, we can improve how we determine
whether the internal stop reason is due to the restricted bucket or due
to other constraints.

Bug: 141645789
Test: atest CtsJobSchedulerTestCases
Change-Id: I82a9641762544ab04bf897c6386d6b18eb607406

####END####
apex/jobscheduler/service/java/com/android/server/job/JobSchedulerService.java

####START####a16f9cc2182b
Merge "Stop animation when screen times out and the user turns on the phone." into sc-dev
####END####
####START####50b9f2120629
Merge "Add hidden APIs to allow to get and set task ID in AccessibilityWindowInfo"
####END####
####START####8d3c8782c133
Fix charging reporting logic.

The JobStatus.set*Satisfied APIs return whether the value changed, not
the previous value. Fix BatteryController's perception and logic of the
returned value. BC ended up notifying JobSchedulerService about changes
anyway, but this now has more correct logic.

Bug: 141645789
Test: atest CtsJobSchedulerTestCases
Change-Id: I2632977f8869470416c5223574cf42d107e71128

####END####
apex/jobscheduler/service/java/com/android/server/job/controllers/BatteryController.java

####START####9d8c4f2de622
Hide RSSI next to single carrier name

If there's exactly one SIM, do not show the RSSI next to the name in
QSBH. Instead, show it with the other icons. If there's more than one
SIM, show each RSSI next to the carrier name, and not with the other
icons (not even in QQS).

Test: atest com.android.systemui.qs
Test: manual single sim
Bug: 187654917
Change-Id: I8b80bb14b8f60872d44d5a92ddfa7c5903420874
Merged-In: I8b80bb14b8f60872d44d5a92ddfa7c5903420874

####END####
packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeader.java
packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeaderController.java
packages/SystemUI/src/com/android/systemui/qs/carrier/QSCarrier.java
packages/SystemUI/src/com/android/systemui/qs/carrier/QSCarrierGroupController.java
packages/SystemUI/src/com/android/systemui/qs/dagger/QSFragmentModule.java
packages/SystemUI/src/com/android/systemui/qs/dagger/QSModule.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusIconContainer.java
packages/SystemUI/tests/src/com/android/systemui/qs/carrier/QSCarrierGroupControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/qs/carrier/QSCarrierTest.java

####START####69fd1625a15d
Perform the minimal dimension restrictions on leaf Task

The minimal dimension restrictions ensure the leaf task fragment
won't be displayed too small to manipulate. However, the out bounds
was exceed the parent task bounds and resulted in wrong inset
calculation while layouting the window.

Restore performing the minimal dimension restrictions in leaf tasks
(the behavior before f562315).

Bug: 193493038
Test: wm presubmit
Change-Id: Ide7ef2ee0b5fd2d6de353a1e9365a7120b2ab0d3

####END####
services/core/java/com/android/server/wm/Task.java
services/core/java/com/android/server/wm/TaskFragment.java

####START####0247eefe9d56
Use intra wallaper transition animation for move to front/back transition.

Bug: 193741133
Test: atest AppTransitionControllerTest
Change-Id: I5c6d02dc272c197368603455d4b0d4d5316d57f0

####END####
services/core/java/com/android/server/wm/AppTransitionController.java
services/tests/wmtests/src/com/android/server/wm/AppTransitionControllerTest.java

####START####5313cb5567c6
[Provider Model] Sync solution from sc

    - ag/15222851: Fix internet panel doesn't show data rat after dds change,
        the internet panel does not listen dds changed.
    - ag/15270340: The "no connection" should be shown in no data cell connection.
    - Add DISALLOW_CONFIG_MOBILE_NETWORKS condition.

Bug: 193029917
Test: atest InternetDialogControllerTest
Change-Id: I4ea7aa443659cef091f525e0064a7db4c95522e2

####END####
packages/SystemUI/src/com/android/systemui/qs/tiles/InternetTile.java
packages/SystemUI/src/com/android/systemui/qs/tiles/dialog/InternetDialog.java
packages/SystemUI/src/com/android/systemui/qs/tiles/dialog/InternetDialogController.java
packages/SystemUI/src/com/android/systemui/statusbar/policy/AccessPointControllerImpl.java
packages/SystemUI/src/com/android/systemui/statusbar/policy/NetworkController.java
packages/SystemUI/src/com/android/systemui/statusbar/policy/NetworkControllerImpl.java
packages/SystemUI/tests/src/com/android/systemui/qs/tiles/dialog/InternetDialogTest.java

####START####7d6516684eca
Use a different context when constructing an EdgeBackGestureHandler.

Fixes: 193758967
Test: atest SystemUITests

Change-Id: I7417ccd3899ffba05411ebb4e56c255f6ef09f54

####END####
packages/SystemUI/src/com/android/systemui/Dependency.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarView.java
packages/SystemUI/src/com/android/systemui/navigationbar/gestural/EdgeBackGestureHandler.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarButtonTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTransitionsTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NavigationBarContextTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NearestTouchFrameTest.java

####START####e8f13f5e418b
Remove feature flag for split shade

This is still controlled by a config, that can be disabled in overlays
if needed, but otherwise will be enabled by default for sw600dp-land

Bug: 192077858
Test: manual
Change-Id: I90eacc33bb05c954ca1015394110558fa911bb04

####END####
packages/SystemUI/src/com/android/systemui/qs/QSFragment.java
packages/SystemUI/src/com/android/systemui/qs/QSPanelController.java
packages/SystemUI/src/com/android/systemui/qs/QSPanelControllerBase.java
packages/SystemUI/src/com/android/systemui/qs/QuickQSPanelController.java
packages/SystemUI/src/com/android/systemui/statusbar/FeatureFlags.java
packages/SystemUI/src/com/android/systemui/statusbar/notification/stack/NotificationStackScrollLayout.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationPanelViewController.java
packages/SystemUI/src/com/android/systemui/util/Utils.java
packages/SystemUI/tests/src/com/android/systemui/qs/QSFragmentTest.java
packages/SystemUI/tests/src/com/android/systemui/qs/QSPanelControllerBaseTest.java
packages/SystemUI/tests/src/com/android/systemui/qs/QSPanelControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/notification/stack/NotificationStackScrollLayoutTest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/NotificationPanelViewTest.java

####START####3aad266ac36c
Merge "Fix parameter order." into sc-dev am: c2f4752a71 am: 88eaf8f214

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329707

Change-Id: Iff78fd32782a02660219158db6c2ae2bd702ca91

####END####
####START####6ad9877d348d
Merge "Fix parameter order." into sc-dev am: c2f4752a71 am: c31c9fb367

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329707

Change-Id: I407a2b4c6845451b3972431a4592a7f0433984df

####END####
####START####75077a17a4c5
Launch admin policies settings screen if not possible to launch help page

Fixes: 191727929
Test: manually performed policy transparency BYOD test
Test: manually performed policy transparency DO test
Test: manually performed policy transparency DO on
managed user test
Test: atest ActionDisabledLearnMoreButtonLauncherTest

Change-Id: Ief0cc2fab98b28f0836b3dee79e91ea365d37274

####END####
packages/SettingsLib/src/com/android/settingslib/enterprise/ActionDisabledByAdminControllerFactory.java
packages/SettingsLib/src/com/android/settingslib/enterprise/ActionDisabledLearnMoreButtonLauncher.java
packages/SettingsLib/src/com/android/settingslib/enterprise/ManagedDeviceActionDisabledByAdminController.java
packages/SettingsLib/tests/robotests/src/com/android/settingslib/enterprise/ManagedDeviceActionDisabledByAdminControllerTest.java

####START####d3bee4f42dcb
Restart recognition when failing to deliver event

If the client does not know that recognition is not running due to a
recognition event not having been delivered, we should attempt to
restart it.

Bug: 193579626
Test: Manual verification of the scenario described in the bug.

Change-Id: I4fc3b3e8defed59a900fd156273e9e695a322b0c

####END####
services/core/java/com/android/server/soundtrigger_middleware/SoundTriggerMiddlewarePermission.java
services/core/java/com/android/server/soundtrigger_middleware/SoundTriggerMiddlewareValidation.java

####START####88eaf8f214fe
Merge "Fix parameter order." into sc-dev am: c2f4752a71

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329707

Change-Id: I954301b5c1dbb04210944523e2cbbfe93cb6949e

####END####
####START####be14c750bf28
Merge "Fix parameter order." into sc-dev am: c2f4752a71

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329707

Change-Id: Ibbd60be7786586699ae4bb5fd32e4e7bd6e0a711

####END####
####START####51b387294d4e
Fix empty side stage after dropping foreground app icon to split

To prevent it entering stage split with empty side stage root, update to
not activate split explicitly when dropping app icons to split. Only
active stage split when the target activity is actually launching in
the side stage root.

Fix: 193200163
Test: drap and drop app icons to enter split, observed it won't active
stage split if the app is already showing in foreground.

Change-Id: I1cad96f6265eb1a14369bfc708871f701764066a

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/StageCoordinator.java

####START####c2f4752a716c
Merge "Fix parameter order." into sc-dev
####END####
####START####c7d95ce1582e
Merge "Fix flickering when switched to the task without IME shown"
####END####
####START####4d990467b23f
Unify the mismatch in the byte order of the address.

Bluetooth address should check MSB for AddrType based on Spec.
(BT Core Spec v 5.2 | Vol 6, Part B, 1.3 DEVICE ADDRESS)
Bluetooth address meaning is not unified in the current Android framework layer.
Because of this, cannot register scanfilter with the intended address format.

Bug: 180466950
Test: manual
Tag: #compatibility
Change-Id: I59a1b5538e4f3fea77a98cba2aa46649fc32ac6b

####END####
core/java/android/bluetooth/BluetoothAdapter.java

####START####3f954a40560a
Merge "Showing small lockscreen clock when media player visible in split shade" into sc-v2-dev am: 1f172ff7de am: 19a55481b8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15328594

Change-Id: I44e2b8c811951e43b870c18c5edcb98b5d838e42

####END####
####START####19a55481b804
Merge "Showing small lockscreen clock when media player visible in split shade" into sc-v2-dev am: 1f172ff7de

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15328594

Change-Id: I9fa1eafe87323c418a77b285dcafe39d44c62ac8

####END####
####START####7a54a3a5f49b
Merge "sysui: show a drag handler when QS is collapsed in split shade" into sc-v2-dev am: da634dae10 am: 17cbb01921

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15235313

Change-Id: Id6545e4b33922a856e684d17596eda26fba8c2c0

####END####
####START####89475fb3e5fd
Deprecating ACTION_STATE_USER_SETUP_COMPLETE

Deprecating ACTION_STATE_USER_SETUP_COMPLETE that was previously used in the NFC provisioning flow, now the NFC provisioning flow uses the admin integrated flow and no longer launches an intent with this action when user provisioning completes.

Test: No tests needed
Bug: 192228539
Change-Id: I6849b9de72f13735995156e1a02a778cf66cf208

####END####
core/java/android/app/admin/DevicePolicyManager.java

####START####1f172ff7de5e
Merge "Showing small lockscreen clock when media player visible in split shade" into sc-v2-dev
####END####
####START####17cbb0192119
Merge "sysui: show a drag handler when QS is collapsed in split shade" into sc-v2-dev am: da634dae10

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15235313

Change-Id: Ibeacf92b6531a3e5c1098bdcacdd06f38aa008eb

####END####
####START####da634dae1036
Merge "sysui: show a drag handler when QS is collapsed in split shade" into sc-v2-dev
####END####
####START####454f12ca7c18
Merge "Fixing the race condition in GenerateRkpKey" into sc-dev am: 9a9741b90c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14961081

Change-Id: I947269d5a67c31c818436de950c715817661162d

####END####
####START####9a9741b90c7e
Merge "Fixing the race condition in GenerateRkpKey" into sc-dev
####END####
####START####9acdb43f8918
Fixing the race condition in GenerateRkpKey

This file was written on the assumption that bindService was
synchronous, which it isn't. This change adds a CountDownLatch to force
the class to wait for the binding to finish. If the relevant key
generation service is not present on the system, then this
functionality will just silently be skipped over.

Bug: 190222116
Test: atest RemoteProvisionerUnitTests
Change-Id: Ie34997a08aa743642c66a20c4b756cd47bff4af1
Merged-In: Ie34997a08aa743642c66a20c4b756cd47bff4af1

####END####
keystore/java/android/security/GenerateRkpKey.java
keystore/java/android/security/keystore2/AndroidKeyStoreKeyPairGeneratorSpi.java

####START####47c8252b9d7d
Merge "Gracefully handle integer overflows." am: edbf08efe4 am: d4909b9aa9 am: f305d79b2f am: 268db7453e

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1714119

Change-Id: Ie786f264683bc11e9c53909a6113e5b564192cc7

####END####
####START####268db7453ede
Merge "Gracefully handle integer overflows." am: edbf08efe4 am: d4909b9aa9 am: f305d79b2f

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1714119

Change-Id: Idcf0ab5837a3d8c02e31895e97ed6bdffe529abe

####END####
####START####3ad3041621cb
Merge "Remove extra article from the comment"
####END####
####START####f305d79b2f14
Merge "Gracefully handle integer overflows." am: edbf08efe4 am: d4909b9aa9

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1714119

Change-Id: I95ef9e71987fc39250e6edd107fe2ec597b1ea17

####END####
####START####aad915ca43ae
Merge "Add function to launch the Network details settings"
####END####
####START####a5570e10aad1
[Provider Model] Launch Wi-Fi detailed when tap the connected Wi-Fi

- Uses the WifiUtils.getWifiDetailsSettingsIntent() to launch Network details settings

Bug: 191475923
Test: manual test with the topic CLs.
atest -c com.android.systemui.qs.tiles.dialog

Change-Id: I38622dc3c91e39e35c71274ca3a06272a5da17fe

####END####
packages/SystemUI/src/com/android/systemui/qs/tiles/dialog/InternetDialog.java
packages/SystemUI/src/com/android/systemui/qs/tiles/dialog/InternetDialogController.java
packages/SystemUI/tests/src/com/android/systemui/qs/tiles/dialog/InternetDialogControllerTest.java

####START####0896e161b378
RESTRICT AUTOMERGE Restart recognition when failing to deliver event

If the client does not know that recognition is not running due to a
recognition event not having been delivered, we should attempt to
restart it.

Fixes: 193579626
Test: Manual verification of the scenario described in the bug.


Change-Id: I4fc3b3e8defed59a900fd156273e9e695a322b0c

####END####
services/core/java/com/android/server/soundtrigger_middleware/SoundTriggerMiddlewarePermission.java
services/core/java/com/android/server/soundtrigger_middleware/SoundTriggerMiddlewareValidation.java

####START####edbf08efe4e2
Merge "Gracefully handle integer overflows."
####END####
####START####65a3d5dfa4ce
Fix potential memory leak of FrameTracker

If begin and end invocations are at the same frame, the end vsync id
will be smaller than the begin vsync id, results in zero size jank info
array, the finish call will be missed as well, a leak happens.

Bug: 192140966
Test: atest FrameTrackerTest InteractionJankMonitorTest
Change-Id: I388558e60bdb84ad248a9afabe7776c4e6e67c57

####END####
core/java/com/android/internal/jank/FrameTracker.java
core/tests/coretests/src/com/android/internal/jank/FrameTrackerTest.java
core/tests/coretests/src/com/android/internal/jank/InteractionJankMonitorTest.java

####START####d379a4bece84
Merge "Correct StartingWindowInfo for non-top activity." into sc-dev am: 6b43ea0a73 am: dcd0eb03f7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287622

Change-Id: I811752dc4ea7f7bf60bfdb0febbddb86d91c6ea8

####END####
####START####c491e97182c4
Merge "Correct StartingWindowInfo for non-top activity." into sc-dev am: 6b43ea0a73 am: 9d3e6c91a7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287622

Change-Id: I1635df17b588590d093454ec4f7fbda6d115735e

####END####
####START####dcd0eb03f757
Merge "Correct StartingWindowInfo for non-top activity." into sc-dev am: 6b43ea0a73

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287622

Change-Id: I7dd3ab48d7c58521af19a7718be320a7e580749e

####END####
####START####abe57dc59339
Merge "Correct StartingWindowInfo for non-top activity." into sc-dev am: 6b43ea0a73

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287622

Change-Id: I743af3c56aec67e1a9487235f1a4a4e64cbaf4a3

####END####
####START####6b43ea0a73d1
Merge "Correct StartingWindowInfo for non-top activity." into sc-dev
####END####
####START####f04429b93557
Merge "Enforce package visibility to the callbacks of the sync status"
####END####
####START####39747538c64e
Apply package visibility to PACKAGE_DATA_CLEARED

Intent ACTION_PACKAGE_DATA_CLEARED is sent without the allowlist so
it may potentially leakage the package information.

Bug: 191291133
Test: atest AppEnumerationTests
Change-Id: Ica10615db22c0bc0eb4fba550bc069031f18c9a9

####END####
core/java/android/app/ActivityManagerInternal.java
services/core/java/android/content/pm/PackageManagerInternal.java
services/core/java/com/android/server/am/ActivityManagerService.java
services/core/java/com/android/server/am/PendingIntentRecord.java
services/core/java/com/android/server/pm/PackageManagerService.java

####START####d64e6ed07abb
Merge "Use alpha instead of invisible for views below shelf to skip redraw" into sc-dev am: 27a1fdb018 am: 34644987c6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331191

Change-Id: Ie703fdd8884320d7c21878ad43943cac0392a8b0

####END####
####START####3622f9551152
Merge "Use alpha instead of invisible for views below shelf to skip redraw" into sc-dev am: 27a1fdb018 am: 91ba7d26fc

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331191

Change-Id: Iba81b0ff78cdc286c600aadda79cb60e791fd709

####END####
####START####34644987c682
Merge "Use alpha instead of invisible for views below shelf to skip redraw" into sc-dev am: 27a1fdb018

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331191

Change-Id: Ie9ece86634d0131b2515ec1b78f12c9260ae472e

####END####
####START####202ca05bd6d2
Merge "Use alpha instead of invisible for views below shelf to skip redraw" into sc-dev am: 27a1fdb018

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15331191

Change-Id: I90ae6879a6a93ee870ffe262fc9679667cde668b

####END####
####START####27a1fdb01806
Merge "Use alpha instead of invisible for views below shelf to skip redraw" into sc-dev
####END####
####START####b878370842ef
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev am: 30c6383d1d am: 17d1be8efc am: 5cb13bbebf am: a8fd5a822e am: 89d3ca0141

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287612

Change-Id: I79d718aef2f9fd69ce6591201b69d6f28ffcf701

####END####
####START####ca461d84542e
Merge "Remove RecentsOnboarding" into sc-dev am: 6a8ca02c6f am: 41de70158c am: 2ff3a7a9d6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15333194

Change-Id: I8a37151fc5d010f55b9fceb5e87c8e3ac934858f

####END####
####START####89d3ca014176
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev am: 30c6383d1d am: 17d1be8efc am: 5cb13bbebf am: a8fd5a822e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287612

Change-Id: I458bc7212fd14d41f32cd1a874e56705b1efccce

####END####
####START####2ff3a7a9d6a8
Merge "Remove RecentsOnboarding" into sc-dev am: 6a8ca02c6f am: 41de70158c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15333194

Change-Id: I3954ad30a9c90ef5c6a8f4e32522b4e1593aa8dd

####END####
####START####a8fd5a822ef4
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev am: 30c6383d1d am: 17d1be8efc am: 5cb13bbebf

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287612

Change-Id: Ia5193bc6840887c259e66778851188196dcb5877

####END####
####START####d50451a03023
Merge "Clear binder identity in callback of IMS IPC interfaces" into sc-dev am: 4696dc9bf8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329696

Change-Id: I5e2f280652352a73c618899b53d3aa4b89549159

####END####
####START####5c074eea36cb
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev am: 30c6383d1d am: 17d1be8efc am: 5cb13bbebf

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287612

Change-Id: Icbd16b9ec586fb9deaf1053745f635e2a2db3f69

####END####
####START####5cb13bbebfb8
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev am: 30c6383d1d am: 17d1be8efc

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287612

Change-Id: I67a349870a799a1cdf3df9577786a326901d65e5

####END####
####START####4696dc9bf897
Merge "Clear binder identity in callback of IMS IPC interfaces" into sc-dev
####END####
####START####41de70158ccb
Merge "Remove RecentsOnboarding" into sc-dev am: 6a8ca02c6f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15322566

Fixes: 180248278
Test: manual
Change-Id: I20bdf481212b5eb6cb57ab635592043130166c62

####END####
####START####fba35062c5db
Merge "Remove RecentsOnboarding" into sc-dev am: 6a8ca02c6f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15322566

Change-Id: I32a553a44b21534f491a1d7c044060c24696a297

####END####
####START####964d297792e5
Add default implementation of TaskFragmentOrganizer

Bug: 190433398
Test: N/A
Change-Id: I84fdba974ef308aebe19348fa76f565311e06f2e

####END####
core/java/android/window/TaskFragmentInfo.java
libs/WindowManager/Jetpack/src/androidx/window/extensions/organizer/JetpackTaskFragmentOrganizer.java
services/core/java/com/android/server/wm/ActivityRecord.java
services/core/java/com/android/server/wm/TaskFragment.java
services/core/java/com/android/server/wm/WindowOrganizerController.java

####START####17d1be8efcbe
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev am: 30c6383d1d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287612

Change-Id: I2fba182703b7e2362a0cd0934903c6a2af849751

####END####
####START####36fa4d530d58
Add requested permissions to the package state hash.

So that role grants are re-run when a new permission is requested
without requiring the app to bump its version code.

Fixes: 194138142
Test: presubmit
Change-Id: I31cb69af572fd22a5e12d4c6ef5d53d87ccce9ea

####END####
services/core/java/com/android/server/policy/role/RoleServicePlatformHelperImpl.java

####START####3d3db03f9f71
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev am: 30c6383d1d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287612

Change-Id: I5e1df42f306b83b1d753e104dea61faa198d6a20

####END####
####START####6a8ca02c6fbf
Merge "Remove RecentsOnboarding" into sc-dev
####END####
####START####c02e59a12ae4
Merge "Enforce package visibility to the api checkUriPermission"
####END####
####START####30c6383d1da6
Merge "Revert "wifidisplay: restrict broadcast by the proper permission"" into rvc-dev
####END####
####START####3feacd996cbe
Merge "Migrate the usage of sCompatibilityModeEnabled"
####END####
####START####2e658b293e0c
Merge "Add support for saving attributes for DNG files"
####END####
####START####58a70958aab7
Merge "Remove LOCATION_HARDWARE from ContextHubManager/Client APIs"
####END####
####START####4b4d1851038b
Merge "Clear binder identity in callback of IMS IPC interfaces" am: 67e10842b2 am: 3d97b23aa1 am: e5026e2532 am: 34856c5f96

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1771685

Change-Id: Iaa3d4b92499470cc7a3895f9f580cb5bdcaf1f1b

####END####
####START####61f482f9fd65
Merge "Move SetupLocaleProperties to Settings.Global."
####END####
####START####f4eb0544601c
Fix flickering when switched to the task without IME shown

When switching tasks from the task has IME shown to another task
without showing IME (e.g. youtube apps.), the flickering might happen
because the next activity accidentally received the IME insets attached
in the previous activity.

If the IME is attached to one app window on that time, even the next
app window is behind the IME window, conceptually the window should
not receive the IME insets if the next window is not eligible IME
requester and ready to show IME on top of it.

Fix the logic in InsetsPolicy#adjustVisibilityForIme for the above
case.

Fix: 192337037
Test: atest WindowStateTests#\
        testAdjustImeInsetsVisibilityWhenTaskSwitchIsAnimating
Change-Id: Ib3a1eacedd3763bcf1e6eed82e7efdf01c50b204

####END####
services/core/java/com/android/server/wm/InsetsPolicy.java
services/tests/wmtests/src/com/android/server/wm/WindowStateTests.java

####START####34856c5f96d3
Merge "Clear binder identity in callback of IMS IPC interfaces" am: 67e10842b2 am: 3d97b23aa1 am: e5026e2532

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1771685

Change-Id: I3d2a499fcfd72c61605ba345b0b576ea7896370f

####END####
####START####e5026e2532f0
Merge "Clear binder identity in callback of IMS IPC interfaces" am: 67e10842b2 am: 3d97b23aa1

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1771685

Change-Id: I86ad5e1d544870b5fb5b450664d57e39699f7d3d

####END####
####START####697483e16f67
Merge "Add null check to work around async unregistration of receiver" into sc-dev am: 72922c8a85

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15316986

Change-Id: Ie1e6546b22174f680af8996cf98057251d6ab690

####END####
####START####63f5d4b69905
Stop removing all APP_STANDBY_BUCKET_CHANGED messages.

APP_STANDBY_BUCKET_CHANGED messages are for single apps, so it doesn't
make sense to remove all messages whenever any app's standby bucket
changes.

Bug: 193918191
Test: N/A
Change-Id: I981cd3be3cd381c6d00f06e3da9f8e67f157a26b
Merged-In: I981cd3be3cd381c6d00f06e3da9f8e67f157a26b

####END####
apex/jobscheduler/service/java/com/android/server/alarm/AlarmManagerService.java

####START####9a405de92460
Merge "Fix to call openGutsInternal even when no Statusbar exists" into sc-v2-dev am: 3296cc24eb am: da095b8e19

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15320516

Change-Id: I12ec8f89d2498c2bc9935acbd0e8aaa76d1c98d2

####END####
####START####72922c8a85af
Merge "Add null check to work around async unregistration of receiver" into sc-dev
####END####
####START####da095b8e1945
Merge "Fix to call openGutsInternal even when no Statusbar exists" into sc-v2-dev am: 3296cc24eb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15320516

Change-Id: I112c03b7a884030020917a7450b4a17cb1c262d3

####END####
####START####bef1b62ac034
Remove LOCATION_HARDWARE from ContextHubManager/Client APIs

Fixes: 191483162
Test: Run PTS tests on existing CHRE devices
Test: Flash on device, verify no security exception is observed
Change-Id: I405423c0981ae2618faa35fd2df9c068d6ead94a

####END####
core/java/android/hardware/location/ContextHubClient.java
core/java/android/hardware/location/ContextHubManager.java
services/core/java/com/android/server/location/contexthub/ContextHubClientBroker.java
services/core/java/com/android/server/location/contexthub/ContextHubServiceUtil.java

####START####3296cc24ebe1
Merge "Fix to call openGutsInternal even when no Statusbar exists" into sc-v2-dev
####END####
####START####30615e1c4c16
Merge "SurfaceView: Update transform hint only if the view is visible" into sc-dev am: 861ba140a1 am: ae457baeff

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302836

Change-Id: Ia6065183f8bed1fb3a5ffae0b2af9569c1adf48d

####END####
####START####c681d7fdfe57
Merge "SurfaceView: Update transform hint only if the view is visible" into sc-dev am: 861ba140a1 am: 23d898fb78

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302836

Change-Id: Id5eada4be69cf8c5597b99a58a811c172ac3db7d

####END####
####START####9fd93a41333b
Merge "SurfaceView: Update transform hint only if the view is visible" into sc-dev am: 861ba140a1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302836

Change-Id: I48261545315b21c41a5c6802f7870e3a946d88ef

####END####
####START####23d898fb782d
Merge "SurfaceView: Update transform hint only if the view is visible" into sc-dev am: 861ba140a1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302836

Change-Id: I2da67d02274e3eb5ce96978c9820f97963a732a0

####END####
####START####dbf042c6667f
Fix parameter order.

AlarmManager.setWindow's parameter order is type -> window start ->
window length. Actually put the values in the correct order.

Bug: 193866265
Test: atest DeviceIdleTest
Test: atest FrameworksMockingServicesTests:DeviceIdleControllerTest
Change-Id: I5c87dad3015859d68aacb6781166432b615327b9

####END####
apex/jobscheduler/service/java/com/android/server/DeviceIdleController.java

####START####2be8f7898d04
Change the doc to reflect the default status of preferential network service

Test: Build
Bug: 193913733
Change-Id: I648b85c39f9b4e66193188852d649e82371ee90c

####END####
core/java/android/app/admin/DevicePolicyManager.java

####START####8e7006c48b4f
Move SetupLocaleProperties to Settings.Global.

Bug: 173818444
Test: manual test
Change-Id: Icda9c489534849a2f59e93195f9a6ded377d38b1
(cherry picked from commit 61a67de48545d27e7e8d10a19cc07d2cc8b86dea)

####END####
core/java/android/provider/Settings.java
packages/SettingsProvider/src/android/provider/settings/validators/GlobalSettingsValidators.java
packages/SettingsProvider/test/src/android/provider/SettingsBackupTest.java

####START####5cf584ec4f09
Merge "Throw new IllegalStateException in CallRedirectionService when the call redirection is not initialized yet" into sc-dev am: ba314fbb85 am: b4fe9c3215

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301694

Change-Id: Icb6e8c7bfaff22063a2f1cf04eb57afd991fe35e

####END####
####START####9c1f2087f516
Merge "Throw new IllegalStateException in CallRedirectionService when the call redirection is not initialized yet" into sc-dev am: ba314fbb85 am: 513b4646d3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301694

Change-Id: Iff3824c2a57be8377691215a3342d4a09182b1c4

####END####
####START####3ce6aba4030f
Ensure calling user is the same as requested user.

This prevents any cross-user requests. Cross-user requests are already
not allowed, but due to a bug elsewhere in the code. This intentionally
handles the case and also throws a SecurityException.

Bug: 193903221
Test: presubmit
Test: manually checked cross-user requests get an exception.
Change-Id: I5bd867b86b972452daa2d8253f3c19f059a8a4b3

####END####
apex/appsearch/service/java/com/android/server/appsearch/AppSearchManagerService.java

####START####861ba140a11e
Merge "SurfaceView: Update transform hint only if the view is visible" into sc-dev
####END####
####START####1f862b0ac016
Merge "Expose ADAS APIs"
####END####
####START####b4fe9c32150c
Merge "Throw new IllegalStateException in CallRedirectionService when the call redirection is not initialized yet" into sc-dev am: ba314fbb85

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301694

Change-Id: I716316c0fbdeda78482ac4140b2494d351cbea2a

####END####
####START####e8021fb56725
Merge "Throw new IllegalStateException in CallRedirectionService when the call redirection is not initialized yet" into sc-dev am: ba314fbb85

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301694

Change-Id: I1341b9b3e8dcf09cfec276752ec57a4858f01c17

####END####
####START####ba314fbb8579
Merge "Throw new IllegalStateException in CallRedirectionService when the call redirection is not initialized yet" into sc-dev
####END####
####START####ef12c7a2b208
Use alpha instead of invisible for views below shelf to skip redraw

Also skip this for heads up notifications

Fixes: 193912541
Test: treehugger
Change-Id: I3c81611696f7918a0f18d4c503b80a6b78ed2c43

####END####
packages/SystemUI/src/com/android/systemui/statusbar/notification/stack/StackScrollAlgorithm.java

####START####c2bfc712ddbb
Merge "Use binder-based iterator to retrieve FRROs" into sc-dev am: 5be998a660 am: fbb8676b2b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302837

Change-Id: I5f1b8784443603e6dc13aaea40005d9ce546ca2e

####END####
####START####ad333619f6e9
Merge "Use binder-based iterator to retrieve FRROs" into sc-dev am: 5be998a660 am: 62c2c75c41

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302837

Change-Id: I05f1654c7e291018c59e56eab302697f6cfe7095

####END####
####START####91e7f7ffd7c9
Merge "Use binder-based iterator to retrieve FRROs" into sc-dev am: 5be998a660

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302837

Change-Id: Ib48f26516e1aca7b23a48d6521ad3dc097d8a095

####END####
####START####fbb8676b2be4
Merge "Use binder-based iterator to retrieve FRROs" into sc-dev am: 5be998a660

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302837

Change-Id: If9c7c5521ee2844ff8049e3bbd95461af406a9fa

####END####
####START####75b51f31d484
Merge "Use IBooleanResultCallback when appropriate in IInputContext"
####END####
####START####53e843c44bd2
Merge "MediaMetricsManager: Authorize log session ids" into sc-v2-dev am: 5a97294940 am: e6e2c080e2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15247197

Change-Id: I7f06fa35f8365cc5fd0fc3a1f265ae2b9abc8d4b

####END####
####START####5be998a6601a
Merge "Use binder-based iterator to retrieve FRROs" into sc-dev
####END####
####START####588ec9f398b0
Clear binder identity in callback of IMS IPC interfaces

The binder identity does get cleared when goes from client process
into phone process. When it comes back from phone to client, the
binder identity should also be cleared.

Bug: 193923945
Test: atest android.telephony.cts.TelephonyManagerTest
Test: atest ImsServiceTest RcsFeatureControllerTest ImsMmTelManagerTest
Merged-In: I34225e32111879e155c9f7865f0045430d171467
Change-Id: I34225e32111879e155c9f7865f0045430d171467
(cherry picked from commit c18002c465912eed70c2c22755949b06849a8f08)

####END####
telephony/java/android/telephony/TelephonyManager.java
telephony/java/android/telephony/ims/ImsMmTelManager.java
telephony/java/android/telephony/ims/ImsRcsManager.java

####START####e6e2c080e23b
Merge "MediaMetricsManager: Authorize log session ids" into sc-v2-dev am: 5a97294940

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15247197

Change-Id: I4bf3aea0626caa25f9fa555c7fda59542a92d398

####END####
####START####83fbe443dd15
Merge "Finish renaming requestUpdateCursorAnchorInfo() to requestCursorUpdates()"
####END####
####START####5a972949405b
Merge "MediaMetricsManager: Authorize log session ids" into sc-v2-dev
####END####
####START####7008c4d5e424
Track active AttributionSources, and finish chains on death

Ensure that, when a binder in an attributionSource dies, the
AttributionSource with the binder, as well as all downstream changes,
are finished.

Fixes: 193261496
Test: manual
Change-Id: I893b4db4383588a989579f58930298923b22d554

####END####
services/core/java/com/android/server/pm/permission/PermissionManagerService.java

####START####3eeb4849c4ef
Merge "Check MissingMethodFlags.COMMIT_CORRECTION at the right place"
####END####
####START####df8a41a4f87a
Merge "Rename the reference to VERSION_CODES#T to VERSION_CODES#TIRAMISU"
####END####
####START####e566eb8efca3
Ensure the device wakes up from doze when tapping expand button

Fixes: 191250633
Test: post hun on aod; tap expander; notice device wakes up.
Change-Id: If98b7dfa0d5ad8dc4a1108a7af94de26064467c4

####END####
packages/SystemUI/src/com/android/systemui/statusbar/notification/row/ExpandableNotificationRow.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarNotificationPresenter.java

####START####a9b95f54be68
Update TV input list upon package state changes in Kids profile

Bug: 194118080
Test: Confirmed buildTvInputListLocked() gets properly called in Kids
profile as well

Change-Id: I0d0537a62fe7728b8e59330817606a352af08180

####END####
services/core/java/com/android/server/tv/TvInputManagerService.java

####START####b16902ffa4d8
Merge "Fixed double face auth on swipe" into sc-dev am: 4438cf6799 am: 3b84010e82

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301708

Change-Id: I5ad368bfe3a4e4b3d95705aa6d647120fbb1c950

####END####
####START####f486c0b46592
Merge "Fixed double face auth on swipe" into sc-dev am: 4438cf6799 am: 2caa5cfd09

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301708

Change-Id: I81a6451da008503a50d08a910e0e0cd2c02f9161

####END####
####START####f67e4d7145bd
Use correct intent key in AbstractAccountAuthenticator JavaDoc.

Test: not needed
Bug: 136458050
Change-Id: I0f0b171d627eeb35f78f541b5a6317f6f82cafc6

####END####
core/java/android/accounts/AbstractAccountAuthenticator.java

####START####960f29b42c68
Merge "Showing brightness slider in collapsed QS in split shade" into sc-v2-dev am: 9314834982 am: a10f077d57

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301454

Change-Id: Ib0acd79dac06ec1f3400a60c7aa2ce044754c9a7

####END####
####START####b9745dc6051d
Merge "Fixed double face auth on swipe" into sc-dev am: 4438cf6799

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301708

Change-Id: Iaa8d50c2a818aa897fb06037afdddc6bd9e1d505

####END####
####START####3b84010e82d8
Merge "Fixed double face auth on swipe" into sc-dev am: 4438cf6799

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301708

Change-Id: Ifa25be9aa20a7ee0381329c0e57bd6c61ddcad32

####END####
####START####14bbb8a744f6
Improve forEach.

The default implementation of Collection.forEach() uses the
iterator(). Switch to straight iterating through the array since the
iterator is an inefficient way to access the array contents.

Benchmark results:

Before:

android.util.ArraySetPerfTest#testForEach_Large:
	forEach_Large_median (ns): 398480
	forEach_Large_min (ns): 395758
	forEach_Large_mean (ns): 400957
	forEach_Large_standardDeviation: 5457
android.util.ArraySetPerfTest#testForEach_Small:
	forEach_Small_min (ns): 82768
	forEach_Small_median (ns): 83884
	forEach_Small_standardDeviation: 896
	forEach_Small_mean (ns): 83724

After:

android.util.ArraySetPerfTest#testForEach_Large:
	forEach_Large_median (ns): 319481
	forEach_Large_min (ns): 316166
	forEach_Large_mean (ns): 339865
	forEach_Large_standardDeviation: 44201
android.util.ArraySetPerfTest#testForEach_Small:
	forEach_Small_min (ns): 58736
	forEach_Small_median (ns): 60648
	forEach_Small_standardDeviation: 1375
	forEach_Small_mean (ns): 60622

Bug: 194098491
Test: atest CorePerfTests:ArraySetPerfTest (see results above)
Test: atest CtsUtilTestCases:ArraySetTest
Test: atest FrameworksCoreTests:ArraySetTest
Change-Id: Ib14b96f095203e1f5811132f2a21be0452645f7e

####END####
apct-tests/perftests/core/src/android/util/ArraySetPerfTest.java
core/java/android/util/ArraySet.java

####START####a10f077d57d0
Merge "Showing brightness slider in collapsed QS in split shade" into sc-v2-dev am: 9314834982

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301454

Change-Id: I169313fefd23c01771de3342829530d0c48453ab

####END####
####START####4438cf679955
Merge "Fixed double face auth on swipe" into sc-dev
####END####
####START####9314834982ba
Merge "Showing brightness slider in collapsed QS in split shade" into sc-v2-dev
####END####
####START####826df357e88e
Merge "4/n: Make CoexCoordinator multi-sensor-aware" into sc-dev am: c4815d0f2d am: 29baf590b2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312046

Change-Id: Iec10a41b7989e3dafe83c09be127b59864b0a6b9

####END####
####START####bd801631592f
Merge "4/n: Make CoexCoordinator multi-sensor-aware" into sc-dev am: c4815d0f2d am: 4dadd5d2ca

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312046

Change-Id: I5f6a70e644dce723d03b5528200d614ea8d0efc3

####END####
####START####c6ea2a5a2ec4
PiP: Implement auto-rotate w/ button nav for Shell Transitions.

Bug: 193836477
Test: enter PIP while in landscape
Change-Id: I27424f3e044c5ea2db555724e6f0fc59c23bf4cd

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipAnimationController.java
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipSurfaceTransactionHelper.java
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipTaskOrganizer.java
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipTransition.java
libs/WindowManager/Shell/src/com/android/wm/shell/pip/PipTransitionState.java
services/core/java/com/android/server/wm/PinnedTaskController.java
services/core/java/com/android/server/wm/Task.java

####START####0e5e76a3dd6e
Merge "Declare IMM#mIInputContext with its concrete type"
####END####
####START####6c7f421f670f
Merge "Stop removing all APP_STANDBY_BUCKET_CHANGED messages."
####END####
####START####29baf590b2e5
Merge "4/n: Make CoexCoordinator multi-sensor-aware" into sc-dev am: c4815d0f2d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312046

Change-Id: I22fd2574840b20627c9eb6e923052ad8a60b70c0

####END####
####START####f75483555ab8
Merge "4/n: Make CoexCoordinator multi-sensor-aware" into sc-dev am: c4815d0f2d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312046

Change-Id: I586a179221fbbe2684d20f5447041f7e8a44e08a

####END####
####START####8d2c15972fb0
Enable specification of 5G network info and carrier configs for ONS changes

Bug: 191878731
Bug: 186688084
Test: Will test locally once partner device and infrastructure is ready.

Change-Id: I7c866741dd86c3d675ea7c4dfe50d0992ab145f1
Merged-In: I7c866741dd86c3d675ea7c4dfe50d0992ab145f1

####END####
telephony/java/android/telephony/AvailableNetworkInfo.java
telephony/java/android/telephony/CarrierConfigManager.java

####START####32bb9993b7f1
Merge "Clean up renamed packages during app removal"
####END####
####START####c31a5b89a1c6
Merge "Refrain from returning mutable pending intent in getShortcutIntent" into sc-dev am: c4adbc278e am: 2a4f76ca10

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315840

Change-Id: I05c46ca71231642e2c815ec05e3dab19e48b853d

####END####
####START####c18002c46591
Clear binder identity in callback of IMS IPC interfaces

The binder identity does get cleared when goes from client process
into phone process. When it comes back from phone to client, the
binder identity should also be cleared.

Bug: 193923945
Test: atest android.telephony.cts.TelephonyManagerTest
Test: atest ImsServiceTest RcsFeatureControllerTest ImsMmTelManagerTest
Change-Id: I34225e32111879e155c9f7865f0045430d171467

####END####
telephony/java/android/telephony/TelephonyManager.java
telephony/java/android/telephony/ims/ImsMmTelManager.java
telephony/java/android/telephony/ims/ImsRcsManager.java

####START####dbc85e3d12ca
Merge "Refrain from returning mutable pending intent in getShortcutIntent" into sc-dev am: c4adbc278e am: 1494140212

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315840

Change-Id: I7f56753f755e1b919bb2bbebd99cc7bcdea2918f

####END####
####START####d391e14f414b
Merge "Revert "Clean up previous DA organizer when registering"" into sc-dev am: 37ae9cfc89 am: 757ad01312

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329893

Change-Id: I95fe6365b02fd5b58d41e04b1432e57d55d37423

####END####
####START####067417bb0896
Merge "Revert "Clean up previous DA organizer when registering"" into sc-dev am: 37ae9cfc89 am: 9224e9d7b6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329893

Change-Id: I80fb2fc37b3cd6328375dcfe3beddbb08e22c9f4

####END####
####START####c4815d0f2d03
Merge "4/n: Make CoexCoordinator multi-sensor-aware" into sc-dev
####END####
####START####e0ec50077299
Merge "Refrain from returning mutable pending intent in getShortcutIntent" into sc-dev am: c4adbc278e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315840

Change-Id: Id2d3ccdfb1eba674fa34c2301112c25520a47d86

####END####
####START####2a4f76ca102a
Merge "Refrain from returning mutable pending intent in getShortcutIntent" into sc-dev am: c4adbc278e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315840

Change-Id: I2fe1a7bc88e3247c68395ceab8436a474fbef74d

####END####
####START####c4adbc278e61
Merge "Refrain from returning mutable pending intent in getShortcutIntent" into sc-dev
####END####
####START####757ad0131278
Merge "Revert "Clean up previous DA organizer when registering"" into sc-dev am: 37ae9cfc89

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329893

Change-Id: I847df1abdf8d117eb029211f85672a4efc6335d0

####END####
####START####c817fba8b2f0
Merge "Revert "Clean up previous DA organizer when registering"" into sc-dev am: 37ae9cfc89

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15329893

Change-Id: I87e8f3c835072b98aa713bf10cdb3d465395ddf9

####END####
####START####4ed4450bd530
Merge "Remove unused methods and classes"
####END####
####START####bf86dd03058c
Merge "Replace DateView with VariableDateView (1/2)"
####END####
####START####37ae9cfc898a
Merge "Revert "Clean up previous DA organizer when registering"" into sc-dev
####END####
####START####0b40777cd118
Revert "Clean up previous DA organizer when registering"

This reverts commit da436d4a012f1ded31b36627d6f2e9a0dca56750.

Reason for revert: b/194083907, b/193993655

Bug: 194083907
Bug: 193993655
Change-Id: I75352215d995707b3bc23e04434c85a0fd9db6b3

####END####
services/core/java/com/android/server/wm/DisplayAreaOrganizerController.java
services/tests/wmtests/src/com/android/server/wm/DisplayAreaTest.java

####START####f9fdfa975129
Add null check to work around async unregistration of receiver

Fixes: 193890703
Test: atest SystemUITests
Change-Id: I47272513482c2ed31167574d2f2cab6094cfd590
Merged-In: I47272513482c2ed31167574d2f2cab6094cfd590

####END####
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBar.java

####START####53538e401394
Merge "Workaround for back arrow being stuck on screen" into sc-dev am: db294649f8 am: 1640c657d2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315836

Change-Id: If69866ed8163315e67357b7c1d5d824bb27a3d06

####END####
####START####a84469fb4925
Rename the reference to VERSION_CODES#T to VERSION_CODES#TIRAMISU

Bug: 194097716
Bug: 191058227
Test: m checkbuild
Change-Id: I716bf08588a5a6669ddeb1567497810900944fe1

####END####
core/java/android/app/ActivityManager.java

####START####f29f87f75432
Merge "Workaround for back arrow being stuck on screen" into sc-dev am: db294649f8 am: dcc6f0ea2d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315836

Change-Id: Iae19da96c99e0185d6264dad7b2bfc208fbcbe44

####END####
####START####5e8f0e9a7730
Merge "Add null check to work around async unregistration of receiver" into sc-v2-dev am: f9a8735e5b am: a972d7125e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15317993

Change-Id: Ifcae6e8a13fbed2aa7853f1f2e423a6de5f92508

####END####
####START####f798c57011bc
Merge "Merge "Fix "already registered" error" am: 0df5bbfe90 am: c4b00b8f57 am: f5bc120ad5" into sc-v2-dev-plus-aosp am: 91507dd73e

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1751360

Change-Id: I73787c5011ea79a337ec1ccafc53e985b360f50d

####END####
####START####1640c657d299
Merge "Workaround for back arrow being stuck on screen" into sc-dev am: db294649f8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315836

Change-Id: I685916f8933348bcbeab2fd20a81429edfbceeea

####END####
####START####50293d4b9009
Merge "Workaround for back arrow being stuck on screen" into sc-dev am: db294649f8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315836

Change-Id: I4b956a2337a0b7dd54fcc34121feb5e2ed822fa8

####END####
####START####357f201492ae
Add displayId to DPC logs

Bug: 188017897
Test: logcat | grep DisplayPowerController
Change-Id: Ic60ee280182dc61a4c412cca8d810f7dcb5cbb3c

####END####
services/core/java/com/android/server/display/DisplayPowerController.java

####START####a972d7125ee7
Merge "Add null check to work around async unregistration of receiver" into sc-v2-dev am: f9a8735e5b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15317993

Change-Id: I22471dfbdf57edc583ae56fe7a4f88d9748dc0e3

####END####
####START####8254cbd020e9
Merge "Fix "already registered" error" am: 0df5bbfe90 am: c4b00b8f57 am: f5bc120ad5

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1751360

Change-Id: Ie8fb5498c7f19605097e4515a14cfdecded2bcf7

####END####
####START####38fb4356905f
Merge "Fix issue of TvInputManagerService not binding to TvInput services in Kids" into sc-dev am: afd8e9bb44 am: 3193649e4a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315830

Change-Id: I1faace0b852f9b028b25a38658f361eba7425e66

####END####
####START####d41fb2fb8f30
Merge "Fix issue of TvInputManagerService not binding to TvInput services in Kids" into sc-dev am: afd8e9bb44 am: 0977fd36fd

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315830

Change-Id: I4d753eb529cec39208bdf51113f6ecfe336950c0

####END####
####START####f5bc120ad544
Merge "Fix "already registered" error" am: 0df5bbfe90 am: c4b00b8f57

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1751360

Change-Id: Icc6dc6d5157c133097e67aad1837c3861fd02080

####END####
####START####db294649f845
Merge "Workaround for back arrow being stuck on screen" into sc-dev
####END####
####START####f9a8735e5bd7
Merge "Add null check to work around async unregistration of receiver" into sc-v2-dev
####END####
####START####71378bde101b
Clean up renamed packages during app removal

It doesn't clean up a renamed package when a package is removed
by OTA or uninstalls, which could lead to failing installs for
renamed packages. This CL cleans up renamed packages when an app
is removed and during initialization just in case.

Bug: 178191975
Test: Manulal (removed by OTA)
      Add Package A
      Verify package A exists
      Remove A, add package B w/ original-package A
      Verify package A exists, but codepath is to package B
      Remove B
      Verify the renamed package for B is cleaned up
Test: Manulal (removed by uninstalls)
      Add Package A
      Verify package A exists
      Remove A, add package B w/ original-package A
      Verify package A exists, but codepath is to package B
      Upgrade B on /data and Remove B on /system
      Verify B is installed as non-system app
      Uninstall B
      Verify the renamed package for B is cleaned up
Change-Id: Ief8f7c5b66339f4dea009361fbaca949f1f16367

####END####
services/core/java/com/android/server/pm/PackageManagerService.java
services/core/java/com/android/server/pm/Settings.java

####START####011135ed9998
Merge "Fix issue of TvInputManagerService not binding to TvInput services in Kids" into sc-dev am: afd8e9bb44

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315830

Change-Id: I288e5f76b32842a0fe4c490c73534cd977ea0242

####END####
####START####0977fd36fde1
Merge "Fix issue of TvInputManagerService not binding to TvInput services in Kids" into sc-dev am: afd8e9bb44

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315830

Change-Id: I7edf1f77e47b10bd850a56a7d6ab6bcd594b3bc5

####END####
####START####afd8e9bb4455
Merge "Fix issue of TvInputManagerService not binding to TvInput services in Kids" into sc-dev
####END####
####START####2a2cfb9fef7b
Use touch usage on camera shortcut vibration

Fix: 193858221
Test: manual
Change-Id: Id9d0c7b633e15106000d4233593a64e67b304545

####END####
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java

####START####05d959127766
Showing brightness slider in collapsed QS in split shade

This is first step of showing brightnesss slider - this change just makes it appear and actually working.
It doesn't cover:
- animation between collapsed slider and expanded slider
- showing slider mirror (disappearing background when changing brightness)

Bug: 193651759
Test: QuickQSBrightnessControllerTest
Change-Id: I21e71e3204352a3801386924f33094e029ac3da8

####END####
packages/SystemUI/src/com/android/systemui/qs/QSPanelControllerBase.java
packages/SystemUI/src/com/android/systemui/qs/QuickQSPanel.java
packages/SystemUI/src/com/android/systemui/qs/QuickQSPanelController.java
packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeaderController.java
packages/SystemUI/src/com/android/systemui/settings/brightness/BrightnessController.java
packages/SystemUI/src/com/android/systemui/settings/brightness/BrightnessSlider.java
packages/SystemUI/src/com/android/systemui/settings/brightness/ToggleSlider.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/dagger/StatusBarComponent.java

####START####0df5bbfe904e
Merge "Fix "already registered" error"
####END####
####START####b887f68ad162
Use binder-based iterator to retrieve FRROs

If for some reason there are a lot of fabricated overlays in the
resources cache, the binder limit of the list of fabricated overlay
infos could exceed the maximum binder transaction size. Rather than
return all of the frro infos in one transactions, register an iterator
with the native idmap2d service and use multiple binder transactions
to iterate through all of the frros.

Bug: 192948522
Test: Toggle device theme colors several times and observe frro cache
      Reboot device and observe old frros are deleted
Change-Id: I5e9cf3ae9d1d45eda683c24141a0cd4e4301e02f

####END####
services/core/java/com/android/server/om/IdmapDaemon.java

####START####21c5e52f3b0c
Merge "Make Recents purely optional" into sc-v2-dev am: 809db6c873 am: b070ac4b8f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302254

Change-Id: I665857d6517b53fd91f33cf2fa31c6c472a4c54e

####END####
####START####49267f20e8ee
Merge "Return the ProcessErrorStateInfo records for the caller's UID only"
####END####
####START####b070ac4b8f90
Merge "Make Recents purely optional" into sc-v2-dev am: 809db6c873

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302254

Change-Id: I83360f67dde2e5b7878091e01807053ccdc2668d

####END####
####START####7f1f3f5bf19c
Merge "Add PCM float profile if extended precision PCM shows but not pcm float." into sc-dev am: 14e7e8316f am: 0426c88c1f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302848

Change-Id: I4903da94aeea7597fdca63421fffe2e6e375ad22

####END####
####START####58c484348377
Merge "Add PCM float profile if extended precision PCM shows but not pcm float." into sc-dev am: 14e7e8316f am: 85d3b6154a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302848

Change-Id: Iedd0703ab24f7b1a44f278315e6d2f5a8ff53c98

####END####
####START####809db6c87348
Merge "Make Recents purely optional" into sc-v2-dev
####END####
####START####0426c88c1fa3
Merge "Add PCM float profile if extended precision PCM shows but not pcm float." into sc-dev am: 14e7e8316f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302848

Change-Id: I163f483af6d49def9ec848592c94f283bae835e0

####END####
####START####073b1b016296
Merge "Add PCM float profile if extended precision PCM shows but not pcm float." into sc-dev am: 14e7e8316f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302848

Change-Id: Ic55761a843880226371475dc2f64340937abc830

####END####
####START####bc9be8e428ce
SurfaceView: Update transform hint only if the view is visible

Transform hint should only be updated when creating the
surface or the view is visible. If the view is not visible, BBQ
will be null. This fixes a NPE in SurfaceView.

Test: go/wm-smoke
Fixes: 193618182
Change-Id: I98a463ae23a93d89ac803e2c2d80ecfd56ca97d2

####END####
core/java/android/view/SurfaceView.java

####START####14e7e8316f01
Merge "Add PCM float profile if extended precision PCM shows but not pcm float." into sc-dev
####END####
####START####31d1c6e1a88a
Merge changes I710805c8,Ie26d634b into sc-v2-dev am: 6f56237160 am: 2d3d0c17f6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305888

Change-Id: Ib6d0a85c5d5552f47f27e7856de104b422accc54

####END####
####START####80f51d8df6db
Merge "Put debug log behind DEBUG flag"
####END####
####START####2d3d0c17f63c
Merge changes I710805c8,Ie26d634b into sc-v2-dev am: 6f56237160

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305888

Change-Id: Ieb990b83786b0eaddab08eaa1779500da3ea0b37

####END####
####START####54c9ff981e30
Merge "Added Ble scan APIs to BatteryStatsManager"
####END####
####START####6f562371605d
Merge changes I710805c8,Ie26d634b into sc-v2-dev

* changes:
  Create a LegacyTransitions to manage combined WCT + remoteanimation
  Aggregate stage-split operations into WCT

####END####
####START####7efcc4dfc72b
Merge "Enable specification of 5G network info and carrier configs for ONS changes" into sc-dev-plus-aosp am: 8d2f34dffb am: b9ea0ae39e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275399

Change-Id: I33d8b98664f7955d7990b6f99a0bc2d27d87a7d4

####END####
####START####b9ea0ae39e78
Merge "Enable specification of 5G network info and carrier configs for ONS changes" into sc-dev-plus-aosp am: 8d2f34dffb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275399

Change-Id: I96f4adf46cfabfa9696375365150c4d8c8e338b9

####END####
####START####e79a41ac50cd
Showing small lockscreen clock when media player visible in split shade

When media player is visible in split shade, lock screen should always show small clock regardless of the number of notifications

Fixes: 193653855
Test: NotificationPanelViewTest

Change-Id: I77db4fbac0005beac1576b1c2e305082f724c811

####END####
packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationPanelViewController.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/NotificationPanelViewTest.java

####START####8d2f34dffb26
Merge "Enable specification of 5G network info and carrier configs for ONS changes" into sc-dev-plus-aosp
####END####
####START####34d2dbaeb8dd
Merge "Use ReentrantReadWriteLock in the compat framework" into sc-dev am: a800c7eee4 am: 276df1028c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15303237

Change-Id: I1f51ce7628eb80ab686eecc903bcc829dc0c9520

####END####
####START####284e6ce760dc
Merge "Use ReentrantReadWriteLock in the compat framework" into sc-dev am: a800c7eee4 am: a38fff7f1f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15303237

Change-Id: I6a94cad2c7368c103189c0e4c877d16560827b5f

####END####
####START####ee126f040420
Add an 'android.software.app_compat_overrides' feature

This feature will allow OEMs to opt-in specific devices/builds to per-app compat overrides.

Bug: 188500456
Test: N/A
Change-Id: I00108d163f752d23c380496ccac971cf0fcfe0f6

####END####
core/java/android/content/pm/PackageManager.java

####START####276df1028c46
Merge "Use ReentrantReadWriteLock in the compat framework" into sc-dev am: a800c7eee4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15303237

Change-Id: Ib260f1cb938ded72d20fa26db033835192ffd6dc

####END####
####START####d972a4a89000
Merge "Use ReentrantReadWriteLock in the compat framework" into sc-dev am: a800c7eee4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15303237

Change-Id: I33a5321a76e88883a9789aaa3f79d9419396b8f8

####END####
####START####796514a1b8c1
Fix a potential NPE when allocating space for compressed apex

Bug: 189369298
Test: th

Merged-In: I9357be8021e77fc8c3839f15a4a53c2a3c63cb13
Change-Id: I9357be8021e77fc8c3839f15a4a53c2a3c63cb13

####END####
services/core/java/com/android/server/recoverysystem/RecoverySystemService.java

####START####a800c7eee415
Merge "Use ReentrantReadWriteLock in the compat framework" into sc-dev
####END####
####START####8c8ed0670ebf
Put debug log behind DEBUG flag

From recent bugreport, still seeing this log on droidfood builds

Bug: 193950559
Change-Id: I0127249543364658810ff9f6cacbf321a6324486
Test: local

####END####
packages/SystemUI/src/com/android/systemui/people/widget/PeopleSpaceWidgetManager.java

####START####71cbe3c41ce4
LocalDisplayAdapter: Fix log line

Test: n/a
Change-Id: I4bbccecb9d5afdd5dddf0751fb3fdabd2d1fe94c

####END####
services/core/java/com/android/server/display/LocalDisplayAdapter.java

####START####8b9968d06ee7
Merge "Increase timeout on VibrationThread to wait for vibrator callbacks" into sc-dev am: 1a208a730d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278138

Change-Id: I1f2cb82b53ca313eb406f071e08585540ad1494d

####END####
####START####164bafb0c066
Merge "Add accessibility messages to privacy chip on tv." into sc-dev am: 9028f4992c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15299312

Change-Id: I26fa3c7e6d67e4d00ff452db9c7ab4fd4a524f69

####END####
####START####5d29e068cfd7
Merge "Only intercept lockIcon touches after longpress" into sc-dev am: 5e0131613a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15313964

Change-Id: Ifec9d3cecca89b672444ddb45f38316e0a8c3659

####END####
####START####10066c69abda
Merge "resolve merge conflicts of c482869205be9a9d2739523b31cc0787c234171b to sc-v2-dev" into sc-v2-dev
####END####
####START####a5545793853a
Correct StartingWindowInfo for non-top activity.

When finishing a top activity and goes to resume the below activity, if
the resumed activity was gone and need to recreate, this should be treat
as warm launch and there should show an empty style splash screen on it.
Previous there do create a splash screen window but the parameters are
wrong because we are trying to create the StartingWIndowInfo from the
top activity.

Fixes: 193040222
Test: atest ActivityRecordTests
Test:
1. enable "Dont keep Activities"
2. Launch twitter, open link.
3. Click back key and there should show empty splash screen.

Change-Id: I33ac43ef6ca79c7422a818e468a7af32c7894eeb

####END####
services/core/java/com/android/server/wm/ActivityRecord.java
services/core/java/com/android/server/wm/StartingSurfaceController.java
services/core/java/com/android/server/wm/Task.java
services/core/java/com/android/server/wm/TaskOrganizerController.java
services/tests/wmtests/src/com/android/server/wm/ActivityRecordTests.java

####START####baa6df09b71b
Merge "Increase timeout on VibrationThread to wait for vibrator callbacks" into sc-dev am: 1a208a730d am: 3052c30321

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278138

Change-Id: Ie2bd381bdfe193af7605f2fd7eb09e37b40fca83

####END####
####START####7d21cba68306
Merge "Increase timeout on VibrationThread to wait for vibrator callbacks" into sc-dev am: 1a208a730d am: ba6f3dc2f0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278138

Change-Id: I5a681b0c0b70f2b64cd1aa5a85160f80bf167d6f

####END####
####START####6d9107a468da
Test apexd behaves correctly when not in fs-checkpoint mode

This CL contains two tests:
1) When fs-checkpoint-mode is false, but fs-rollback-mode is true
2) When both modes are false

Bug: 193648282
Test: atest StagedInstallInternalTest
Change-Id: I9c96296343a7f39a65de9e06e8a07d765f832044

####END####
tests/StagedInstallTest/app/src/com/android/tests/stagedinstallinternal/StagedInstallInternalTest.java
tests/StagedInstallTest/src/com/android/tests/stagedinstallinternal/host/StagedInstallInternalTest.java

####START####3052c3032157
Merge "Increase timeout on VibrationThread to wait for vibrator callbacks" into sc-dev am: 1a208a730d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278138

Change-Id: I69f05284f47070f2f6607e2c055477c32221ff47

####END####
####START####dd351bd2f828
Merge "Start activity in the embedded TaskFragment if allowed" into sc-v2-dev am: 8aedf643cb am: 6a19b768f3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15258461

Change-Id: Ie9dccbd388935bf6fbecdf55c7c57433009fef38

####END####
####START####6a19b768f3f7
Merge "Start activity in the embedded TaskFragment if allowed" into sc-v2-dev am: 8aedf643cb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15258461

Change-Id: I427d1514f19752301fd08d93fadfeb4ac0f5a9ac

####END####
####START####1a208a730da0
Merge "Increase timeout on VibrationThread to wait for vibrator callbacks" into sc-dev
####END####
####START####8aed08b0cd3b
Merge "Add accessibility messages to privacy chip on tv." into sc-dev am: 9028f4992c am: c1863267ed

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15299312

Change-Id: I7e862695c9bbc9dccc7d3418518455a0aa6666c7

####END####
####START####babaa75fc131
Merge "Only intercept lockIcon touches after longpress" into sc-dev am: 5e0131613a am: f6c074dda2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15313964

Change-Id: I98c3e06e5b71d478db5415d9e03d445a52ca1e9c

####END####
####START####8aedf643cb58
Merge "Start activity in the embedded TaskFragment if allowed" into sc-v2-dev
####END####
####START####4a6fb4e6c19b
resolve merge conflicts of c482869205be9a9d2739523b31cc0787c234171b to sc-v2-dev

Change-Id: I8a90f3b03b1bce569db9f6ba3a8b56e0a2031f7e
Fixes: 194011370
Merged-In: Ied977fec9009265dac89b7e24c1075ceb2905bfd

####END####
####START####9d753e53b106
ActivityManagerService: add new lmkd kill reason

Add new LOW_FILECACHE_AFTER_THRASHING kill reason introduced in lmkd.

Bug: 193293513
Signed-off-by: Suren Baghdasaryan <surenb@google.com>
Change-Id: I5f86197865eb0353ef2c836ec9b2aeaae3bbf2ee
Merged-In: I5f86197865eb0353ef2c836ec9b2aeaae3bbf2ee

####END####
services/core/java/com/android/server/am/LmkdStatsReporter.java

####START####8608d0626e87
Merge "Rename FIRST_SDK_INT to DEVICE_INITIAL_SDK_INT"
####END####
####START####fdcc2b5498b5
Add function to launch the Network details settings

- Define the ACTION_WIFI_DETAILS_SETTINGS for launching the Wi-Fi
network details settings

Bug: 191475923
Test: manual test
make RunSettingsLibRoboTests ROBOTEST_FILTER=WifiUtilsTest

Change-Id: I87259bd4e9a616a27c6b2f9b22c7b6291b2c8a41

####END####
packages/SettingsLib/src/com/android/settingslib/wifi/WifiUtils.java
packages/SettingsLib/tests/robotests/src/com/android/settingslib/wifi/WifiUtilsTest.java

####START####eb07ed316e3f
Merge "Add accessibility messages to privacy chip on tv." into sc-dev am: 9028f4992c am: 017dc09664

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15299312

Change-Id: Iade6abf4bdbd064aaba3e074b9620757e005c347

####END####
####START####c1863267ed51
Merge "Add accessibility messages to privacy chip on tv." into sc-dev am: 9028f4992c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15299312

Change-Id: Iddeda570a68cfa7c4d5472dbfd02c725d169eabb

####END####
####START####9028f4992c7d
Merge "Add accessibility messages to privacy chip on tv." into sc-dev
####END####
####START####d2fd498303bb
Propagate launch root task for consecutive launch

Propagate launch root task for consecutive launch to ensure trampoline
activities will be launched into the same root task. And prevent the
indicated target-root-task been overrided with the root of reusable
task.

Fix: 193095759
Test: manul check trampoline activities will be launched into indicated
root task.
Test: atest ActivityMetricsLaunchObserverTests# \
testConsecutiveLaunchNewTask

Change-Id: Ic75c7efbf120562fc284c6ee12d49d2f736a42ec

####END####
services/core/java/com/android/server/wm/ActivityMetricsLogger.java
services/core/java/com/android/server/wm/ActivityRecord.java
services/core/java/com/android/server/wm/ActivityStarter.java
services/tests/wmtests/src/com/android/server/wm/ActivityMetricsLaunchObserverTests.java

####START####4dbaec627c9b
Add support for saving attributes for DNG files

Also add support for IMAGE_TYPE_UNKNOWN files that do not have an
identifiable file extension, but follows the TIFF specification.

Also fixes issue where certain thumbnail-only tags were not being
replaced after primary/preview/thumbnail image data was swapped.

Bug: 193010129, Bug: 193010735
Test: atest ExifInterfaceTest
Change-Id: I098cf1a0730d0cb0f1d6010a21b3ec7ada8dc6b7

####END####
media/java/android/media/ExifInterface.java

####START####14add1cb7435
Use IBooleanResultCallback when appropriate in IInputContext

This is a small code clean up in IInputContext, which should have no
observable behavior change for app/IME developers.

In the following two methods we have used IIntResultCallback to return
a boolean value in a synchronous manner by using 0 to represent false
and 1 to represent true.

 * IInputContext#requestCursorUpdates
 * IInputContext#commitContent

Now that we have IBooleanResultCallback, we can just use true and
false without any conversion.

Bug: 192412909
Test: presubmit
Change-Id: Id6beaf3c9350b70138eb77f406be86fe2c8b679f

####END####
core/java/android/inputmethodservice/RemoteInputConnection.java
core/java/com/android/internal/inputmethod/Completable.java
core/java/com/android/internal/inputmethod/IInputContextInvoker.java
core/java/com/android/internal/view/IInputConnectionWrapper.java

####START####ca490fc87912
Finish renaming requestUpdateCursorAnchorInfo() to requestCursorUpdates()

This is a follow up CL to my previous CL [1] in Android L, which
renamed

  InputConnection#requestUpdateCursorAnchorInfo()

to

  InputConnection#requestCursorUpdates()

per API council feedback before that API was finally published.

Although its API surface has been correctly renamed, there have been
several uses of its older name in our internal code.  This CL also
updates such internal uses to avoid confusions.

As this is a purely mechanical renaming, there should be no behavior
change in this CL.

 [1]: I772c48ff18918e48a81e807b48ff907614485c09
      d8636ea7ca78df83d6b04088eab7853f15f3e999

Bug: 192412909
Test: atest
Change-Id: I75701a5a32d52283497208013c28ceb75c1adfa9

####END####
core/java/android/inputmethodservice/RemoteInputConnection.java
core/java/com/android/internal/inputmethod/IInputContextInvoker.java
core/java/com/android/internal/view/IInputConnectionWrapper.java

####START####75338fd3ca5b
Declare IMM#mIInputContext with its concrete type

This is a small refactoring that changes no semantics but just reduces
some boilerplate code in InputMethodManager.

We know that IMM#mIInputContext is guaranteed to be an instance of
IInputConnectionWrapper, we can reduce some boilerplate code by using
its concrete class when declaring it.

Using its concrete type would also helps the runtime and AOT compiler
do optimizations such as devirtualization because
IInputConnectionWrapper is already declared as a final class.

Other that such code reduction and plausible performance implications,
there should be no behavior change in this CL.

Bug: 192412909
Test: presubmit
Change-Id: I2ee22292feeb6c806d2949bc05f2780923597e1b

####END####
core/java/android/view/inputmethod/InputMethodManager.java

####START####b1fb07a83bc1
Remove unused methods and classes

This is a follow up CL to my previous CL [1], which logically reverted
IInputMethodManager from emulated sync IPCs to truly sync IPCs.

There are several methods and classes that are no longer actively used
after that revert CL.  This CL also removes those unused stuff until
we we actually start using them again.

Since those methods and classes are not used right now, there should
be no user/developer visible behavior change in this CL.

 [1]: If16ac0de536d9089eb04f6e07b1ee47378124658
      662b48b72d841119160ab5c1b03be1ea36f3351d

Bug: 192412909
Test: presubmit
Change-Id: I8666ac1399058b980e51e2459122b2f5f36c77b5

####END####
core/java/com/android/internal/inputmethod/CallbackUtils.java
core/java/com/android/internal/inputmethod/ResultCallbacks.java

####START####e644af1fb9ff
Merge "Fix OHM H/W key shortcut dosn't work appropriately" into sc-v2-dev am: ae942fcf7d am: 6ee95e34da

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309896

Change-Id: I19fa5a67e23ccfb05b64c3d4531faebfb4779c21

####END####
####START####1a8d7b72d825
Merge "Generalize window bounds for layout" into sc-v2-dev am: cde7b47aa2 am: df0f9a762a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309903

Change-Id: Iadc7b630bb0817c217eec186e947ec76da7ff856

####END####
####START####8cb865279217
Remove RecentsOnboarding

RIP

Fixes: 180248278
Test: manual

Change-Id: Ifb73928ceab67c451776c1657bdc230670c9af81

####END####
packages/SystemUI/shared/src/com/android/systemui/shared/system/LauncherEventUtil.java
packages/SystemUI/src/com/android/systemui/Prefs.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBar.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarView.java
packages/SystemUI/src/com/android/systemui/recents/RecentsOnboarding.java

####START####6ee95e34da51
Merge "Fix OHM H/W key shortcut dosn't work appropriately" into sc-v2-dev am: ae942fcf7d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309896

Change-Id: I15c3842c6edf8a87b2353c5cfe03e73c7ce819ed

####END####
####START####df0f9a762a1b
Merge "Generalize window bounds for layout" into sc-v2-dev am: cde7b47aa2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309903

Change-Id: Icbba01e2c51762e8087cf44ffae869419e209524

####END####
####START####ae942fcf7de8
Merge "Fix OHM H/W key shortcut dosn't work appropriately" into sc-v2-dev
####END####
####START####cde7b47aa273
Merge "Generalize window bounds for layout" into sc-v2-dev
####END####
####START####087a06f44d38
Fix to call openGutsInternal even when no Statusbar exists

Bug: 194014429
Bug: 138625582
Bug: 187111293
Test: atest SystemUITests
Test: atest ArcNotificationPipelineIntegrationTest
Change-Id: I9b4455ad31ef0a227fac52990c15af8abc164e6b

####END####
packages/SystemUI/src/com/android/systemui/statusbar/notification/row/NotificationGutsManager.java

####START####b816e8de9490
Merge "Only intercept lockIcon touches after longpress" into sc-dev am: 5e0131613a am: 8de5056d19

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15313964

Change-Id: Idfdff9c4340e134150578e7ca6daefc1ae0fd7bd

####END####
####START####f6c074dda235
Merge "Only intercept lockIcon touches after longpress" into sc-dev am: 5e0131613a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15313964

Change-Id: I5880fe3b9b33def4356c019642db8de36c65d5bc

####END####
####START####5e0131613ae2
Merge "Only intercept lockIcon touches after longpress" into sc-dev
####END####
####START####174e1a67fbb6
Merge "SysUI co-ex updates" into sc-dev am: c482869205

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15312413

Change-Id: I3c9a741025e9f5160e765be4720d664bae132ba8

####END####
####START####c482869205be
Merge "SysUI co-ex updates" into sc-dev
####END####
####START####7cbbc225b1bb
Workaround for back arrow being stuck on screen

- Whenever we defer the cleanup of the back gesture, schedule a failsafe
  to clean up the window if it's not handled properly.  We'll enable
  this failsafe for sc-dev and disable it for further investigations
  post sc-dev
- Dump additional info for the nav bar window so we can narrow down
  the issue post sc-dev

Bug: 190778197
Test: Can't repro the initial issue, so artificially trigger it to verify failsafe
Test: adb shell dumpsys activity service SystemUIService
Change-Id: I0a8f25babe750e6e5ba4c933ab5271a82ef63646

####END####
packages/SystemUI/plugin/src/com/android/systemui/plugins/NavigationEdgeBackPlugin.java
packages/SystemUI/src/com/android/systemui/navigationbar/gestural/EdgeBackGestureHandler.java
packages/SystemUI/src/com/android/systemui/navigationbar/gestural/NavigationBarEdgePanel.java

####START####cde9224b7b28
Only intercept lockIcon touches after longpress

All other touches should be let through to NPV in case
the user starts to swipe up from the lock icon

We still want to continue intercepting touches after a long press
so that the NPV won't mistakenly handle the touch + expand the
shade after a longpress.

Test: manual
Fixes: 193614314
Change-Id: I060f6f78c373a726fe4dbe1be5b5413364882e1d

####END####
packages/SystemUI/src/com/android/keyguard/LockIconViewController.java

####START####f83947fa58d2
Merge "Fix One-handed tutorial looks janky on entering transition" into sc-dev am: ed889bb867 am: 989aee5581

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283490

Change-Id: Idca01582c41c6ac9b7e7ebff7ebff26b1a416d1b

####END####
####START####ec7536f73e68
Merge "Fix One-handed tutorial looks janky on entering transition" into sc-dev am: ed889bb867 am: 39e2268eae

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283490

Change-Id: Ibf28b07c6bba54ef0dfbf29f54aeb54863e13225

####END####
####START####989aee558198
Merge "Fix One-handed tutorial looks janky on entering transition" into sc-dev am: ed889bb867

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283490

Change-Id: I3136887f13ca30c8ec72d6288b2c17e9a321c85f

####END####
####START####b62b4923e368
Merge "Fix One-handed tutorial looks janky on entering transition" into sc-dev am: ed889bb867

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283490

Change-Id: Ia178db437d9a69e728531ea124b31ce54a582be9

####END####
####START####ed889bb8672c
Merge "Fix One-handed tutorial looks janky on entering transition" into sc-dev
####END####
####START####8cc7529a2f18
Add lock or sleep power button behavior.

This changelist defines a new short-press button behavior,
which will lock the device or put the device to sleep if
already locked. This enables use-cases where the power button
should first return to the lock screen.

Bug: 194002900
Test: manual
Change-Id: I3098e6244563cb62facb7b0b35300e656b744c7c

####END####
services/core/java/com/android/server/policy/PhoneWindowManager.java

####START####6407d54e339f
Start activity in the embedded TaskFragment if allowed

If the task already contains child TaskFragments, an activity
should be started in the child TaskFragments, but only doing so
if the activity is allowed to be embedded.

Currently, an app can embed its activities into its own task.
Only system or apps with ACTIVITY_EMBEDDING permission can embed
activities of another app.

Bug: 193456000
Bug: 189386461
Test: wm presubmit
Change-Id: I8707f5f79deb23cc9b2b8d647382416dce6a6e9d

####END####
services/core/java/com/android/server/wm/ActivityStarter.java

####START####fe3509e57b56
Merge "Update recents onboarding logic" into sc-dev am: f169d44132 am: 2e9ad10a15

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15316989

Change-Id: Ie200af6d24cb241d3f10d97b85158f44971a4d6a

####END####
####START####2ae2620ffcc9
Merge "Update recents onboarding logic" into sc-dev am: f169d44132 am: 7d3105b840

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15316989

Change-Id: I0f2330f10aff1f1cb8399fba555cf2848eec1144

####END####
####START####75f1dd4e62ff
Merge "Update recents onboarding logic" into sc-dev am: f169d44132

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15316989

Change-Id: Ib72241c8a65625656a14eecd63f24176d5daf142

####END####
####START####2e9ad10a1556
Merge "Update recents onboarding logic" into sc-dev am: f169d44132

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15316989

Change-Id: I235712e3a27ae28cd0734f14084f270d0462089c

####END####
####START####ac42fd0bf971
Add null check to work around async unregistration of receiver

Bug: 193890703
Test: atest SystemUITests
Change-Id: I47272513482c2ed31167574d2f2cab6094cfd590

####END####
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBar.java

####START####ad82a0fef52a
MidiService: synchronize mDeviceConnections

Try to prevent a NullPointerException caused
by scanning the array while devices were being removed
by another thread.

Bug: 193278370
Test: atest CtsMidiTestCases
Change-Id: I8560cf6f39654037d5ccdc0f6922fa8bdb719c2f

####END####
services/midi/java/com/android/server/midi/MidiService.java

####START####4cb34cc0c2a9
Update recents onboarding logic

- Remove quickscrub tips
- Add additional checks on nav mode

Fixes: 180248278
Test: manual
Change-Id: I1661bb1b63167c508c6164a1a4ef8fe31a9749e5

####END####
packages/SystemUI/shared/src/com/android/systemui/shared/system/LauncherEventUtil.java
packages/SystemUI/src/com/android/systemui/Prefs.java
packages/SystemUI/src/com/android/systemui/recents/RecentsOnboarding.java

####START####8c27e631036a
Merge "3/n: Add CoexCoordinator" into sc-dev am: 6cb9ecadfc am: 56180f6029

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305872

Change-Id: I5daea19bb9e04984ecb6aeab6f70d4becb9a0ac6

####END####
####START####466076ca8fd3
Merge "3/n: Add CoexCoordinator" into sc-dev am: 6cb9ecadfc am: d5e97fb330

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305872

Change-Id: I143cb1914c236dd8baa8fd6d1e69c8a2c6533971

####END####
####START####56180f6029ea
Merge "3/n: Add CoexCoordinator" into sc-dev am: 6cb9ecadfc

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305872

Change-Id: I691477ab746376f25f649d1d904f5742e949df4a

####END####
####START####70bfb88c487d
Merge "3/n: Add CoexCoordinator" into sc-dev am: 6cb9ecadfc

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305872

Change-Id: Ia76ede326c5e506867592de075f23d8b5729ae7c

####END####
####START####6cb9ecadfc33
Merge "3/n: Add CoexCoordinator" into sc-dev
####END####
####START####ff3a9bf30922
Merge "Ensure VcnGatewayConnection#isQuitting never gets unset after being set" into sc-dev am: 0df66631c0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15316004

Change-Id: I151b67855b705197cb832caa32c91cc746569b56

####END####
####START####0df66631c085
Merge "Ensure VcnGatewayConnection#isQuitting never gets unset after being set" into sc-dev
####END####
####START####ea7d74a27046
Merge "Reset HotwordDetectionConnection when VoiceInteractionService crashes" into sc-dev am: a687e13ff3 am: 584fa3e8b4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15269082

Change-Id: I37cb99d03770a19d9b54798fec9ab588a81ce68e

####END####
####START####56685c88b047
Merge "Reset HotwordDetectionConnection when VoiceInteractionService crashes" into sc-dev am: a687e13ff3 am: 955c0a799c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15269082

Change-Id: Ie7859fd24ee48136b8f36e773586772f75760ddd

####END####
####START####6139cf51b2b5
Create a LegacyTransitions to manage combined WCT + remoteanimation

Use this to implement Drag-to-split transition

BYPASS_INCLUSIVE_LANGUAGE_REASON=using existing API.

Bug: 192291727
Test: drag from taskbar into split and observe. Also,
      drag same-app into split and observe no-op.
Change-Id: I710805c85c7d57ae8eebe18e5df7fca899f1b882

####END####
core/java/android/app/ActivityManagerInternal.java
core/java/android/window/WindowContainerTransaction.java
core/java/android/window/WindowOrganizer.java
libs/WindowManager/Shell/src/com/android/wm/shell/apppairs/AppPair.java
libs/WindowManager/Shell/src/com/android/wm/shell/common/SyncTransactionQueue.java
libs/WindowManager/Shell/src/com/android/wm/shell/common/split/SplitWindowManager.java
libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/SplitScreenController.java
libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/StageCoordinator.java
libs/WindowManager/Shell/src/com/android/wm/shell/transition/LegacyTransitions.java
libs/WindowManager/Shell/src/com/android/wm/shell/transition/Transitions.java
services/core/java/com/android/server/am/ActivityManagerService.java
services/core/java/com/android/server/wm/AppTransition.java
services/core/java/com/android/server/wm/DisplayContent.java
services/core/java/com/android/server/wm/WindowOrganizerController.java

####START####584fa3e8b4db
Merge "Reset HotwordDetectionConnection when VoiceInteractionService crashes" into sc-dev am: a687e13ff3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15269082

Change-Id: I4338b8db488e2aa35293bd1fbb7f5e225b7cb3ef

####END####
####START####abc1fb02ba66
Merge "Reset HotwordDetectionConnection when VoiceInteractionService crashes" into sc-dev am: a687e13ff3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15269082

Change-Id: Ifc8b19042d6fd6b04d11c570b66bcae40421dc80

####END####
####START####a687e13ff317
Merge "Reset HotwordDetectionConnection when VoiceInteractionService crashes" into sc-dev
####END####
####START####7bc45ec8169f
Merge "Disable unnecessary freezer dbg msg" into sc-dev am: 2a4ff35621 am: 7fd05db338 am: bef8b4dc0a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15187491

Change-Id: Ieba3dfa123c4767fdd980f70a18baae752b67389

####END####
####START####2c02f91b4f4e
Merge "Disable unnecessary freezer dbg msg" into sc-dev am: 2a4ff35621

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15187491

Change-Id: I450f0e8c71b619b8a905d9ce1e076328ba283b49

####END####
####START####bef8b4dc0a8c
Merge "Disable unnecessary freezer dbg msg" into sc-dev am: 2a4ff35621 am: 7fd05db338

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15187491

Change-Id: Ib359dca0e88c41ec3b72daf7ba1d1601dbe2861e

####END####
####START####9bca21b817d9
Merge "Require non-null HAT for fingerprint enrollment" into sc-dev am: 0295c273bd am: 328a97c099

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305883

Change-Id: Iac3a74ed36a2101e2de9d3ff939db667dc9e9fb7

####END####
####START####ca87664c3166
Merge "Require non-null HAT for fingerprint enrollment" into sc-dev am: 0295c273bd am: 30e41cff70

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305883

Change-Id: Iab5be47185b865ea298879c413b66780764163b0

####END####
####START####66e16c89f96f
Merge "Show the generic bouncer on remote input" into sc-dev am: bf09a9fac0 am: bce70652d7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15311059

Change-Id: Ia6437b2422e3b482f432ac573ba5bbe7734a89ee

####END####
####START####2338fa622b9b
Merge "Show the generic bouncer on remote input" into sc-dev am: bf09a9fac0 am: d6415d20aa

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15311059

Change-Id: I9750d0b7cae7b54bfe94270e856877968086fc14

####END####
####START####7fd05db33842
Merge "Disable unnecessary freezer dbg msg" into sc-dev am: 2a4ff35621

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15187491

Change-Id: If259dbdeb4df5f03c35d32fee70c22114b901447

####END####
####START####2a4ff35621a7
Merge "Disable unnecessary freezer dbg msg" into sc-dev
####END####
####START####1c21f45b759e
Merge "Require non-null HAT for fingerprint enrollment" into sc-dev am: 0295c273bd

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305883

Change-Id: I93851639799814d45aaeb6a16fd89f308eaebae7

####END####
####START####30e41cff70b5
Merge "Require non-null HAT for fingerprint enrollment" into sc-dev am: 0295c273bd

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305883

Change-Id: I4ba7a2a5edce4cb6da38cd2f38cbf796d43ea8d6

####END####
####START####0295c273bd77
Merge "Require non-null HAT for fingerprint enrollment" into sc-dev
####END####
####START####bce70652d7da
Merge "Show the generic bouncer on remote input" into sc-dev am: bf09a9fac0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15311059

Change-Id: I27506d8db1204231dc4b69a311e22adca0393ff3

####END####
####START####3c5ddcdcc8fc
Merge "Show the generic bouncer on remote input" into sc-dev am: bf09a9fac0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15311059

Change-Id: Ib28eff621cd0fe1170a807983b4a724e1b958ab7

####END####
####START####e9f13e1341e2
Aggregate stage-split operations into WCT

Previously different operations were just applying transactions
as they were called. We need better control over this for
synchronization purposes, so we basically pass wct into these
operations so that everything can be aggregated into one WCT
if desired.

Bug: 192291727
Test: existing tests pass (this is a refactor)
Change-Id: Ie26d634bcd3ab6baf4d2a4788986689914a58c13

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/SplitScreenController.java
libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/StageCoordinator.java

####START####164f70d4f102
4/n: Make CoexCoordinator multi-sensor-aware

CoexCoordinator now knows whenever specific types of sensors are
started/stopped.

Note that this change is still a no-op and does not affect any
existing behavior.

Bug: 193089985
Test: atest com.android.server.biometrics
Test: inspect logs
Change-Id: I6f1980ba02febfa0a866e2684fdfc23a1ca664e1

####END####
services/core/java/com/android/server/biometrics/sensors/BiometricScheduler.java
services/core/java/com/android/server/biometrics/sensors/CoexCoordinator.java
services/core/java/com/android/server/biometrics/sensors/UserAwareBiometricScheduler.java
services/core/java/com/android/server/biometrics/sensors/face/aidl/Sensor.java
services/core/java/com/android/server/biometrics/sensors/face/hidl/Face10.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/Sensor.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/Fingerprint21.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/Fingerprint21UdfpsMock.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/BiometricSchedulerTest.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/UserAwareBiometricSchedulerTest.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/face/aidl/SensorTest.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/fingerprint/aidl/SensorTest.java

####START####bf09a9fac033
Merge "Show the generic bouncer on remote input" into sc-dev
####END####
####START####eb636b8213b8
Merge "Fix a couple more issues with canceling the recents animation w/ screenshots" into sc-dev am: 00d2556f71 am: 584679daaf

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302656

Change-Id: Ic04c11357b662bab5ac34dfcb1c311d6cc4a1479

####END####
####START####7a496a97a481
Merge "Fix a couple more issues with canceling the recents animation w/ screenshots" into sc-dev am: 00d2556f71 am: 067e124e02

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302656

Change-Id: I97a308153f01ebf18033ff172fe31c475035199f

####END####
####START####433940e4596c
Merge "speech: queryIntentService-AsUser-" into sc-dev am: c648d0f4b7 am: cc0168cca8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301453

Change-Id: I7313ca8db02857d7ec4b52cd6b480c61d8fd265d

####END####
####START####ca3e08bb4336
Merge "speech: queryIntentService-AsUser-" into sc-dev am: c648d0f4b7 am: 60ae848aac

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301453

Change-Id: Ifc606415b68b16693b40d4f67a0ea2ca064565f4

####END####
####START####8efb0780c733
Merge "Account for recents animation when reporting client visibility" into sc-dev am: 5af8fe680b am: 1b0ad3426a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245722

Change-Id: I426212ffad84c302f2153e44adaf4239747fdd55

####END####
####START####584679daaf7a
Merge "Fix a couple more issues with canceling the recents animation w/ screenshots" into sc-dev am: 00d2556f71

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302656

Change-Id: I3edc9b8c76019a536c74c94d1d576e1566d35267

####END####
####START####b1eb8dabcbc6
Merge "Fix a couple more issues with canceling the recents animation w/ screenshots" into sc-dev am: 00d2556f71

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302656

Change-Id: If6d0b3c81d19d8dc1ed60a58f6908e769eb1f9fb

####END####
####START####cc0168cca868
Merge "speech: queryIntentService-AsUser-" into sc-dev am: c648d0f4b7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301453

Change-Id: I2a901865b04111b96bb41a255ce67e4fd5aec0a9

####END####
####START####1b0ad3426a68
Merge "Account for recents animation when reporting client visibility" into sc-dev am: 5af8fe680b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245722

Change-Id: I16acbece1c16361c3f42a075006fbd28e0672b5f

####END####
####START####d8ca6d792dea
Merge "speech: queryIntentService-AsUser-" into sc-dev am: c648d0f4b7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301453

Change-Id: Id97e85ab0d8b54da7968db45d9a82ce4fa2e3226

####END####
####START####399543eef9f4
Merge "Account for recents animation when reporting client visibility" into sc-dev am: 5af8fe680b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245722

Change-Id: I5066a5f8e3c8839b2cc7ae0d86a5f5f2799a0dfa

####END####
####START####00d2556f711d
Merge "Fix a couple more issues with canceling the recents animation w/ screenshots" into sc-dev
####END####
####START####c648d0f4b758
Merge "speech: queryIntentService-AsUser-" into sc-dev
####END####
####START####5af8fe680bcb
Merge "Account for recents animation when reporting client visibility" into sc-dev
####END####
####START####a5565eb79cfa
Merge "Limit VCNs to one running at a given time" into sc-dev am: dd6c887985

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15315835

Change-Id: I9c5c265402ca7b78cf618c61c0d24576cc89260b

####END####
####START####f89e70d29088
Refrain from returning mutable pending intent in getShortcutIntent

Mutable PendingIntent leads to potential security vulnerabilities, this
CL makes the returning PendingIntent immutable | update current. The
recipeint cannot change the content of the PendingIntent directly, but
the owner can still update the extras of the PendingIntent.

Note: PendingIntent is internally cached in PendingIntentController, so
the owner process do have access to the PendingIntent since
LauncherAppServices called
ActivityManagerService#getPendingIntentActivityAsApp to retrieve the
PendingIntent.

Bug: 190732424
Test: atest ShortcutManagerClientApiTest
Change-Id: Ife8ad7824f061e9e20d31c96f76ceed4edb547cd

####END####
services/core/java/com/android/server/pm/LauncherAppsService.java

####START####d3b1e7028a82
Merge "Ensure VcnGatewayConnection#isQuitting never gets unset after being set" am: fc9e0c982f am: e98f254f96 am: adcba0ef9c am: 0989938dfa

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768623

Change-Id: If15c97f212dfbcb6504a5005b583dcbde9bcc4f4

####END####
####START####0989938dfac2
Merge "Ensure VcnGatewayConnection#isQuitting never gets unset after being set" am: fc9e0c982f am: e98f254f96 am: adcba0ef9c

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768623

Change-Id: Ia129cdf9230d7c77379ed5e9c2a25fdaeb6fc513

####END####
####START####29b3fdd6b657
Ensure VcnGatewayConnection#isQuitting never gets unset after being set

This change ensures that the VcnGatewayConnection can never abort a
quitting command; specifically, if a non-quitting disconnect request is
processed after a quitting disconnect request, the isQuitting value MUST
continue to stay set (as true).

Failure to OR the values results in orphaned VcnGatewayConnection(s),
and the VCN network thrashing.

Additionally reduce verbosity of local logs, to ensure it better
captures failures and logWtf(s)

Bug: 192776413
Test: atest FrameworksVcnTests
Original-Change: https://android-review.googlesource.com/1768623
Merged-In: Iec8dae701838794261957609bae4e270eaa9cdc7
Change-Id: Iec8dae701838794261957609bae4e270eaa9cdc7

####END####
services/core/java/com/android/server/VcnManagementService.java
services/core/java/com/android/server/vcn/Vcn.java
services/core/java/com/android/server/vcn/VcnGatewayConnection.java
services/core/java/com/android/server/vcn/util/OneWayBoolean.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionConnectedStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionConnectingStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionDisconnectedStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionDisconnectingStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionRetryTimeoutStateTest.java

####START####c4f76dd5231a
Account for recents animation when reporting client visibility

- While the current app is still resumed and running in overview, the
  start of a new activity will trigger the current app to pause and be
  added to the stopping list while the new app is passed to the
  existing recents animation via onTaskAppeared() callback. We don't
  actually process the stopping activities until the recents animation
  is done, but pausing will trigger the report client visibility to
  the app if the animation is complete (which triggers the SurfaceView
  to destroy the surface).  This check needs to also account for the
  recents animation that is driving the launching app as well.

Fixes: 184211875
Test: Open an app with a SurfaceView in overview and then launch the
      next app (repeat until you see a blank area where the SV is)
Change-Id: I35d1947795f529b701af22586b23441d5ac55313
Merged-In: I35d1947795f529b701af22586b23441d5ac55313

####END####
services/core/java/com/android/server/wm/ActivityRecord.java

####START####345bc4b54b78
Merge "Account for recents animation when reporting client visibility"
####END####
####START####adcba0ef9c18
Merge "Ensure VcnGatewayConnection#isQuitting never gets unset after being set" am: fc9e0c982f am: e98f254f96

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768623

Change-Id: I418557047f10b0224583f9e99770169356f07fa9

####END####
####START####a1a1ed85855f
Merge changes from topic "biometric-haptic" into sc-dev am: a7b91a1c27 am: 77041ef725

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305458

Change-Id: Ic3dda45eb8782cc8f4459beb1992136e56f7990d

####END####
####START####e53cbf4df311
Limit VCNs to one running at a given time

This change ensures that there is only ever one VCN running at a given
point in time, and that if the device has switched to using a
subscription in a different subscription group, the VCN will immediately
tear down.

This ensures that when on a DSDS device, when the VCN-enabled
subscription is not the default/active subscription, the other
subscription's network will never be outscored by the VCN, and thus get
torn down.

Bug: 190761448
Test: atest FrameworksVcnTests
Test: Manual testing to ensure common functionality
Original-Change: https://android-review.googlesource.com/1767050
Merged-In: I8031fab7502880d38420058451df41f47567c458
Change-Id: I8031fab7502880d38420058451df41f47567c458

####END####
services/core/java/com/android/server/VcnManagementService.java
services/core/java/com/android/server/vcn/TelephonySubscriptionTracker.java
tests/vcn/java/com/android/server/VcnManagementServiceTest.java
tests/vcn/java/com/android/server/vcn/TelephonySubscriptionTrackerTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionTestBase.java

####START####8ef0bc127b70
Merge changes from topic "biometric-haptic" into sc-dev am: a7b91a1c27 am: 03dc717219

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305458

Change-Id: Ieb016fb1aaea47d0be35f6c4abef6eaeb7b7df03

####END####
####START####f990fdc31526
Merge "Prevent fatal exception at AppOpsService$InProgressStartOpEvent#finish" into sc-dev am: defab5707c am: 6591fca0ad

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302655

Change-Id: I99c7c1da868e2b458cc49ed6e5e2cf008aae4218

####END####
####START####03dc717219ec
Merge changes from topic "biometric-haptic" into sc-dev am: a7b91a1c27

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305458

Change-Id: I213c668726be4277462bea2e77a5bbf1b5a61666

####END####
####START####1aea7aa77d48
Merge "Perform oomAdjUpdate prior to scheduling service transactions" into sc-dev am: 72a09019a0 am: 171f20ce67

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302846

Change-Id: I437032e4638ab1952582ce193d6631d51ac25ca7

####END####
####START####6febca5f1d5d
Merge changes from topic "biometric-haptic" into sc-dev am: a7b91a1c27

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305458

Change-Id: I14dc8574eb6e8e3a3b359a35b9442c449f6a511d

####END####
####START####015438ccf757
Merge "Do not specify a workSource when setting a delayed alarm so that the alarm can still wake the device up when the device is idle as the AlarmManager.FLAG_ALLOW_WHILE_IDLE_UNRESTRICTED flag indicates." into sc-dev am: 831f52e0d5 am: 12e040c1ea

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284032

Change-Id: Ibbf1737d40f9a5ccb76fd333667da35930b1161e

####END####
####START####7682316aa2e2
Merge "Prevent fatal exception at AppOpsService$InProgressStartOpEvent#finish" into sc-dev am: defab5707c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302655

Change-Id: Ia57cff2281d8e8836f31b1aaf0f64e84b1e68f5e

####END####
####START####a7b91a1c27a3
Merge changes from topic "biometric-haptic" into sc-dev

* changes:
  2/n: Update fingerprint vibration logic
  1/n: Move UDFPS enroll haptics back to system_server

####END####
####START####898fd2891322
Merge "Perform oomAdjUpdate prior to scheduling service transactions" into sc-dev am: 72a09019a0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302846

Change-Id: Ib2efb4719c217cd7f981ba0e4e187bcba6b80ce3

####END####
####START####74827132952f
Merge "Prevent fatal exception at AppOpsService$InProgressStartOpEvent#finish" into sc-dev am: defab5707c am: 1aed08c2b8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302655

Change-Id: I37765c18d92686cf8aa056c95cebdbd40701518e

####END####
####START####bee70d9b4088
Merge "Perform oomAdjUpdate prior to scheduling service transactions" into sc-dev am: 72a09019a0 am: 8eb4a90dfb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302846

Change-Id: I1f9f8491b3fc34b8fc154726520bb11b7e3ad63c

####END####
####START####11514b4d8f76
Merge "Do not specify a workSource when setting a delayed alarm so that the alarm can still wake the device up when the device is idle as the AlarmManager.FLAG_ALLOW_WHILE_IDLE_UNRESTRICTED flag indicates." into sc-dev am: 831f52e0d5 am: 817b295fa9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284032

Change-Id: I212881cccb3abb7620179f6a2547737cf8cd2643

####END####
####START####1aed08c2b848
Merge "Prevent fatal exception at AppOpsService$InProgressStartOpEvent#finish" into sc-dev am: defab5707c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302655

Change-Id: I837e751493b92cf214b66f80214a513c39f4372d

####END####
####START####28c03ea12b7e
Merge "Do not specify a workSource when setting a delayed alarm so that the alarm can still wake the device up when the device is idle as the AlarmManager.FLAG_ALLOW_WHILE_IDLE_UNRESTRICTED flag indicates." into sc-dev am: 831f52e0d5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284032

Change-Id: I8ecf613309fd8f2ee6b26db1e82639fa249e3cdb

####END####
####START####8eb4a90dfbbd
Merge "Perform oomAdjUpdate prior to scheduling service transactions" into sc-dev am: 72a09019a0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302846

Change-Id: I1482e17319f2d68cbf03d7649630fa7ef04432df

####END####
####START####02cc8b7c5886
Merge "Update kg lock icon logic" into sc-dev am: 91ec11ddad am: 2e5a48be0e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309789

Change-Id: Ide1dc5e8b25d2b839a3c7186c4707feb3ff4fac7

####END####
####START####817b295fa9ec
Merge "Do not specify a workSource when setting a delayed alarm so that the alarm can still wake the device up when the device is idle as the AlarmManager.FLAG_ALLOW_WHILE_IDLE_UNRESTRICTED flag indicates." into sc-dev am: 831f52e0d5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284032

Change-Id: Ic37d70b5a9762642db0eecce3f7d7384ed70c75a

####END####
####START####7a7a02b3af88
Merge "Update kg lock icon logic" into sc-dev am: 91ec11ddad am: a28a3b64c8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309789

Change-Id: I5cf7c732736f1659ad2e2e1e06050782ee11587a

####END####
####START####4fb0c78cf1a7
Fix issue of TvInputManagerService not binding to TvInput services in Kids

Bug: 193923350
Bug: 179737219
Test: verified the binding happens
Change-Id: Ie4cb63c5bc39d6f4986671554866a96e16386814

####END####
services/core/java/com/android/server/tv/TvInputManagerService.java

####START####0cd989717593
Enable specification of 5G network info and carrier configs for ONS changes

Bug: 191878731
Bug: 186688084
Test: Will test locally once partner device and infrastructure is ready.

Change-Id: I7c866741dd86c3d675ea7c4dfe50d0992ab145f1

####END####
telephony/java/android/telephony/AvailableNetworkInfo.java
telephony/java/android/telephony/CarrierConfigManager.java

####START####fc9e0c982f08
Merge "Ensure VcnGatewayConnection#isQuitting never gets unset after being set"
####END####
####START####5a750a5aa135
Merge "Restrict all jobs when the device is too hot."
####END####
####START####defab5707c13
Merge "Prevent fatal exception at AppOpsService$InProgressStartOpEvent#finish" into sc-dev
####END####
####START####72a09019a0e0
Merge "Perform oomAdjUpdate prior to scheduling service transactions" into sc-dev
####END####
####START####89315a9565c5
3/n: Add CoexCoordinator

This change adds CoexCoordinator which intercepts authentication
success/failure signals. The current implementation is pretty much
a no-op and all behavior should still be the same.

Bug: 193089985
Test: Auth on keyguard, BiometricPrompt
Test: Inspect logs, authToken is added when appropriate
Test: atest CoexCoordinatorTest

Change-Id: I53d89e6957da384bcbc2e0fd221d6e5c21b7808f

####END####
services/core/java/com/android/server/biometrics/sensors/AuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/CoexCoordinator.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/CoexCoordinatorTest.java

####START####f2e795953922
SysUI co-ex updates

- Attempt face auth again on udfps start if we're not already
running face auth
- Use udfps touch, as an intent for device entry - so if udfps fails,
but face auth succeeds, enter the device (even if face auth is
non-bypass)

Test: manual
Bug: 193089985
Fixes: 193554105
Change-Id: Ied977fec9009265dac89b7e24c1075ceb2905bfd
Merged-In: Ied977fec9009265dac89b7e24c1075ceb2905bfd

####END####
packages/SystemUI/src/com/android/keyguard/KeyguardUpdateMonitor.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/BiometricUnlockController.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/UdfpsControllerTest.java

####START####4efc11cd0edb
Merge "SysUI co-ex updates"
####END####
####START####80feb40fe6d9
Stop removing all APP_STANDBY_BUCKET_CHANGED messages.

APP_STANDBY_BUCKET_CHANGED messages are for single apps, so it doesn't
make sense to remove all messages whenever any app's standby bucket
changes.

Bug: 193918191
Test: N/A
Change-Id: I981cd3be3cd381c6d00f06e3da9f8e67f157a26b

####END####
apex/jobscheduler/service/java/com/android/server/alarm/AlarmManagerService.java

####START####831f52e0d5ec
Merge "Do not specify a workSource when setting a delayed alarm so that the alarm can still wake the device up when the device is idle as the AlarmManager.FLAG_ALLOW_WHILE_IDLE_UNRESTRICTED flag indicates." into sc-dev
####END####
####START####2e5a48be0e7c
Merge "Update kg lock icon logic" into sc-dev am: 91ec11ddad

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309789

Change-Id: Ibf62d8b49ea48b31f6f6488ecaf86d3684248db5

####END####
####START####6e38687fd26d
Merge "Update kg lock icon logic" into sc-dev am: 91ec11ddad

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309789

Change-Id: Ibc3f017631f29730bd289563e57fb5316c1668ae

####END####
####START####f5f508c01d8c
Throw new IllegalStateException in CallRedirectionService when the call redirection is not initialized yet

Test: Build
Bug: 193482535
Change-Id: I3609362043684249b6d6981fc7d2ab42c676db76

####END####
telecomm/java/android/telecom/CallRedirectionService.java

####START####91ec11ddadfb
Merge "Update kg lock icon logic" into sc-dev
####END####
####START####23885b8a48ef
Merge "Throw exception for immutable PendingIntents"
####END####
####START####252b7958bb37
Camera: Improve logical camera RAW capture docs

- Clarify raw capture behavior for logical camera with backward
compatible approach and MultiResolutionImageReader.
- Some logical camera devices may have identical physical cameras with
different focal length. Allow such logical camera to switch physical
cameras when outputing raw.

Bug: 182217158
Test: Build
Change-Id: I64458683f4eb8be6fc1e35270a8c22864d962be9

####END####
core/java/android/hardware/camera2/CameraMetadata.java

####START####ac5c5b2f2deb
Merge "Use Provider for EdgeBackGestureHandler" into sc-dev am: 8981a5e756 am: 39625b3b0c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15303522

Change-Id: Ia11c6899c76459ba220b4fb8d24523ec223f894f

####END####
####START####126e94e2c2c3
Update kg lock icon logic

- don't animate fp => unlock unless udfps was enrolled
- show a static unlock icon if the device wasn't previously locked

Test: manual
  - swipe to unlock
  - face only
  - fp only
  - co-ex
  - removing biometric auth => swipe to unlock
Bug: 193878791
Change-Id: I35d393383674acb03f06ea58fb8aabc2a820ad7c

####END####
packages/SystemUI/src/com/android/keyguard/LockIconViewController.java

####START####7555f00f5040
Merge "Use Provider for EdgeBackGestureHandler" into sc-dev am: 8981a5e756

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15303522

Change-Id: If25729b974e27831797284312da765df04ec9f3d

####END####
####START####39625b3b0c2d
Merge "Use Provider for EdgeBackGestureHandler" into sc-dev am: 8981a5e756

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15303522

Change-Id: I6aae8bf8a33f8b94f72a8c3b4dcfdd720675b492

####END####
####START####e2907e590632
Merge "Rename VERSION_CODES.T to VERSION_CODES.TIRAMISU" into sc-dev-plus-aosp am: 3a873acfec am: 98f6af0e19

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15304989

Change-Id: Id39862a791e67c9c47c33b9aca5adefd08d428a5

####END####
####START####63ae4a405881
Return the ProcessErrorStateInfo records for the caller's UID only

For regular apps, the ActivityManager.getProcessesInErrorState()
will only return ProcessErrorStateInfo records for the processes
running as the caller's uid, unless the caller has the DUMP permission

Bug: 191058227
Test: atest CtsAppTestCases:ActivityManagerTest
Test: Manual - b/191058227#comment4
Change-Id: I1c5b80b00a9380849ed874e4febe49ee9a51e1f1

####END####
core/java/android/app/ActivityManager.java
services/core/java/com/android/server/am/ActivityManagerService.java

####START####8981a5e756c9
Merge "Use Provider for EdgeBackGestureHandler" into sc-dev
####END####
####START####2c904ea562b4
2/n: Update fingerprint vibration logic

1) adds "mShouldVibrate" as a property for AcquisitionClient.
   Philosophically, all clients that inherit this class should be able
   to decide if haptics occur in onAuthentication*
2) UDFPS AIDL enroll haptic occurs when ACQUIRED_GOOD is received
3) UDFPS AIDL auth haptic continues to happen when success/reject is
   known (documenting reason in the bug below)

Test: manual enroll+auth
Test: atest com.android.server.biometrics
Test: adb shell dumpsys vibrator_manager

Bug: 193089985

Change-Id: I8ae60f99d36a4f49985411001670df3ee108768f

####END####
services/core/java/com/android/server/biometrics/sensors/AcquisitionClient.java
services/core/java/com/android/server/biometrics/sensors/AuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/EnrollClient.java
services/core/java/com/android/server/biometrics/sensors/face/aidl/FaceAuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/face/aidl/FaceDetectClient.java
services/core/java/com/android/server/biometrics/sensors/face/hidl/FaceAuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintAuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintDetectClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintEnrollClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintProvider.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/FingerprintAuthenticationClient.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/hidl/FingerprintDetectClient.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/AcquisitionClientTest.java
services/tests/servicestests/src/com/android/server/biometrics/sensors/BiometricSchedulerTest.java

####START####830c6797cd26
Allow GenericDocument accept a String property longer than 20_000.

This limit was removed from the AppSearch Jetpack API meaning that
a client could construct a GenericDocument successfully, but then
have a PutDocuments call fail when converting from
androidx.appsearch.GenericDocument
to android.appsearch.GenericDocument.

Icing still has a total document size limit which is 16 MiB.
The put call will fail if it trying to write such document.


Bug: 192909904
Test: GenericDocumentTest
Change-Id: I86f97acc3a8e0f1c25fadf597aed9f42a2c493eb

####END####
apex/appsearch/framework/java/external/android/app/appsearch/GenericDocument.java
core/tests/coretests/src/android/app/appsearch/external/app/GenericDocumentTest.java

####START####98f6af0e1982
Merge "Rename VERSION_CODES.T to VERSION_CODES.TIRAMISU" into sc-dev-plus-aosp am: 3a873acfec

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15304989

Change-Id: I71bd32519b13efa53456ef1839f5ccb03dc25229

####END####
####START####e8c548fd0221
Ensure VcnGatewayConnection#isQuitting never gets unset after being set

This change ensures that the VcnGatewayConnection can never abort a
quitting command; specifically, if a non-quitting disconnect request is
processed after a quitting disconnect request, the isQuitting value MUST
continue to stay set (as true).

Failure to OR the values results in orphaned VcnGatewayConnection(s),
and the VCN network thrashing.

Additionally reduce verbosity of local logs, to ensure it better
captures failures and logWtf(s)

Bug: 192776413
Test: atest FrameworksVcnTests
Change-Id: Iec8dae701838794261957609bae4e270eaa9cdc7

####END####
services/core/java/com/android/server/VcnManagementService.java
services/core/java/com/android/server/vcn/Vcn.java
services/core/java/com/android/server/vcn/VcnGatewayConnection.java
services/core/java/com/android/server/vcn/util/OneWayBoolean.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionConnectedStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionConnectingStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionDisconnectedStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionDisconnectingStateTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionRetryTimeoutStateTest.java

####START####3f7c4a3c0d50
Check MissingMethodFlags.COMMIT_CORRECTION at the right place

This is a follow up CL to my previous CL [1], which aimed to put an
early-exit check for

  InputConnection#commitCorrection(CorrectionInfo)

but mistakenly put it in

  InputConnection#commitCompletion(CompletionInfo).

With this CL the early-exit check will be placed at the right place.

 [1]: I3c58fadd924fad72cb984f0c23d3099fd0295c64
      19a80a1e807acd00bec999eaac7812da6ffce954

Fix: 193907158
Test: atest CtsInputMethodTestCases:InputConnectionEndToEndTest
Change-Id: I497628165072c73d0e279f89afe0d8730531ecfc

####END####
core/java/android/inputmethodservice/RemoteInputConnection.java

####START####2d6a545e3042
Only construct real Throwable objects in AndroidFuture.readThrowable().

Bug: 186530450
Test: atest CtsSecurityTestCases:android.security.cts.AndroidFutureTest
Change-Id: Icc5ce702f0cd84e9136dee3c65f63619df697358

####END####
core/java/com/android/internal/infra/AndroidFuture.java

####START####3a873acfec12
Merge "Rename VERSION_CODES.T to VERSION_CODES.TIRAMISU" into sc-dev-plus-aosp
####END####
####START####3e575e58cc2a
Add PCM float profile if extended precision PCM shows but not pcm float.

This is required for backwards compatibility. This ensures pre-S apps
that look for pcm float continue to see that encoding if the device
supports extended precision integers.

Test: atest AudioManagerTest
Bug: 193747274
Change-Id: Ia244bdcd51520dd082a292baab54f1795ccccaea

####END####
media/java/android/media/AudioDeviceInfo.java

####START####0b577cfbd342
Throw exception for immutable PendingIntents

Fixes: 193833333
Test: Compile
Change-Id: I2ba9e19f8962ef172ecb8defa77a352ad7073ca2

####END####
core/java/android/hardware/location/ContextHubManager.java

####START####5e8268d8afb1
Merge "Only load the overflow data once" into sc-v2-dev am: 6de523e30b am: e99dc522fe

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289567

Change-Id: I23b22e9660b3d534e9df4fb4c6eec2144249aa93

####END####
####START####c5749f98ce76
Merge "Gate CDMA Supplementary Services on a CarrierConfig item" into sc-dev am: c3e6fc7a05 am: a04c9895ee

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305873

Change-Id: I2a6b6f8e342298f17b00f382bbdca7bd38711604

####END####
####START####3a013eaa9f6d
Merge "Gate CDMA Supplementary Services on a CarrierConfig item" into sc-dev am: c3e6fc7a05 am: 181a26a492

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305873

Change-Id: I2faee180a069ac1f58b7a6593594d91f9b968969

####END####
####START####e99dc522fe2f
Merge "Only load the overflow data once" into sc-v2-dev am: 6de523e30b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289567

Change-Id: I2ebd8a49581b6e8e8535a04b480595ca8cb7abdb

####END####
####START####911d4646f3ba
Check callingpackage for calling UID consistency with phoneAccountHandle.

Test: manual
Bug: 192663798
Bug: 192663553
Change-Id: Idd2ea20cd17933f86011b8ddc1037903725c2461

####END####
telecomm/java/android/telecom/TelecomManager.java

####START####6ddb9a0bea39
Use ReentrantReadWriteLock in the compat framework

The compat config is read frequently but modified infrequently (i.e.
only when new overrides are added), so use a ReentrantReadWriteLock
instead of the default reentrant lock.
Test: atest CompatConfig
Bug: 191384882
Bug: 191718541

Change-Id: I21da41ea51bb722c45245eccb02652b375be9f12

####END####
services/core/java/com/android/server/compat/CompatConfig.java

####START####181a26a4923e
Merge "Gate CDMA Supplementary Services on a CarrierConfig item" into sc-dev am: c3e6fc7a05

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305873

Change-Id: I2e266f0461e522558f637f5604eebaa3104f8182

####END####
####START####79109d8f67ba
Merge "Gate CDMA Supplementary Services on a CarrierConfig item" into sc-dev am: c3e6fc7a05

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305873

Change-Id: I11c81eccd2fa54d71a907845d50be9dde94eb7d8

####END####
####START####c3e6fc7a0546
Merge "Gate CDMA Supplementary Services on a CarrierConfig item" into sc-dev
####END####
####START####6de523e30b35
Merge "Only load the overflow data once" into sc-v2-dev
####END####
####START####72f5a4bc29fd
Merge "Fix NPE when calling PasswordViewEntry.getWindowInsetsController().hide()" into sc-dev am: 5235bc493d am: 9d64adaf56

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309902

Change-Id: I01c01409ba71e64d785b250b7724878063e7cd25

####END####
####START####dcf831a3e29d
Merge "Fix NPE when calling PasswordViewEntry.getWindowInsetsController().hide()" into sc-dev am: 5235bc493d am: 609020b92f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309902

Change-Id: I054de0bb6a29d911d5be3d9ee95fb7a77ff899c1

####END####
####START####b13b6fb7fc29
Generalize window bounds for layout

This allows the windows belonging to an activity can have override
bounds. Such as a starting window can have larger bounds than the
activity which is embedded to a smaller region.

Bug: 189385912
Test: DisplayContentTests

Change-Id: I833817f961e9b9d80080b94c1b6682ea49ca4c8e

####END####
services/core/java/com/android/server/wm/DisplayPolicy.java
services/core/java/com/android/server/wm/WindowState.java
services/tests/wmtests/src/com/android/server/wm/DisplayContentTests.java

####START####9d64adaf562b
Merge "Fix NPE when calling PasswordViewEntry.getWindowInsetsController().hide()" into sc-dev am: 5235bc493d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309902

Change-Id: Ie6ec75abf608e00965afc8dc602d22fd9639c45d

####END####
####START####737b8ac1976e
Merge "Fix NPE when calling PasswordViewEntry.getWindowInsetsController().hide()" into sc-dev am: 5235bc493d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15309902

Change-Id: I1a33101dd5aac59aee2f321f1036725fc40edd80

####END####
####START####07d1da7a9fa3
Merge "Merge "ActivityManagerService: add new lmkd kill reason" am: aebf935349 am: 326599cf76 am: d7fbb1fe98" into sc-v2-dev-plus-aosp am: b921118eda

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768611

Change-Id: I76efa86ce35935fb7872228240d6898c3a0cf20c

####END####
####START####5235bc493d96
Merge "Fix NPE when calling PasswordViewEntry.getWindowInsetsController().hide()" into sc-dev
####END####
####START####034cf885c25e
Merge "Merge "Don't query a null AccessibiiltyNodeInfo when populating ViewStructure" into sc-dev am: ea5ce681f3 am: 6ee44d7939" into sc-v2-dev-plus-aosp
####END####
####START####37b99ca35baa
Merge "Don't query a null AccessibiiltyNodeInfo when populating ViewStructure" into sc-dev am: ea5ce681f3 am: 6ee44d7939

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305983

Change-Id: I50b60b4d91be5d301b15783c47e13c67b3b96245

####END####
####START####84a913e80d83
Merge "Don't query a null AccessibiiltyNodeInfo when populating ViewStructure" into sc-dev am: ea5ce681f3 am: 5ba0eeb0db

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305983

Change-Id: Id4b67823ded760c3ecb16dbba2053a8c4498622a

####END####
####START####132e4a9bf4b0
Merge "ActivityManagerService: add new lmkd kill reason" am: aebf935349 am: 326599cf76 am: d7fbb1fe98

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768611

Change-Id: Ibf02f355a27f6c5d57976c6ce1852c750449af99

####END####
####START####c1f6d61d548b
Merge "Null safe package name in AppOps writeState" into sc-dev am: 0abd07b3fb am: 65f5d4f3e6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301695

Change-Id: Ie7f301f27768a3a64a988867bac4fd017f7acf33

####END####
####START####fedef8bce7cb
Merge "Null safe package name in AppOps writeState" into sc-dev am: 0abd07b3fb am: 4571c1771a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301695

Change-Id: I818dd746b45da58b8ff4893ad007ea677e1a7066

####END####
####START####3d23e5498db2
Merge "Correctly set trusted AttributionSource in RecognitionService" into sc-dev am: 0669fb0bfa am: 777a962541

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305876

Change-Id: I77b3a25cd276d4b71c4e5157bdd1f4f5974685d9

####END####
####START####2df92f5460dc
Merge "Don't query a null AccessibiiltyNodeInfo when populating ViewStructure" into sc-dev am: ea5ce681f3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305983

Change-Id: I113cb66c172204f898c12e77df5a0b85df643d1e

####END####
####START####6dde8a47f534
Merge "Correctly set trusted AttributionSource in RecognitionService" into sc-dev am: 0669fb0bfa am: ecb07cdff9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305876

Change-Id: I84a0612ef7e3eee4301c95059077854e42116101

####END####
####START####6ee44d7939c1
Merge "Don't query a null AccessibiiltyNodeInfo when populating ViewStructure" into sc-dev am: ea5ce681f3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305983

Change-Id: Icd17aeb6cdb7b06cf6bb097b225f23f884869ee4

####END####
####START####d7fbb1fe985a
Merge "ActivityManagerService: add new lmkd kill reason" am: aebf935349 am: 326599cf76

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768611

Change-Id: Ic0c3fc46155b3d3845a2e82948147ed52248e87c

####END####
####START####ea5ce681f312
Merge "Don't query a null AccessibiiltyNodeInfo when populating ViewStructure" into sc-dev
####END####
####START####0f5068fa09f2
Merge "Null safe package name in AppOps writeState" into sc-dev am: 0abd07b3fb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301695

Change-Id: I1ad1a9e7ef54ccdaddfd620d0679c67f0df9ecd8

####END####
####START####777a962541df
Merge "Correctly set trusted AttributionSource in RecognitionService" into sc-dev am: 0669fb0bfa

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305876

Change-Id: I7db6bf5e4f450a8cdb5e0f4a4f1593b966a71fc0

####END####
####START####65f5d4f3e67f
Merge "Null safe package name in AppOps writeState" into sc-dev am: 0abd07b3fb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301695

Change-Id: I016f141621cc890bb015d6c08688897dd7d47389

####END####
####START####0d196dc4227e
Merge "Correctly set trusted AttributionSource in RecognitionService" into sc-dev am: 0669fb0bfa

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15305876

Change-Id: I7263ada9e311fef22810fe54a09e728bc3a6ade2

####END####
####START####592bacb77848
Require non-null HAT for fingerprint enrollment

Fingerprint service providers expect to be given a non-null HAT and will
crash otherwise. Documents that any HAT passed to these providers must be
non-null to avoid crashing system server. Also adds logging to catch a
potential source of a null HAT.

Test: Manual

Bug: 193811614
Change-Id: Ib05541653eab04390e9928ada37bde8d088cbc84

####END####
services/core/java/com/android/server/biometrics/sensors/fingerprint/FingerprintService.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/ServiceProvider.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintProvider.java
services/core/java/com/android/server/locksettings/LockSettingsService.java

####START####c577086e39b8
Merge "Use Provider for EdgeBackGestureHandler"
####END####
####START####0abd07b3fb08
Merge "Null safe package name in AppOps writeState" into sc-dev
####END####
####START####0669fb0bfa9f
Merge "Correctly set trusted AttributionSource in RecognitionService" into sc-dev
####END####
####START####aebf93534923
Merge "ActivityManagerService: add new lmkd kill reason"
####END####
####START####8bcd04b7dfca
Show the generic bouncer on remote input

Instead of directly showing the pin/pattern/password bouncer.

Test: manual, atest StatusBarRemoteInputCallbackTest
Fixes: 192869012
Change-Id: Ia38a6b5569d63ca37f4cdba922f60f0359c38dd7

####END####
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarRemoteInputCallback.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarRemoteInputCallbackTest.java

####START####06506eaf4fd5
adb shell pm remove-user --wait

Adds a --wait flag for adb shell pm remove-user.

Test: adb shell pm remove-user --wait <userId>
Change-Id: If15e6e5fd337a8789c51ce5cc31d7703abf4254b

####END####
services/core/java/com/android/server/pm/PackageManagerShellCommand.java

####START####127bab7ce2b5
Merge "Showing 8 tiles in collapsed Quick Settings in split shade" into sc-v2-dev am: 59f92c5738 am: c37f463aca

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284434

Change-Id: I3118bd72c594bfdca6828d919969ded2fdca1985

####END####
####START####8a82103b2e76
SysUI co-ex updates

- Attempt face auth again on udfps start if we're not already
running face auth
- Use udfps touch, as an intent for device entry - so if udfps fails,
but face auth succeeds, enter the device (even if face auth is
non-bypass)

Test: manual
Bug: 193089985
Change-Id: Ied977fec9009265dac89b7e24c1075ceb2905bfd

####END####
packages/SystemUI/src/com/android/keyguard/KeyguardUpdateMonitor.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/BiometricUnlockController.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/UdfpsControllerTest.java

####START####4eb44d19a4e1
Replace DateView with VariableDateView (1/2)

VariableDateView adjusts its pattern (long, short, or empty) depending
on how much space it has to show. This is done from a controller.

Keep DateView for now and replace in next CL for compatibility

Also, move `updateAnimators` out of `onMeasure`, as it creates new
objects.

Test: manual
Test: atest VariableDateViewControllerTest
Fixes: 192574271
Change-Id: I547a2f035cfc7f9eaa9bdea37846a3ba4fbe1475

####END####
packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeader.java
packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeaderController.java

####START####3d27f6d51986
Merge "Use '!' instead of 'x' in signal drawable" into sc-dev am: e850823da0 am: 57e372bc2a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14946255

Change-Id: If6df3bd8ad71bf8a26be22280a9e38d913d0b3f0

####END####
####START####40b977329195
Merge "Use '!' instead of 'x' in signal drawable" into sc-dev am: e850823da0 am: 0088aed859

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14946255

Change-Id: I4a2dd7b4931d7854d34025a4c8637d3507b5ddde

####END####
####START####57e372bc2a4d
Merge "Use '!' instead of 'x' in signal drawable" into sc-dev am: e850823da0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14946255

Change-Id: I8f0d4a69c6e4c3196290736084645bbf7d93dcb5

####END####
####START####43d575780938
Merge "Use '!' instead of 'x' in signal drawable" into sc-dev am: e850823da0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14946255

Change-Id: I19de25c9534fff82dea9999c3db4800f65186f2a

####END####
####START####e850823da0be
Merge "Use '!' instead of 'x' in signal drawable" into sc-dev
####END####
####START####c37f463acab6
Merge "Showing 8 tiles in collapsed Quick Settings in split shade" into sc-v2-dev am: 59f92c5738

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284434

Change-Id: Ic92992045c592ca352b91357c7cebe7e47f0b5a3

####END####
####START####59f92c5738fe
Merge "Showing 8 tiles in collapsed Quick Settings in split shade" into sc-v2-dev
####END####
####START####c0719ec67366
Merge "HDMICEC: Add equals test for CodecSad" am: 2c677b190d am: f2ba048e8a am: 79d21ae37a am: 1f0062eb9f

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489238

Change-Id: I781ff66c51bbbf4ec0b4aa0f5ea7325b30cd3463

####END####
####START####53f6b7939bca
Stop animation when screen times out and the user turns on the phone.

When screen turns on, display off sleep token and keyguard sleep token
are both removed. However it's not deterministic which one is removed
first, so we have to take care both cases.

Test: atest KeyguardTransitionTests and manual.
  1. set lock mode to none (keep showing Settings activity)
  2. wait until the screen times out
  3. tap screen to turn on the screen
  4. verity no animation is applied on the Settings activity
Bug: 189438446
Change-Id: I2f4dd4f62b5c52f50e92bd405bea9a23e07217b8

####END####
services/core/java/com/android/server/wm/KeyguardController.java
services/core/java/com/android/server/wm/RootWindowContainer.java

####START####1f0062eb9f47
Merge "HDMICEC: Add equals test for CodecSad" am: 2c677b190d am: f2ba048e8a am: 79d21ae37a

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489238

Change-Id: I2946a49b3b4d92974d5b9d7c15a9a7015549e26c

####END####
####START####79d21ae37a5e
Merge "HDMICEC: Add equals test for CodecSad" am: 2c677b190d am: f2ba048e8a

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1489238

Change-Id: I983e14ff0a8b67b41ffda5d56db04e924a1ec67c

####END####
####START####40e0f1de65aa
Merge "sysui: show security footer on the bottom when in split shade mode" into sc-v2-dev am: 69635bde10 am: 7742083cc3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14937208

Change-Id: Ia1b6239ec4fba4ae21741278796266e74a314e28

####END####
####START####7742083cc39f
Merge "sysui: show security footer on the bottom when in split shade mode" into sc-v2-dev am: 69635bde10

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14937208

Change-Id: Ia998d8380f055c55efaabf0529bdfd21d0b5cca9

####END####
####START####78fd4b230341
Use Provider for EdgeBackGestureHandler

Ensures that EdgeBackGestureHandler is not a singleton.

Fixes: 193758967
Test: atest SystemUITests
Change-Id: I13f0130b57cf19d2ec8c3c4285a6785aba076486
Merged-In: I13f0130b57cf19d2ec8c3c4285a6785aba076486

####END####
packages/SystemUI/src/com/android/systemui/Dependency.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarView.java
packages/SystemUI/src/com/android/systemui/navigationbar/gestural/EdgeBackGestureHandler.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarButtonTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTransitionsTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NavigationBarContextTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NearestTouchFrameTest.java

####START####69635bde102a
Merge "sysui: show security footer on the bottom when in split shade mode" into sc-v2-dev
####END####
####START####2c677b190d97
Merge "HDMICEC: Add equals test for CodecSad"
####END####
####START####e47ce92989b6
sysui: show a drag handler when QS is collapsed in split shade

Fixes: 187489358
Test: manual testing
Change-Id: I287f9cc1954b92f2bca4a4c95ffe3829c0ddafd3

####END####
packages/SystemUI/src/com/android/systemui/qs/QSContainerImpl.java
packages/SystemUI/src/com/android/systemui/qs/QSFragment.java

####START####120ae3dbedca
Fix NPE when calling PasswordViewEntry.getWindowInsetsController().hide()

As PasswordViewEntry didn't always attached to KeyguardPasswordView,
check if the view is attached in case NPE happen when getting null
WindowInsetsController

Fix: 192644416
Test: manual test as issue steps
Test: 1) make a security lock
      2) unlocked to go to launcher
      3) turn off screen
      4) check the log and make sure no crash log.
Change-Id: I13897f05576150b2f5e867c43d20efb02e681cef

####END####
packages/SystemUI/src/com/android/keyguard/KeyguardPasswordViewController.java

####START####7be5b9d5c585
Merge "Fix navigation bar icon color is not optimized for a dimming dialog" into sc-v2-dev am: eae31f517e am: 5f379bef3a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301167

Change-Id: I1f48056149e903706bfb1e096f18562d4bfc1981

####END####
####START####87d584ce12bc
Merge "Add a lock for call add/remove operations to avoid ConcurrentModificationException." am: 584003dd0d am: cb477fc498 am: d6217b06d8 am: ae946847f8

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768612

Change-Id: I5751e51fabaace6826fbd4b48a70bcc7808bb54c

####END####
####START####ba527220f1a7
Add accessibility messages to privacy chip on tv.

Talkback announces when either camera or mic started/stopped recording.

Test: manual using Duo, Katniss and voice search in YouTube
Bug: 193763487
Change-Id: I581c3e88cd1e3620a1a562e60444539ab6d3dc30

####END####
packages/SystemUI/src/com/android/systemui/privacy/television/TvOngoingPrivacyChip.java

####START####5f379bef3ac5
Merge "Fix navigation bar icon color is not optimized for a dimming dialog" into sc-v2-dev am: eae31f517e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301167

Change-Id: I1557d865dc30ac5e57e4dc5ad7921829b354329d

####END####
####START####e84ebfc0fcbc
Merge "Add API to get GPU private memory"
####END####
####START####ae946847f80f
Merge "Add a lock for call add/remove operations to avoid ConcurrentModificationException." am: 584003dd0d am: cb477fc498 am: d6217b06d8

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768612

Change-Id: Ie4e5c752570ac7181b81a6d1d49e2cfbf2769b0f

####END####
####START####eae31f517e0e
Merge "Fix navigation bar icon color is not optimized for a dimming dialog" into sc-v2-dev
####END####
####START####555aa8a7fddb
HDMICEC: Add equals test for DeviceConfig

Add equals test for nested class class DeviceConfig in HdmiUtils.

Bug: 168713324
Test: atest HdmiUtilsTest#testEqualsDeviceConfig
Change-Id: I702a24494ef28752bb764e0843b969ae3b45b6f4
Merged-In: I702a24494ef28752bb764e0843b969ae3b45b6f4

####END####
services/tests/servicestests/src/com/android/server/hdmi/HdmiUtilsTest.java

####START####d6217b06d83d
Merge "Add a lock for call add/remove operations to avoid ConcurrentModificationException." am: 584003dd0d am: cb477fc498

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1768612

Change-Id: Icf9b0cbb36422f725a8808f771dca7a45df68e0d

####END####
####START####981814f10ce6
HDMICEC: Add equals test for CodecSad

Add equals test for nested class class CodecSad in HdmiUtils.

Bug: 168713324
Test: atest HdmiUtilsTest#testEqualsCodecSad
Change-Id: I5991629458ef06d9feaabec55f85c0f88368b301
Merged-In: I5991629458ef06d9feaabec55f85c0f88368b301

####END####
services/tests/servicestests/src/com/android/server/hdmi/HdmiUtilsTest.java

####START####584003dd0d5d
Merge "Add a lock for call add/remove operations to avoid ConcurrentModificationException."
####END####
####START####3294ddb24183
Merge "Transform NFC Intent to provisioning Intent"
####END####
####START####500e2b146d2b
Fix One-handed tutorial looks janky on entering transition

According to systrace, one-handed-tutorial-overlay got
jank problem(SurfaceFlinger GPU Deadline Missed,
App Deadline Missed, Buffer stuffing).

1.setLayerType(LAYER_TYPE_HARDWARE) when create targetViewContainer
  setLayerType(LAYER_TYPE_NONE) when removeTutorialFromWindowManager
2.Rename isShowing() to isAttached()
3.Remove redundant float casting
4.Remove redundant increment param

Test: manual trigger OHM
Test: atest WMShellUnitTests
Bug: 193589897
Change-Id: Ieec397795b46dee9ca04375bfc26b09441688d08

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/onehanded/OneHandedAnimationController.java
libs/WindowManager/Shell/src/com/android/wm/shell/onehanded/OneHandedTutorialHandler.java
libs/WindowManager/Shell/tests/unittest/src/com/android/wm/shell/onehanded/OneHandedTutorialHandlerTest.java

####START####420036710b6a
Fix OHM H/W key shortcut dosn't work appropriately

When one-handed mode disabled
1. Turn on the shortcut of the OHM with hold volume keys
2. Hold the volume keys
Should trigger one-anded mode

Due to S/W & H/W shortcut keys are mapping to different settings
S/W : ACCESSIBILITY_BUTTON_TARGETS
H/W : ACCESSIBILITY_SHORTCUT_TARGET_SERVICE
We should check both status of the them.

Bug: 193411296
Test: atest WMShellUnitTests
Change-Id: I3994ab89fd6163c283969cc3175877e29b44c67a

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/onehanded/OneHandedSettingsUtil.java

####START####fc546a96c4f3
sysui: show security footer on the bottom when in split shade mode

When showing the notification shade in split mode, the security footer
should always be shown after the footer. This also updates resources to
have a best usage of configs and dimensions.

Fixes: 188906516
Test: Added tests to QSPanelTest
Change-Id: Iea29490aa73bc4fb3fe3cce82e181a22adca2937

####END####
packages/SystemUI/src/com/android/systemui/qs/QSPanel.java
packages/SystemUI/src/com/android/systemui/qs/QSPanelController.java
packages/SystemUI/src/com/android/systemui/qs/QSPanelControllerBase.java
packages/SystemUI/tests/src/com/android/systemui/qs/QSPanelTest.java

####START####5a485126d8a9
Reset HotwordDetectionConnection when VoiceInteractionService crashes

I use the command "adb shell kill <pid>" and "adb shell am crash
<package>" to test, it works well.

Bug: 193421614
Test: manual test
Test: atest CtsVoiceInteractionTestCases
Test: atest CtsVoiceInteractionTestCases --instant
Change-Id: I53206f07801b0fac588cb23fa2b91cac561547ed

####END####
services/voiceinteraction/java/com/android/server/voiceinteraction/VoiceInteractionManagerServiceImpl.java

####START####832742e0280e
Merge "Make AudioManager.getReportedSurroundFormats a TestApi" into sc-dev am: 0077afd88a am: b4630c8743

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14840460

Change-Id: I5b2506d77e9d481fa698b5f710007b861127b4dd

####END####
####START####b4630c8743cd
Merge "Make AudioManager.getReportedSurroundFormats a TestApi" into sc-dev am: 0077afd88a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14840460

Change-Id: Ie9d1c4e039ce547eca7f3e427fa80a6fc08a963d

####END####
####START####4559e5b9d55a
Merge "Make AudioManager.getReportedSurroundFormats a TestApi" into sc-dev am: 0077afd88a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14840460

Change-Id: I9ae1460e47528ffb38d00ed85a259d9e2e5077b6

####END####
####START####46aabaa06e97
Fix navigation bar icon color is not optimized for a dimming dialog

Bug: 193825236
Test: test passed on forrest
Change-Id: Ia898847d3eccc6408c6c77a56e0a935d694316fe

####END####
services/core/java/com/android/server/wm/DisplayPolicy.java

####START####0077afd88a42
Merge "Make AudioManager.getReportedSurroundFormats a TestApi" into sc-dev
####END####
####START####84fc8046afa7
Merge "Clean up previous DA organizer when registering" into sc-dev am: e032c8face am: aa35c3d407

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15106415

Change-Id: I5a3e2fe1bf75196a579552c33d858831b7de8b5f

####END####
####START####66a80d74bd7d
Merge "Clean up previous DA organizer when registering" into sc-dev am: e032c8face am: 815d2275f0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15106415

Change-Id: I6e1cfae269acf123ee2c1ce169e29dbf91f596ac

####END####
####START####0f958f85f15b
Merge "Allow TaskFragmentOrganizer to apply WCT without permission" into sc-v2-dev am: 5849a2b5e3 am: b33c498d7d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15264526

Change-Id: I1736e89cc0b6a6b82dda877725f5481107d56136

####END####
####START####aa35c3d40765
Merge "Clean up previous DA organizer when registering" into sc-dev am: e032c8face

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15106415

Change-Id: Ibbd8d506f450fbe1c5cc337e95759cb8403e7d0e

####END####
####START####fa3e41dd25af
Merge "Clean up previous DA organizer when registering" into sc-dev am: e032c8face

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15106415

Change-Id: Ifcafa406b33b534bcea0319437fa8d4be2e1f233

####END####
####START####b33c498d7dd5
Merge "Allow TaskFragmentOrganizer to apply WCT without permission" into sc-v2-dev am: 5849a2b5e3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15264526

Change-Id: I8a431df7d6fb2004df6e32571fb08ce474a9cd92

####END####
####START####e032c8face20
Merge "Clean up previous DA organizer when registering" into sc-dev
####END####
####START####5849a2b5e3af
Merge "Allow TaskFragmentOrganizer to apply WCT without permission" into sc-v2-dev
####END####
####START####86cf9050d819
Merge "Prevent having empty task added back into TDA" into sc-dev am: f4690485e1 am: 992c37ed9a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15298116

Change-Id: I079e477c609fbcb3caea7b4e4c110d854e313500

####END####
####START####c6af8edd3563
Merge "Make ImePerfTest wait for animation end" into sc-dev am: 28a77d5846 am: 7a61b48724

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15161272

Change-Id: I51318a7165bfc5d874fba258a2b4d876024d52cc

####END####
####START####261ef7d3abfd
Merge "Prevent having empty task added back into TDA" into sc-dev am: f4690485e1 am: 913bafa67a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15298116

Change-Id: I4d62ff95923597bde3191c69285b344f14ff7a91

####END####
####START####463bbf3d2fbe
Merge "Make ImePerfTest wait for animation end" into sc-dev am: 28a77d5846 am: 8c6398c72d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15161272

Change-Id: I20dfb12a3c6b7f41e1c025e22c67dac0c3c0c719

####END####
####START####5f711c452557
Merge "Remove unused utility API."
####END####
####START####992c37ed9ae2
Merge "Prevent having empty task added back into TDA" into sc-dev am: f4690485e1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15298116

Change-Id: I058b42891266a7f8bbe526a1adc5517706823dc1

####END####
####START####7a61b48724e0
Merge "Make ImePerfTest wait for animation end" into sc-dev am: 28a77d5846

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15161272

Change-Id: Ie87d0a6968db3b4d68e913da62bd808e3d09643a

####END####
####START####3e2af07fda92
Merge "Prevent having empty task added back into TDA" into sc-dev am: f4690485e1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15298116

Change-Id: I8ff2422f834c0f62547079075fc06a64e0e6c411

####END####
####START####29cd6f010f10
Merge "Make ImePerfTest wait for animation end" into sc-dev am: 28a77d5846

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15161272

Change-Id: I525cc71e8f612fdf37722a7a085c47adb245a8a3

####END####
####START####f4690485e11c
Merge "Prevent having empty task added back into TDA" into sc-dev
####END####
####START####2821e5d46f78
Refactor PackageParser (12/n)

Replace PackageParser.PackageParserException by either using the
PraseResult or throwing a more generic Exception in order to move
away from PackageParser.

Bug: 174723245
Test: m docs
Test: atest -p core/java/android/content/pm \
        core/java/android/util/apk \
        services/core/java/com/android/server/pm \
	services/core/java/com/android/server/integrity
Change-Id: I7ba3e693e636caa869641141ed83383326c67809

####END####
core/java/android/content/pm/PackageParser.java
core/java/android/content/pm/dex/DexMetadataHelper.java
core/java/android/content/pm/parsing/ParsingPackageUtils.java
core/java/android/content/pm/split/DefaultSplitAssetLoader.java
core/java/android/content/pm/split/SplitAssetDependencyLoader.java
core/java/android/content/pm/split/SplitAssetLoader.java
core/java/android/util/apk/ApkSignatureVerifier.java
core/tests/coretests/src/android/content/pm/PackageManagerTests.java
services/core/java/com/android/server/integrity/AppIntegrityManagerServiceImpl.java
services/core/java/com/android/server/pm/ApexManager.java
services/core/java/com/android/server/pm/ApkChecksums.java
services/core/java/com/android/server/pm/PackageInstallerSession.java
services/core/java/com/android/server/pm/PackageManagerException.java
services/core/java/com/android/server/pm/PackageManagerService.java
services/core/java/com/android/server/pm/ParallelPackageParser.java
services/core/java/com/android/server/pm/StagingManager.java
services/core/java/com/android/server/pm/parsing/PackageInfoUtils.java
services/core/java/com/android/server/pm/parsing/PackageParser2.java
services/core/java/com/android/server/pm/parsing/pkg/AndroidPackageUtils.java
services/tests/servicestests/src/com/android/server/pm/dex/DexMetadataHelperTest.java
services/tests/servicestests/src/com/android/server/pm/parsing/PackageParserLegacyCoreTest.java

####START####28a77d5846bb
Merge "Make ImePerfTest wait for animation end" into sc-dev
####END####
####START####c951dc23920f
Merge "Using WindowInsets API to hide keyboard on LockScreen when screen-off" into sc-dev am: efda0f9277 am: e3da7eb685

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287621

Change-Id: I8e206cc9e3b452ac4cef1419e9d8915507e421d1

####END####
####START####6e56a35b3525
Merge "Using WindowInsets API to hide keyboard on LockScreen when screen-off" into sc-dev am: efda0f9277 am: 2346929663

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287621

Change-Id: Ia6bcae725d895e682e657d9d38d2c02f7c091427

####END####
####START####e3da7eb68527
Merge "Using WindowInsets API to hide keyboard on LockScreen when screen-off" into sc-dev am: efda0f9277

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287621

Change-Id: I9bfb8026116fc4f66eadd3156aee5e3582966c03

####END####
####START####d0c274537dc8
Merge "Using WindowInsets API to hide keyboard on LockScreen when screen-off" into sc-dev am: efda0f9277

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15287621

Change-Id: Iaf0deb0735c34d6480e09d1a62e8ac9020950274

####END####
####START####efda0f927703
Merge "Using WindowInsets API to hide keyboard on LockScreen when screen-off" into sc-dev
####END####
####START####cbcf2ca2324d
Fix a couple more issues with canceling the recents animation w/ screenshots

- There are a couple scenarios that were exposed in further testing of
  cancelling the recents animation with screenshots:
1) ensure that we force-cancel the recents animation (ie. continue
   cancel when deferred) if the process dies, the failsafe occurs
   or starting a new animation.  Previous the failsafe was not
   continuing since it was already canceled
2) Add a failsafe when deferring cancelling. This is a catch-all for
   cases where launcher fails to return promptly, the system won't
   be stuck in a pending state waiting for the cleanup
3) Always finish the animation when requested by the runner even if
   there is a deferred cancel. Launcher was assuming that this was
   the case, but we were actually skipping the finish (which also
   causes the controller on the launcher side to be cleared) which
   prevents the cleanupScreenshot() from happening.

Bug: 192564669
Test: atest RecentsAnimationControllerTest

Change-Id: I8952a0c404bb17056c03f2bc8e78f51fc5bd0a1e

####END####
services/core/java/com/android/server/wm/RecentsAnimation.java
services/core/java/com/android/server/wm/RecentsAnimationController.java

####START####f4148eafe546
Prevent fatal exception at AppOpsService$InProgressStartOpEvent#finish

Bug: 193757138
Test: Manual
Change-Id: I6187e6c1e12fbda0d646a288a7e7fad20832a568

####END####
services/core/java/com/android/server/appop/AppOpsService.java

####START####6a4035f76fe7
Merge "Limit VCNs to one running at a given time" am: 9e6e3ce643 am: 4d16027790 am: ee52376594 am: d9e09cc69c

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767050

Change-Id: Ie2889987db1c3dfe138d2330784769aaeb10ffaa

####END####
####START####d9e09cc69c47
Merge "Limit VCNs to one running at a given time" am: 9e6e3ce643 am: 4d16027790 am: ee52376594

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767050

Change-Id: Ic19e114d7c51fb7aab0f88771ebd042a744434db

####END####
####START####ee52376594dd
Merge "Limit VCNs to one running at a given time" am: 9e6e3ce643 am: 4d16027790

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767050

Change-Id: I89be4b61ec4e3a7ed24b817acf52a9c58fb5b4f2

####END####
####START####51aad462b661
Merge "Provide a queue to defer TaskFragment events" into sc-v2-dev am: 4b6ce0ad45 am: 713fd3e049

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15220037

Change-Id: Ib294516fc963ab82207fa21f7251011b3caf22a7

####END####
####START####713fd3e049c7
Merge "Provide a queue to defer TaskFragment events" into sc-v2-dev am: 4b6ce0ad45

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15220037

Change-Id: I48d17cded2d3ce01dc0170ec5b26cbb44a5243eb

####END####
####START####4b6ce0ad45e3
Merge "Provide a queue to defer TaskFragment events" into sc-v2-dev
####END####
####START####9e6e3ce643ab
Merge "Limit VCNs to one running at a given time"
####END####
####START####fa116b0d185b
Merge "Fix BatteryStatsImplTest." into sc-dev am: 4162c032bf

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15291010

Change-Id: Id5ffe3ff3b7b44299955b8b8c9cb322519688021

####END####
####START####75ede9376be5
Merge "Revert "Animate in a background for kg unlock icon"" into sc-dev am: dea99bf55e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302787

Change-Id: I3c063555b660b1dfa1bd1bfbc2d44a9194f936a3

####END####
####START####db622b652e9f
Merge "Always show lockdown button" into sc-dev am: 04697f8263

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289457

Change-Id: I597e4fb1a795cbb5f50ffaea3f31d717980b1928

####END####
####START####bc117eebdc33
Merge "Add guards around unbind" into sc-dev am: e2b3bf94c5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301093

Change-Id: I4686e2e69499bd354fd452762ae3d2be33e15008

####END####
####START####28ada5553485
Merge "Add haptic feedback on the kg lock icon" into sc-dev am: 025380e2b2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301522

Change-Id: I242f6ca17726c003b59fdaa4f7263610944d2d51

####END####
####START####c907a10a3821
Merge "Disable mic/cam quicksettings tiles when admin disallows" into sc-dev am: 0473e3a8e0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15084815

Change-Id: If9c9234021c0044c168eadf61ec9ff36926fb167

####END####
####START####9ab42488d40b
Merge "Tests for HighBrightnessModeController's HDR mode" into sc-dev am: e3e3a319e6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15235803

Change-Id: I5bfc45555bc4f22ff631612c1f72fcf5dcc5738e

####END####
####START####21affc98b2b6
Merge "Tuner APIs: add locks to avoid crashes caused by NPE" into sc-dev am: d7d85eb143

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15290582

Change-Id: Ifbde38a339e107c0fa9378034abc746fea7c2d3e

####END####
####START####d282bb14832d
Merge "Dismiss keyguard on udfps touch if can dismiss LS" into sc-dev am: 45877fb8a4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15290813

Change-Id: Ica08c4dd853f5f6616c99b98e49cc213c1b74360

####END####
####START####2d6840c61e28
Merge "[pm] fix non-incremental install progress regression" into sc-dev am: 61db3a23ee

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285367

Change-Id: I3fee36e03cce91255ccfd08fcc52c9edbe250122

####END####
####START####7317812bb267
Merge "Only check downstream permissions in preflight in RecognitionService" into sc-dev am: 3a2373352f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15263828

Change-Id: Ie31979ef4674a5bc03e18d49f4f9181e6880ee43

####END####
####START####6ede05d88e57
Merge "Add API to get GPU private memory" into sc-dev am: 4b939ccd2f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15266039

Change-Id: If25bd7c69831f3c996dc0a25e200960a99d7d3ef

####END####
####START####254cef067df1
Merge "Support customize layout in CollapsingToolbarBaseActivity" into sc-dev am: 50ffbb96c7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15270705

Change-Id: I83d8a4b16912323b1d476b24dbbbb70fd7454a05

####END####
####START####cf9332e942e7
Merge "Hide the keyboard when remote input hides." into sc-dev am: 7900e98494

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283872

Change-Id: Iea481cc417ab45ec661633222ab657e72fc1a9a7

####END####
####START####aa704d733969
Merge "TouchExplorer: log malformed events instead of crashing." into sc-dev am: 1c405c33b0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275875

Change-Id: I031feab71db7952ca80d2498f0831b2772e4c7b1

####END####
####START####388df22a038e
Merge "Remove dependency on WindowManager-Shell in the animation lib" into sc-dev am: e7701b84d3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278139

Change-Id: I222b2c145335f79d3f42f865d9bccecbcb260897

####END####
####START####fea7f2951154
Merge "(Take two) Do not hold lock when calling into NotificationManager" into sc-dev am: ac77fab34c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284691

Change-Id: I25318bd0dc0693f02cc4fe2a74a5214aec74475d

####END####
####START####cb9650b2d640
Merge "Cache nextPageTokens that a package can use." into sc-dev am: 46db5f1018

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15190794

Change-Id: Ie68de6417fbb80d474382c787565849e897cdea3

####END####
####START####c41cddf01db3
Merge changes I6f314a65,I8020f029 into sc-dev am: e5c0de0d2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285881

Change-Id: I0c769ef15bfbd52616f394505f6b19d31a6072a2

####END####
####START####22b36a7a66ae
Merge "Don't allow PI crashes on unknown sender types" into sc-dev am: e0c972a2be

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245014

Change-Id: I4dd8731a59b58e7376283eb41ae0e7185183566b

####END####
####START####f873d3782cf3
Animate in a background for kg unlock icon am: 09923d5eca

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289155

Change-Id: I16e786939770acbb92cb0c276e313d9bcb36722c

####END####
####START####67590e9ba5d5
Merge "PIN unlock buttons - contrast issue" into sc-dev am: 4bdb302f09

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286561

Change-Id: I03b21c206b38e86d7fc760c52c2126f263fd009d

####END####
####START####32222a2f33f1
Merge "Root UID can synthesize AttributionSource values." into sc-dev am: 9d0ddef67b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285879

Change-Id: I0b1bfb252147c3b4b66ac30d2b5d5f3b71fa0b7c

####END####
####START####43b3c443743a
Merge "Add missing breaks."
####END####
####START####e8ace59f0f1f
Merge "Add SafetyNet logging if a certain broadcast is received by apps." into sc-dev am: 0fd8262e2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15129351

Change-Id: I95cc2508d2e1368d157af84e5a08c43a526602db

####END####
####START####a1c0ceccfd60
Merge changes I5d467e8e,I5795f5ad into sc-dev am: e684a19bbb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284263

Change-Id: Ie98eedbe3bc8cb67b72de3ce326571384df99489

####END####
####START####4a1133c8dd93
Merge "Separating alarm history for lower quota" into sc-dev am: 977e2adc14

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15264659

Change-Id: I30c361dc7bfad51c7fddaef4ddcf4458a3652ac9

####END####
####START####2fa09fd9e24a
Merge "Add additional clarification regarding nanoapp loading APIs" into sc-dev am: 65731d06ce

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286092

Change-Id: I71ee48b1db242d8975975c5618a4d90678da5731

####END####
####START####664b746c635f
Merge "Set wallet lockscreen icon tint with text primary color." into sc-dev am: 528aa5fec8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15274502

Change-Id: Iab9eab6a96ba4894176adcaf54b55844c90fa970

####END####
####START####996f0d90d826
Merge "Fix log spam that got in here somehow." into sc-dev am: 75c9ab5778

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285499

Change-Id: Icddb05b8c31e8247ad6ccb382008338d70666449

####END####
####START####8f6a8ec8861d
Merge "resolve merge conflicts of 4172f20f6e17d18b4bcb076f5222584eb94553af to sc-v2-dev" into sc-v2-dev
####END####
####START####3b548655fd47
Don't query a null AccessibiiltyNodeInfo when populating ViewStructure

Chrome may crash with an NPE

Bug: 193839657
Test: builds
Change-Id: I106bdf80678f9edd6fbd5193d3a79a48c95a1d7a

####END####
core/java/android/view/View.java

####START####1a07db84ef4a
Merge "Fix BatteryStatsImplTest." into sc-dev am: 4162c032bf am: c37c2ba216

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15291010

Change-Id: I037fc83983dd3a564c64be11fa870dae23824954

####END####
####START####2c06c196c2c8
Merge "Fix BatteryStatsImplTest." into sc-dev am: 4162c032bf am: d6956bc287

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15291010

Change-Id: I19bc29d6bf83c8d077e9b8961fcc41100edf3f27

####END####
####START####62e3e3aecfd9
1/n: Move UDFPS enroll haptics back to system_server

The last enrollment step no longer requires special treatment.
This also allows us to consolidate haptic logic (eventually)
into one place (system_server)

Bug: 193089985
Test: enroll
Change-Id: Ib71e05c37c607a04673b139708df80f7a037c123

####END####
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsEnrollHelper.java
services/core/java/com/android/server/biometrics/sensors/fingerprint/aidl/FingerprintEnrollClient.java

####START####121aaa64a244
resolve merge conflicts of 4172f20f6e17d18b4bcb076f5222584eb94553af to sc-v2-dev

Bug: 193817339
Change-Id: Ie121b1e11def1bc8dab979db858d82bc8df908e7
Merged-In: Ibac2282d5c9242ae063adb2247d4297291fa3abf

####END####
####START####c37c2ba21673
Merge "Fix BatteryStatsImplTest." into sc-dev am: 4162c032bf

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15291010

Change-Id: Ib21cd08963534c6622d095c0b3d6b7ebc4a97bcc

####END####
####START####4162c032bf1e
Merge "Fix BatteryStatsImplTest." into sc-dev
####END####
####START####83b2f7d875f0
Scale stack dump timeout with HW_TIMEOUT_MULTIPLIER.

HWASan builds often fail to complete stack dump in time.

Bug: 193568145
Test: am hang; look for "ActivityManager: Done dumping" in logcat
Change-Id: Ied3a2def89cb1bb5c6a9d51ddf8fb112cb0b4133

####END####
services/core/java/com/android/server/am/ActivityManagerService.java

####START####b9b097acb0b0
Remove unused utility API.

Test: TH
Bug: 146564366
Change-Id: I198cbd6e93335d8daaba42b20d5c28721be948f4

####END####
telephony/common/com/android/internal/telephony/util/TelephonyUtils.java

####START####c0b79911cc3e
Merge "Revert "Animate in a background for kg unlock icon"" into sc-dev am: dea99bf55e am: 92c260413e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302787

Change-Id: I98d5defd26d3af88c480b8d4aba9455af44794f2

####END####
####START####0e231c143268
Merge "Revert "Animate in a background for kg unlock icon"" into sc-dev am: dea99bf55e am: b658493bfe

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302787

Change-Id: I061add07ba9ea923b29c5fa7a0f277ed7b6c5dd0

####END####
####START####10c04b9a916a
Correctly set trusted AttributionSource in RecognitionService

Fixes: 193831522
Test: manual
Change-Id: Ib520f755c6a072bb297a4a5964b869006eefc46e

####END####
services/core/java/com/android/server/speech/SpeechRecognitionManagerServiceImpl.java

####START####92c260413ecc
Merge "Revert "Animate in a background for kg unlock icon"" into sc-dev am: dea99bf55e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15302787

Change-Id: Iec625f9ddd78fac0eee978a7829567e151af9d28

####END####
####START####1b55247fbd1b
ActivityManagerService: add new lmkd kill reason

Add new LOW_FILECACHE_AFTER_THRASHING kill reason introduced in lmkd.

Bug: 193293513
Signed-off-by: Suren Baghdasaryan <surenb@google.com>
Change-Id: I5f86197865eb0353ef2c836ec9b2aeaae3bbf2ee

####END####
services/core/java/com/android/server/am/LmkdStatsReporter.java

####START####ebf00fdc7a6e
Merge "Always show lockdown button" into sc-dev am: 04697f8263 am: b8abde227f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289457

Change-Id: I09d2d90eb7c8cc86e0dab898956c34e02d5dd55d

####END####
####START####60f39fc35bff
Merge "Always show lockdown button" into sc-dev am: 04697f8263 am: 54191ae718

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289457

Change-Id: I323d8dc6a44209a77020cdf999ffe2dbe3dd3e67

####END####
####START####783f66f0bdff
Gate CDMA Supplementary Services on a CarrierConfig item

Introduce the KEY_SUPPORT_SS_OVER_CDMA_BOOL carrier config, which
allows Supplementary Services to be changed via carrier USSD codes.

This is disabled by default because the current USSD codes are not
configurable per carrier, so it can not be widely enabled.

Bug: 191057045
Test: manual, configuration changes
Change-Id: I3aeb1793c0df4f52764fef5fd09db47efe841dc2

####END####
telephony/java/android/telephony/CarrierConfigManager.java

####START####dea99bf55e69
Merge "Revert "Animate in a background for kg unlock icon"" into sc-dev
####END####
####START####dce086c2283c
Add missing breaks.

Bug: 158300259
Test: Android builds
Change-Id: I94b8a9149e9a6c9051e2b808c72da44ed88f659a

####END####
apex/jobscheduler/service/java/com/android/server/tare/EconomicPolicy.java

####START####b8abde227fa6
Merge "Always show lockdown button" into sc-dev am: 04697f8263

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289457

Change-Id: If7727c66c823f44bcf28a20f07915069bfc92060

####END####
####START####04697f8263c5
Merge "Always show lockdown button" into sc-dev
####END####
####START####59028ba18917
Make Recents purely optional

To be able to inject Optional.empty to Optional,Recents>, this CL
removes raw Recents references and replaces those with
Optional<Recents>.

Bug: 144309772
Test: atest SystemUITests
Change-Id: Ib63739cab8da345a479cc27b2c8b011231f5cfe5

####END####
packages/SystemUI/src/com/android/systemui/Dependency.java
packages/SystemUI/src/com/android/systemui/accessibility/SystemActions.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBar.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarView.java

####START####08dda90fa677
Merge "Fix dismiss not working in landscape" into sc-v2-dev am: 3ec9af44f7 am: 247752f496

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285880

Change-Id: Ic5b2dcff07848f97ec3d2189068000779110ee57

####END####
####START####247752f4963b
Merge "Fix dismiss not working in landscape" into sc-v2-dev am: 3ec9af44f7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285880

Change-Id: I5707df8c4e15cac6b97df7b4046ac8567d9fb45c

####END####
####START####3ec9af44f771
Merge "Fix dismiss not working in landscape" into sc-v2-dev
####END####
####START####c88902ca0b0c
Only load the overflow data once

We would also try loading the overflow data if it was empty
but this works poorly if it's becoming empty due to an app
cancel because we could load contents that are about to be
removed.

I think this can safely work if we just load it based on
the flag.

Adds a test related to this that was only in BubblesTest to
 NewNotifPipelineBubblesTest as well

Test: atest BubblesTest NewNotifPipelineBubblesTest
Test: - have nothing in bubble overflow
      - post 3 bubbles, cancel all, get a bubble, look in the overflow
      => the 3 bubbles shouldn't be there
Bug: 193560795
Change-Id: I1ec2d637281807ae3a2ec7430cff6627b074fa78

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/bubbles/BubbleController.java
packages/SystemUI/tests/src/com/android/systemui/wmshell/BubblesTest.java
packages/SystemUI/tests/src/com/android/systemui/wmshell/NewNotifPipelineBubblesTest.java

####START####58de065b64c9
Use Provider for EdgeBackGestureHandler

Ensures that EdgeBackGestureHandler is not a singleton.

Fixes: 193758967
Test: atest SystemUITests
Change-Id: I13f0130b57cf19d2ec8c3c4285a6785aba076486

####END####
packages/SystemUI/src/com/android/systemui/Dependency.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarView.java
packages/SystemUI/src/com/android/systemui/navigationbar/gestural/EdgeBackGestureHandler.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarButtonTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTransitionsTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NavigationBarContextTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/buttons/NearestTouchFrameTest.java

####START####b0d4dc162840
Merge "New MessageRouter interface to replace Handler." into sc-v2-dev am: 6154a87850 am: ec0e997c76

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14980848

Change-Id: I68fae0fade0d311e414e9a68d01bbd0cd11e064a

####END####
####START####16c7fcbcfba0
Merge "Make StatusBar purely optional" into sc-v2-dev am: 248f0f42b8 am: 3a2e18b05f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15270708

Change-Id: I86fca0e41fa31fadfd0647268b944e4304729f6d

####END####
####START####89695f5ea143
Merge "Add guards around unbind" into sc-dev am: e2b3bf94c5 am: f048ac713c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301093

Change-Id: I7370a804d9605c57a1b73cc6aa6631cccb7fddd6

####END####
####START####bd3ef70c2200
Merge "Add guards around unbind" into sc-dev am: e2b3bf94c5 am: 0ac2e636ad

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301093

Change-Id: I5eda309348a8542be3f7b55b01c638df5f547bae

####END####
####START####3111a92f0999
Merge "Add haptic feedback on the kg lock icon" into sc-dev am: 025380e2b2 am: 35d2c1ffa9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301522

Change-Id: Iacffcc4dcfe48432712839a1f6f40298c9817a7d

####END####
####START####7be33a62a0c8
Merge "Disable mic/cam quicksettings tiles when admin disallows" into sc-dev am: 0473e3a8e0 am: db76aaaa6c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15084815

Change-Id: I5a9510b022eb8c74e89c9beeead2a199cf301da1

####END####
####START####5afa7487dfe1
Fixed double face auth on swipe

Previously, if a face was rejected, and PIN/Pattern/Pass was
presented, and the user swiped on to unlock simultaneously, 2x face
authentications would be observed.

Test: Verified 10/10 times that device no longer performs 2x face
authentications in the scenario described above.
Fixes: 188598635

Change-Id: I24f964981484cfa19f7e1709f95da485204ff7a9

####END####
packages/SystemUI/src/com/android/keyguard/KeyguardUpdateMonitor.java

####START####266e0b864fd2
Revert "Animate in a background for kg unlock icon"

This reverts commit 09923d5eca02486324b55c9f28562d17418fc577.

Reason for revert: doesn't look good on smaller devices, punting to qpr
Bug: 192403524
Change-Id: I3e6bde6cf2f8cbbeb3502444cd63f2933704d357

####END####
packages/SystemUI/src/com/android/keyguard/LockIconView.java
packages/SystemUI/src/com/android/keyguard/LockIconViewController.java

####START####ec0e997c76c6
Merge "New MessageRouter interface to replace Handler." into sc-v2-dev am: 6154a87850

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14980848

Change-Id: I70e44c393266951519dfbbb200656e57602d9e37

####END####
####START####3a2e18b05f08
Merge "Make StatusBar purely optional" into sc-v2-dev am: 248f0f42b8

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15270708

Change-Id: I738496a204e391bad87ea91a4869e72137b3fbbb

####END####
####START####21dd5325fb85
Fix BatteryStatsImplTest.

Bug: 180015146
Test: atest FrameworksCoreTests:BatteryStatsImplTest

Change-Id: I6b43ca03ba816e12735ebd47d8cf61a6b1cee110

####END####
core/java/com/android/internal/os/BatteryStatsImpl.java
core/tests/coretests/src/com/android/internal/os/BatteryStatsImplTest.java
core/tests/coretests/src/com/android/internal/os/MockBatteryStatsImpl.java

####START####0ac2e636ad0f
Merge "Add guards around unbind" into sc-dev am: e2b3bf94c5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301093

Change-Id: I112f10639c5d3eb8270c8eb376b6c0548efd4ccf

####END####
####START####6154a87850da
Merge "New MessageRouter interface to replace Handler." into sc-v2-dev
####END####
####START####248f0f42b864
Merge "Make StatusBar purely optional" into sc-v2-dev
####END####
####START####e2b3bf94c544
Merge "Add guards around unbind" into sc-dev
####END####
####START####eb3c49a84e47
Perform oomAdjUpdate prior to scheduling service transactions

To ensure the apps executing the service transactions(start/stop etc.)
are in the correct proc state and unfrozen.

Bug: 191429032
Test: atest MockingOomAdjusterTests
Test: atest CtsAppTestCases
Change-Id: I32271adbe75afe377014f036e017667a7857dbf9
Merged-In: I32271adbe75afe377014f036e017667a7857dbf9

####END####
services/core/java/com/android/server/am/ActiveServices.java

####START####96a183b37aa6
Merge "Add haptic feedback on the kg lock icon" into sc-dev am: 025380e2b2 am: c2d6b107ea

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301522

Change-Id: If234f98ae824facd929fcf3edfc949853d10ca52

####END####
####START####71330777e2ab
Merge "Fix visibility issue in QS detail panels" into sc-dev am: 8527610e55

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278212

Change-Id: I5ed29aa8839eb673510007b6402621b42b0f5318

####END####
####START####5c709b627f12
Merge "Fix a11y of BiometricPrompt icon and help text" into sc-dev am: f33717e74a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15276031

Change-Id: I509a45cd3e9bf17d9d5d6abea93029ee046d510d

####END####
####START####eccce0f8e896
Merge "Set views below shelf explicitly invisible to skip hardware rendering" into sc-dev am: 1da11b55e9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15261872

Change-Id: Ia1299d9b26931e403df6ea59b0d21b82ce575eed

####END####
####START####17999f4e1164
Merge "Fix wrong LEGACY_STORAGE appop grant" into sc-dev am: 964a1e0f72

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15272231

Change-Id: I5ec40176569edf6121485e7a44c66d72b36b1a6a

####END####
####START####2d628c1cca52
Merge "Limit overscroll stretch for animation" into sc-dev am: b42f19e297

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15161821

Change-Id: I249a27030e5cd0375bc4e57e89528675557bcd1e

####END####
####START####35d2c1ffa96a
Merge "Add haptic feedback on the kg lock icon" into sc-dev am: 025380e2b2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15301522

Change-Id: I3afea9b35e85fb27d7c653e8835700f48f861c97

####END####
####START####af5cbff38cef
Merge "Fix VibrationThread with repeating waveforms of positive amplitudes" into sc-dev am: 9ab91ae6f4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245532

Change-Id: I28e6638db65fad4644a8f2007f7796ac52a8db37

####END####
####START####e72dd8406672
Merge "ViewRootImpl: Use mWindowAttributes directly for BBQ" into sc-dev am: b10b4141a5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14908372

Change-Id: I786f43585a19cb157a5b09dd063ae097a2f480e4

####END####
####START####a33880ef64be
Merge "Restrict all jobs when the device is too hot." into sc-dev am: ab7b0e8991

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15276032

Change-Id: I6b3d3be263115eb8c05831518a8bf1dbbb7bb3db

####END####
####START####e3d240d1906d
Merge "Disable mic/cam quicksettings tiles when admin disallows" into sc-dev am: 0473e3a8e0 am: 067894fae4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15084815

Change-Id: I1e39c5f2991da10f7f9953af9ed4b59d64ef8600

####END####
####START####025380e2b2a9
Merge "Add haptic feedback on the kg lock icon" into sc-dev
####END####
####START####d5555da37a3a
Allow TaskFragmentOrganizer to apply WCT without permission

TaskFragmentOrganizer will be used by regular apps without the
permission to manage Task. We are allow it to apply transactions if it
is operating on TaskFragment that is organized by itself.

Bug: 193191599
Test: atest WmTests:TaskFragmentOrganizerControllerTest
Change-Id: I82e5d49260680bd496ff184c6795ec817c65d858

####END####
core/java/android/window/DisplayAreaOrganizer.java
core/java/android/window/TaskFragmentOrganizer.java
core/java/android/window/TaskOrganizer.java
core/java/android/window/WindowContainerTransaction.java
core/java/android/window/WindowOrganizer.java
services/core/java/com/android/server/wm/ActivityTaskManagerService.java
services/core/java/com/android/server/wm/TaskFragment.java
services/core/java/com/android/server/wm/WindowOrganizerController.java
services/tests/wmtests/src/com/android/server/wm/TaskFragmentOrganizerControllerTest.java

####START####db76aaaa6c12
Merge "Disable mic/cam quicksettings tiles when admin disallows" into sc-dev am: 0473e3a8e0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15084815

Change-Id: I552e8709fe38b8f8b47b4e5714140787cd66bc27

####END####
####START####0473e3a8e0db
Merge "Disable mic/cam quicksettings tiles when admin disallows" into sc-dev
####END####
####START####e05da42d59aa
Merge "Tests for HighBrightnessModeController's HDR mode" into sc-dev am: e3e3a319e6 am: a885f7e82d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15235803

Change-Id: I54152b6f3f1cc96cd7c6df9c7dcd105e2bf6903b

####END####
####START####835421a043eb
Merge "Tests for HighBrightnessModeController's HDR mode" into sc-dev am: e3e3a319e6 am: c173e95670

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15235803

Change-Id: I313187f86b67de7daa097cebc832db94a926d0f3

####END####
####START####8a9cc5e4409c
Merge "Tuner APIs: add locks to avoid crashes caused by NPE" into sc-dev am: d7d85eb143 am: 5b463f9b14

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15290582

Change-Id: Ia387c14af633fb0d7b404b1338b95163ac6d19eb

####END####
####START####b18922a178f2
Merge "Dismiss keyguard on udfps touch if can dismiss LS" into sc-dev am: 45877fb8a4 am: 6605f0d148

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15290813

Change-Id: Ib99f9e403386153a7e44bee403ae89d92dad80ac

####END####
####START####314b35644b59
Do not specify a workSource when setting a delayed alarm so that the
alarm can still wake the device up when the device is idle as the
AlarmManager.FLAG_ALLOW_WHILE_IDLE_UNRESTRICTED flag indicates.

Bug: 188302603,193260066
Test: presubmits
Change-Id: I2cc8f7bb49d626644f9b4257b04f4f8ea5fc3d2f

####END####
services/core/java/com/android/server/location/injector/AlarmHelper.java
services/core/java/com/android/server/location/provider/LocationProviderManager.java

####START####6f52ebd0db6e
Merge "Dismiss keyguard on udfps touch if can dismiss LS" into sc-dev am: 45877fb8a4 am: 44a6dcd69d

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15290813

Change-Id: Ice9a03ba0737f0cdd58fea14f6b86d01ebdb1633

####END####
####START####74f558caa0af
Merge "Clear binder calling identity before calling callback" am: 483a604f27 am: cda8a7ec57 am: e8233d01a8 am: bbd8673467

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767051

Change-Id: Ie9fee647b226867b80e40aca57f1e2d9e93df465

####END####
####START####c173e95670a1
Merge "Tests for HighBrightnessModeController's HDR mode" into sc-dev am: e3e3a319e6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15235803

Change-Id: If7fb94bfe6266c2a59a49316a0fe05f6b7805bc9

####END####
####START####5b463f9b14f3
Merge "Tuner APIs: add locks to avoid crashes caused by NPE" into sc-dev am: d7d85eb143

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15290582

Change-Id: Id2beb939a4df428b438a0cae2df63f731faad2a0

####END####
####START####6605f0d14827
Merge "Dismiss keyguard on udfps touch if can dismiss LS" into sc-dev am: 45877fb8a4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15290813

Change-Id: Iae13ed56574a9f190a7aa88aa8ac091eaf56b33f

####END####
####START####c9243c59483f
Merge "Make AudioManager.getReportedSurroundFormats a TestApi"
####END####
####START####95a0a7ffa439
Add guards around unbind

Also, make sure that mIsBound is in the correct state and clean up after
death.

Test: atest TileServiceTest for the leaks
Test: atest TileLifecycleManagerTest
Fixes: 183807631
Change-Id: I8fa2b746d9ba273bcbef088e4ca4ba50a317128a

####END####
packages/SystemUI/src/com/android/systemui/qs/external/TileLifecycleManager.java
packages/SystemUI/tests/src/com/android/systemui/qs/external/TileLifecycleManagerTest.java

####START####5474359369ae
Fix dismiss not working in landscape

In stack animation controller only one target would ever
be added so when the target is re-created after rotating
then it wouldn't be used.

Test: - have some bubbles, drag them around, rotate device, try to
        dismiss them => they can be dismissed in landscape
      - get more bubbles, rotate back to portrait, try to dismiss
        them => they can be dismissed in portrait
      - drag the stack around the edges of the screen and verify that
        the only magnetic spot is where the dismiss target is
Fixes: 193008696
Change-Id: I6b24b1f9d301d37749dc67c95392fd6c8451df00

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/bubbles/BubbleStackView.java
libs/WindowManager/Shell/src/com/android/wm/shell/bubbles/animation/StackAnimationController.java

####START####f75fffdc20cb
PiP: Allow customization of PiP minimum size.

Bug: 171596717
Test: None.
Change-Id: I9bb6f2740d25fce99a436f938e7b3cca819ffa98

####END####
libs/WindowManager/Shell/src/com/android/wm/shell/pip/phone/PipTouchHandler.java

####START####a5e7d3cdf9bb
Add a lock for call add/remove operations to avoid
ConcurrentModificationException.

Bug: 189816293
Test: InCallService cts tests
Change-Id: I123b2de55b856d12ee2a5e6d2fa49c15a74592fc

####END####
telecomm/java/android/telecom/Phone.java

####START####65d070996c38
Merge "Remove unused portal code"
####END####
####START####714ba1d868c1
Clear binder calling identity before calling callback

This change clears calling identities before the
onSubscriptionsChangedListener.onSubscriptionsChanged() callback is
made.

Bug: 193731920
Test: atest TelephonyRegistryManagerTest
Original-Change: https://android-review.googlesource.com/1767051
Merged-In: I21f14e40a05f76346eb90b8f36608b4d6bdf1a29
Change-Id: I21f14e40a05f76346eb90b8f36608b4d6bdf1a29

####END####
core/java/android/telephony/TelephonyRegistryManager.java

####START####e3e3a319e65e
Merge "Tests for HighBrightnessModeController's HDR mode" into sc-dev
####END####
####START####3433a8e5d933
Limit VCNs to one running at a given time

This change ensures that there is only ever one VCN running at a given
point in time, and that if the device has switched to using a
subscription in a different subscription group, the VCN will immediately
tear down.

This ensures that when on a DSDS device, when the VCN-enabled
subscription is not the default/active subscription, the other
subscription's network will never be outscored by the VCN, and thus get
torn down.

Bug: 190761448
Test: atest FrameworksVcnTests
Test: Manual testing to ensure common functionality
Change-Id: I8031fab7502880d38420058451df41f47567c458

####END####
services/core/java/com/android/server/VcnManagementService.java
services/core/java/com/android/server/vcn/TelephonySubscriptionTracker.java
tests/vcn/java/com/android/server/VcnManagementServiceTest.java
tests/vcn/java/com/android/server/vcn/TelephonySubscriptionTrackerTest.java
tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionTestBase.java

####START####d7d85eb14376
Merge "Tuner APIs: add locks to avoid crashes caused by NPE" into sc-dev
####END####
####START####45877fb8a444
Merge "Dismiss keyguard on udfps touch if can dismiss LS" into sc-dev
####END####
####START####bbd8673467ba
Merge "Clear binder calling identity before calling callback" am: 483a604f27 am: cda8a7ec57 am: e8233d01a8

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767051

Change-Id: Ia743957303185f478e6a54c8ebb552d85bc5dfdd

####END####
####START####e8233d01a885
Merge "Clear binder calling identity before calling callback" am: 483a604f27 am: cda8a7ec57

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767051

Change-Id: Ia3476638f5ccf52d19ab2b0510e279ba70d519b0

####END####
####START####936833de0e57
Rename VERSION_CODES.T to VERSION_CODES.TIRAMISU

Bug: 186121492
Test: m checkbuild
Change-Id: Ic3e542206ae75626fa361333f00de2937ef18a5f

####END####
core/java/android/os/Build.java

####START####08055979c92b
Merge "[pm] fix non-incremental install progress regression" into sc-dev am: 61db3a23ee am: fa092c0cc9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285367

Change-Id: Ib2c409856196e6fce3a15a4df052490151b61955

####END####
####START####afa258888678
Merge "Only check downstream permissions in preflight in RecognitionService" into sc-dev am: 3a2373352f am: 59927022e7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15263828

Change-Id: Ie481a49b6fd18df31397315f77c58ba23c4eed21

####END####
####START####16a9a8affbcd
Merge "[pm] fix non-incremental install progress regression" into sc-dev am: 61db3a23ee am: 5bb13f05f9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285367

Change-Id: Iba4c482ed395b15e4b956d37ec69ccce0726d851

####END####
####START####04e4676bfd91
Merge "Only check downstream permissions in preflight in RecognitionService" into sc-dev am: 3a2373352f am: 740f2c21ea

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15263828

Change-Id: Ia71add67a8f86d76a4a7848c014dd68da21807a7

####END####
####START####410618472f0a
Log stats for Optimize

OptimizeStats is crucial for us to tune our configuration for
optimization, which might affect the health of AppSearch and system
overall. Details can be found in Ib7ae475cc035d1b69969df1e22ac409895e0e3fa.

Also add sampling parameters in AppSearchConfig for:
1) initializeStats
2) searchStats
3) globalSearchStats
4) optimizeStats

Bug: 173532925
Bug: 175255572
Test: AppSearchStatsTest, FrameworksMockingServicesTests:AppSearchConfigTest, CtsAppSearchTestCases
Ignore-AOSP-First: AppSearch is not available on AOSP yet
Change-Id: Id61704407bdb40707cb8fa46b556024aea9f9083

####END####
apex/appsearch/service/java/com/android/server/appsearch/AppSearchConfig.java
apex/appsearch/service/java/com/android/server/appsearch/AppSearchManagerService.java
apex/appsearch/service/java/com/android/server/appsearch/external/localstorage/AppSearchImpl.java
apex/appsearch/service/java/com/android/server/appsearch/external/localstorage/AppSearchLogger.java
apex/appsearch/service/java/com/android/server/appsearch/external/localstorage/AppSearchLoggerHelper.java
apex/appsearch/service/java/com/android/server/appsearch/external/localstorage/stats/OptimizeStats.java
apex/appsearch/service/java/com/android/server/appsearch/stats/PlatformLogger.java
services/tests/mockingservicestests/src/com/android/server/appsearch/AppSearchConfigTest.java
services/tests/servicestests/src/com/android/server/appsearch/external/localstorage/AppSearchImplTest.java
services/tests/servicestests/src/com/android/server/appsearch/external/localstorage/AppSearchLoggerTest.java
services/tests/servicestests/src/com/android/server/appsearch/external/localstorage/stats/AppSearchStatsTest.java

####START####483a604f27ba
Merge "Clear binder calling identity before calling callback"
####END####
####START####6a2d17d45361
Use '!' instead of 'x' in signal drawable

Update the not-connected iconography to use an exclamation mark instead
of the 'x'.

Test: manual; adb shell am broadcast -a com.android.systemui.demo -e command network -e mobile show -e level -2 -e datatype lte
Fixes: 175335798
Change-Id: Iff4b7d9e7fe113c50b92a45cace3a742f7af42f6

####END####
packages/SettingsLib/src/com/android/settingslib/graph/SignalDrawable.java

####START####ad79043436c9
Add SafetyNet logging if a certain broadcast is received by apps.

In case the broadcast intents "com.android.server.net.action.SNOOZE_WARNING"
or "com.android.server.net.action.SNOOZE_RAPID" are dispatched to apps,
then add a SafetyNet log.

Bug: 177931370
Test: manual
Change-Id: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
Merged-In: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
(cherry picked from commit a22e341ac2220de707ad37479e4a87a68281e6d1)

####END####
services/core/java/com/android/server/am/ActivityManagerService.java

####START####452a5aeec5a7
Add SafetyNet logging if a certain broadcast is received by apps.

In case the broadcast intents "com.android.server.net.action.SNOOZE_WARNING"
or "com.android.server.net.action.SNOOZE_RAPID" are dispatched to apps,
then add a SafetyNet log.

Bug: 177931370
Test: manual
Change-Id: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
Merged-In: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
(cherry picked from commit a22e341ac2220de707ad37479e4a87a68281e6d1)

####END####
services/core/java/com/android/server/am/ActivityManagerService.java

####START####3ae33de9240a
Add SafetyNet logging if a certain broadcast is received by apps.

In case the broadcast intents "com.android.server.net.action.SNOOZE_WARNING"
or "com.android.server.net.action.SNOOZE_RAPID" are dispatched to apps,
then add a SafetyNet log.

Bug: 177931370
Test: manual
Change-Id: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
Merged-In: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
(cherry picked from commit a22e341ac2220de707ad37479e4a87a68281e6d1)

####END####
services/core/java/com/android/server/am/ActivityManagerService.java

####START####d02b731699ef
Add SafetyNet logging if a certain broadcast is received by apps.

In case the broadcast intents "com.android.server.net.action.SNOOZE_WARNING"
or "com.android.server.net.action.SNOOZE_RAPID" are dispatched to apps,
then add a SafetyNet log.

Bug: 177931370
Test: manual
Change-Id: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
Merged-In: I65b2e96ff1230b2051dd1e5bd9c21e5ba3e1146a
(cherry picked from commit a22e341ac2220de707ad37479e4a87a68281e6d1)

####END####
services/core/java/com/android/server/am/ActivityManagerService.java

####START####fa092c0cc995
Merge "[pm] fix non-incremental install progress regression" into sc-dev am: 61db3a23ee

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285367

Change-Id: Ia76d3a2dbccdd6363522871db01e8c6b1d038db0

####END####
####START####59927022e735
Merge "Only check downstream permissions in preflight in RecognitionService" into sc-dev am: 3a2373352f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15263828

Change-Id: Ice15cf120e64e15ac3f94834180947d18bc4ed68

####END####
####START####05d0f245865b
Merge "Add API to get GPU private memory" into sc-dev am: 4b939ccd2f am: ff0875c231

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15266039

Change-Id: I55950548223f47cddf1d8e23f28c6c54b4078b5e

####END####
####START####4dda2323e980
New MessageRouter interface to replace Handler.

Proposal introduced in http://go/sysui-message-router

This introduces a testable, controllerable MessageRouter interface
intended to replace Handler#sendMessage. Listeners subscribe to
specific messages rather than subclassing Handler.

Also, metadata can be passed in any form, rather than the generic
android.os.Message.

To use, developers simply inject either an @Main or a @Background
MessageRouter. This provides them with a new instance of a
MessageRouter, tied to the corresponding Executor.

As an example, the internal Handler subclass in GarbageMonitor has
been replaced. There is an overall reduction in the number of lines
of code, and the corresponding test has been refactored to be more
deterministic and useful.

Bug: 191077376
Test: atest SystemUITests

Change-Id: Ibd1e05b1b5b7421c2085d8811b8f5cd61cf0ffde

####END####
packages/SystemUI/src/com/android/systemui/util/concurrency/MessageRouter.java
packages/SystemUI/src/com/android/systemui/util/concurrency/MessageRouterImpl.java
packages/SystemUI/src/com/android/systemui/util/concurrency/SysUIConcurrencyModule.java
packages/SystemUI/src/com/android/systemui/util/leak/GarbageMonitor.java
packages/SystemUI/tests/src/com/android/systemui/util/concurrency/MessageRouterImplTest.java
packages/SystemUI/tests/src/com/android/systemui/util/leak/GarbageMonitorTest.java

####START####3d54f68455cb
Merge "Add API to get GPU private memory" into sc-dev am: 4b939ccd2f am: 7a58d28e3e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15266039

Change-Id: Id3a5194606c0cce5f36376cd3eed27efba0eb578

####END####
####START####eb67e23b0143
Increase timeout on VibrationThread to wait for vibrator callbacks

Some IVibrator#compose calls are taking longer than the estimated
duration to finish and are being cut short by the VibrationThread with
the existing timeout.

Increating the timeout to 1s.

Bug: 186441334
Test: manual
Change-Id: Idc0b58f0d068a62ad0df70ab8b2bb3bbe5355cf1

####END####
services/core/java/com/android/server/vibrator/VibrationThread.java
services/tests/servicestests/src/com/android/server/vibrator/VibrationThreadTest.java

####START####61db3a23ee5b
Merge "[pm] fix non-incremental install progress regression" into sc-dev
####END####
####START####482fbc349044
Mark parameter as nullable

This parameter has been nullable since when the API was introduced, but
it was not properly annotated like everywher else.

Fixes: 193225087
Test: m -j
Change-Id: I49e3d840f0cc7b5974059189a1e3eac201e8a5df

####END####
core/java/android/app/WallpaperManager.java

####START####c9bb64a2dc1c
Merge "Show Task Surface if it will not be organized" into sc-v2-dev am: ce54693964 am: 844a275a3a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15291894

Change-Id: Iba0534442589f519c5c92c41356fb1c6fd029d1b

####END####
####START####7d5d995cc160
Showing 8 tiles in collapsed Quick Settings in split shade

Also overriding default tiles columns count for bigger screens - I've seen some weird behaviour with tiles columns so just to be safe

Fixes: 193651837
Fixes: 190688328
Test: manual
Change-Id: I681fd7ac9c0ad7898a1b24b50bf140de43bf414f

####END####
packages/SystemUI/src/com/android/systemui/qs/QuickQSPanel.java
packages/SystemUI/src/com/android/systemui/qs/QuickQSPanelController.java

####START####3a2373352fd1
Merge "Only check downstream permissions in preflight in RecognitionService" into sc-dev
####END####
####START####a6861d86bae9
Refactor to ensure thread safety

Make object pointer safety for multiple thread

Bug: 179834303
Test: atest ContentCapturePerfTests
Change-Id: I5c04dd3b1288fb3ac104738f159dba88b641a0bf

####END####
apct-tests/perftests/contentcapture/src/android/view/contentcapture/MyContentCaptureService.java

####START####7a58d28e3ec0
Merge "Add API to get GPU private memory" into sc-dev am: 4b939ccd2f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15266039

Change-Id: I3b3c102a27dd751809bf47ce8d69c339b3456199

####END####
####START####0b925d4f46ef
Null safe package name in AppOps writeState

Ensure that, if a package has a null package name, that the AppOpsServer
does not crash. Existing package tags should be closed, and lastPkg set
to null.

Test: manual
Fixes: 193664388
Change-Id: I420477a9f102b6c1f8305b45158e7bdb3a71e227

####END####
services/core/java/com/android/server/appop/AppOpsService.java

####START####286813a76870
Add haptic feedback on the kg lock icon

Test: manual, adb shell dumpsys vibrator_manager
Bug: 193089985
Change-Id: I8c3e5d1931a3399d4ecf0aac501cd74e0b7d7bec

####END####
packages/SystemUI/src/com/android/keyguard/LockIconViewController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/UdfpsControllerTest.java

####START####844a275a3ac0
Merge "Show Task Surface if it will not be organized" into sc-v2-dev am: ce54693964

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15291894

Change-Id: Ifd087dd76f0bf6bca7afda7e1eb28695899bc61c

####END####
####START####92380ef500a7
Merge "Add android.os.Build.VERSION_CODES.T" into sc-dev-plus-aosp am: 3e1311a4b4 am: adb28d6357

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286710

Change-Id: I4c55061aacf62269c985eef6623545986ffd1461

####END####
####START####01a6369d0499
Merge "Tuner APIs: add locks to avoid crashes caused by NPE"
####END####
####START####4b939ccd2f0b
Merge "Add API to get GPU private memory" into sc-dev
####END####
####START####ce54693964cd
Merge "Show Task Surface if it will not be organized" into sc-v2-dev
####END####
####START####f29de4df8fab
Merge "recreate a11y focused virtual node when findFocus"
####END####
####START####8e24bf766cae
Merge "Support customize layout in CollapsingToolbarBaseActivity" into sc-dev am: 50ffbb96c7 am: 147c49ad70

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15270705

Change-Id: Ic03a10ae8f78ee477ef0e1fa0159f03793d4fe8e

####END####
####START####748b8f95951d
Merge "Hide the keyboard when remote input hides." into sc-dev am: 7900e98494 am: 47243eebf5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283872

Change-Id: I54879257dc5052b93c6027d4ac964cc9d69c291a

####END####
####START####e19cff29b636
Merge "Support customize layout in CollapsingToolbarBaseActivity" into sc-dev am: 50ffbb96c7 am: 0a112e7946

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15270705

Change-Id: Ied916300837735553bbfcfcf7a125b54d2c0ccdb

####END####
####START####cec687fc490a
Merge "Hide the keyboard when remote input hides." into sc-dev am: 7900e98494 am: c7005ceda2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283872

Change-Id: I4e1f2a74070dbf2c8e01b14d0fd2fc916f9aec61

####END####
####START####adb28d63574f
Merge "Add android.os.Build.VERSION_CODES.T" into sc-dev-plus-aosp am: 3e1311a4b4

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286710

Change-Id: Ie92f05f3b752f18f9bf17a2d80e755292635128b

####END####
####START####f13fe0cceaa2
Fix failing GameManagerServiceTests

The following tests are currently failing:

- com.android.server.app.GameManagerServiceTests#testDeviceConfigInvalid
- com.android.server.app.GameManagerServiceTests#testSetGameModePermissionDenied
  - This is actually flaky, rather than consistently failing.

testDeviceConfigInvalid is failing because the current config string is
actually valid. This test is fixed by updating the string to actually
be invalid by making it empty.

testSetGameModePermissionDenied is failing because the test package
doesn't have any valid configs, so the call to getGameMode() returns
GAME_MODE_UNSUPPORTED rather than GAME_MODE_STANDARD. This is fixed by
calling mockDeviceConfigAll() at the start of the test.

Test: GameManagerServiceTests#testDeviceConfigInvalid
Test: GameManagerServiceTests#testSetGameModePermissionDenied
Bug: b/193794028
Change-Id: I4d4581c37c31f6234b825f6b557b1e7dd4ce1c77

####END####
services/tests/mockingservicestests/src/com/android/server/app/GameManagerServiceTests.java

####START####f87534c43bce
Using WindowInsets API to hide keyboard on LockScreen when screen-off

This CL is aim to resolve InputMethodManager#hideSoftInputFromWindow
somehow may not succeed even the focused editor won't changed when
screen turned off.

As CL[1] that we introduced the new app compatibility setting
(FINISH_INPUT_NO_FALLBACK_CONNECTION) for IME apps which the
targetSdkVersion >= 31.

That settings slightly changes the behavior of invoking
InputMethodManager#hideSoftInputFromWindow when device screen is off.

Since when the device screen-off, system will finish the current input
connection and clear the served view on InputMethodManager in order to
resolve a long standing unexpected started input connection problem.

With that change, SystemUI side may not succeed to call
InputMethodManager#hideSoftInputFromWindow when device screen is Off
because InputMethodManager side thought the served connection has
finished. so InputMethodManager side by default will not pass the
hide request if there is no served editor or the served editor has
changed that differnce with the caller.

Generally, even with or without FINISH_INPUT_NO_FALLBACK_CONNECTION
behavior chagnge, we are not expecting the normal app will be able
to call hideSoftInputFromWindow when device screen is off, because
the window focus will be changed to NotificiationShade, so the hide
request won't be succeed because  of the served view change.

To make the minimun change for SystemUI use case, using
WindowInsetsController#hide(ime()) to fix the issue. Since
unlike IMM#hideSoftInputFromWindow that requires more restrictions
checking the caller's input connection state, WindowInsets API
natually tells InputMethodService to hide soft-keyboard if
WM thought the IME insets is still controllable by the window.

[1]: Id4e71a822bfde5fe6a263bbe094c0d238017efe1

Fix: 192644416
Test: manual as follow steps:
    0) from " Settings -> Develop options -> AppCompatibility Changes"
       -> Select Gboard app, make sure the
       "FINISH_INPUT_NO_FALLBACK_CONNECTION" has enabled.
    1) Select Gboard as default IME apps.
    2) Setup a password lock.
    3) Pressing power key to turn off and turn on the screen
    4) Swiping up to to make keyboard shown when the Password Lock
       focused the editor.
    5) Pressing power key to turn off and turn on the screen again
    6) Verify if keyboard is hidden as expected.
Test: atest KeyboardVisibilityControlTest
Test: atest InputMethodStartInputLifecycleTest

Change-Id: I1ab2f0c012ba26f78bb0132e1447e020a74cca43

####END####
packages/SystemUI/src/com/android/keyguard/KeyguardPasswordViewController.java

####START####0a112e79464a
Merge "Support customize layout in CollapsingToolbarBaseActivity" into sc-dev am: 50ffbb96c7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15270705

Change-Id: I3c014bc738ed9f14955e866992c4ebaa461edbc0

####END####
####START####c7005ceda201
Merge "Hide the keyboard when remote input hides." into sc-dev am: 7900e98494

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283872

Change-Id: I4719f3922e16786423957ad2530d161df4846b3a

####END####
####START####c4c411202ff2
speech: queryIntentService-AsUser-

Use queryIntentServicesAsUser rather than queryIntentServices.
This will allow to run the check in multiuser scenarios.

Bug: 193607146
Test: CtsVoiceRecognitionTestCases
Change-Id: I9386bcc04bcaa210e681e109c5cbbfa8695fb38a

####END####
services/core/java/com/android/server/speech/SpeechRecognitionManagerServiceImpl.java

####START####f43904eaba7e
Merge "AudioFormat: new channel masks and more javadoc" into sc-v2-dev am: dc38caf6db am: 0361bc4f63

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15028580

Change-Id: Ia3ea129a1b8dbe3f977fc2cc22c34d62a8d9d65e

####END####
####START####50ffbb96c77b
Merge "Support customize layout in CollapsingToolbarBaseActivity" into sc-dev
####END####
####START####29cb9a7c9012
Added Ble scan APIs to BatteryStatsManager

Added missing service functions to manager to prevent directly
calling BatteryStatsService from Bluetooth package. Updated
system-current.txt accordingly.

Tag: #feature
Bug: 190442794
Test: Manual
Merged-In: Ie6c6d3688d2da45956d57ea1dbc2cc4430f27783
Change-Id: Ie6c6d3688d2da45956d57ea1dbc2cc4430f27783

####END####
core/java/android/os/BatteryStatsManager.java
services/core/java/com/android/server/am/BatteryStatsService.java

####START####3e1311a4b426
Merge "Add android.os.Build.VERSION_CODES.T" into sc-dev-plus-aosp
####END####
####START####7900e9849476
Merge "Hide the keyboard when remote input hides." into sc-dev
####END####
####START####862051d9100a
Merge "Added Ble scan APIs to BatteryStatsManager" into sc-dev-plus-aosp am: 1c32cef21f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15233610

Change-Id: I416da2e03e823c671967d12c349b7d7329c103b9

####END####
####START####0361bc4f6388
Merge "AudioFormat: new channel masks and more javadoc" into sc-v2-dev am: dc38caf6db

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15028580

Change-Id: I0786916dabbecc928bad662cd8238d58e9397d89

####END####
####START####dc38caf6db1b
Merge "AudioFormat: new channel masks and more javadoc" into sc-v2-dev
####END####
####START####1c32cef21f22
Merge "Added Ble scan APIs to BatteryStatsManager" into sc-dev-plus-aosp
####END####
####START####281cff65d2e1
Tuner APIs: add locks to avoid crashes caused by NPE

Bug: 193604292
Test: atest android.media.tv.tuner.cts.TunerTest
Change-Id: I08aaf38489ab7ea29f99e416b0e1082a3d0ee249

####END####
media/java/android/media/tv/tuner/Lnb.java
media/java/android/media/tv/tuner/Tuner.java
media/java/android/media/tv/tuner/dvr/DvrPlayback.java
media/java/android/media/tv/tuner/dvr/DvrRecorder.java
media/java/android/media/tv/tuner/filter/Filter.java

####START####81c452cc5545
Merge "TouchExplorer: log malformed events instead of crashing." into sc-dev am: 1c405c33b0 am: 0edea2f14b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275875

Change-Id: I27baec67ed7ff96427cdc7b0b8dead4c48806fbd

####END####
####START####6191b5c9eaa7
Merge "TouchExplorer: log malformed events instead of crashing." into sc-dev am: 1c405c33b0 am: bb3ced2ac5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275875

Change-Id: Ia0370d8e8a6c87823ec5a18f3ce66f51ace64687

####END####
####START####0edea2f14bf2
Merge "TouchExplorer: log malformed events instead of crashing." into sc-dev am: 1c405c33b0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275875

Change-Id: Id24155c93bfc96747c2d73493477cfdacd28ced6

####END####
####START####1c405c33b092
Merge "TouchExplorer: log malformed events instead of crashing." into sc-dev
####END####
####START####c24f35292d44
Tests for HighBrightnessModeController's HDR mode

Bug: 187804126
Test: atest HighBrightnessModeControllerTest
Change-Id: Icae49955c665884dbbf8b0c0fb170bfdf96bac3b

####END####
services/core/java/com/android/server/display/HighBrightnessModeController.java
services/tests/servicestests/src/com/android/server/display/HighBrightnessModeControllerTest.java

####START####678eeab7327f
Merge "Update DND/Priority Mode defaults for new users."
####END####
####START####b13ce85b5b61
Hide the keyboard when remote input hides.

This fixes a regression introduced by ag/13410424, while preserving the delay introduced by that change.

Bug: 193556445
Test: manual fuzz testing the remote input / keyboard
Change-Id: I4e4cdac0886d21aff63638f05d97b765c36f7ba6

####END####
packages/SystemUI/src/com/android/systemui/statusbar/RemoteInputController.java
packages/SystemUI/src/com/android/systemui/statusbar/notification/collection/NotificationEntry.java
packages/SystemUI/src/com/android/systemui/statusbar/policy/RemoteInputView.java

####START####027088cdc61b
Merge "Remove dependency on WindowManager-Shell in the animation lib" into sc-dev am: e7701b84d3 am: 207052c810

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278139

Change-Id: I495d8830b3bc445fad29cdb34216469c7574a8ed

####END####
####START####3417a05bde86
Merge "Remove dependency on WindowManager-Shell in the animation lib" into sc-dev am: e7701b84d3 am: 91f6af4e17

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278139

Change-Id: Ib9222ed2aa7ad3bd9f66187cae5e02d538596ea2

####END####
####START####3da54c3f782d
Provide a queue to defer TaskFragment events

- onTaskFragmentAppeared is called after the whole WCT is finished
- Prevent onTaskFragmentInfoChanged to be called before appeared
  event is sent

Bug: 189385246
Test: atest TaskFragmentOrganizerControllerTest
Change-Id: I8340331e5a6e3e245c7b145c9ad5fd0b074012f9

####END####
services/core/java/com/android/server/wm/ActivityTaskManagerService.java
services/core/java/com/android/server/wm/RootWindowContainer.java
services/core/java/com/android/server/wm/TaskFragment.java
services/core/java/com/android/server/wm/TaskFragmentOrganizerController.java
services/tests/wmtests/src/com/android/server/wm/TaskFragmentOrganizerControllerTest.java

####START####137d78bb672e
Revert "Add systrace tag for system property"

Revert "Add systrace tag for system property"

Revert "Adding system property tracing"

Revert submission 1403568-sysprop_trace

Reason for revert: makes property get/set non-reentrant
Reverted Changes:
I6f85f3f52:Add systrace tag for system property
Id2b93acb2:Adding system property tracing
Id78992d23:Add systrace tag for system property
I1ba9fc7bd:Add systrace tag for system property

Bug: 193050299
Change-Id: Iaf522b403e51abcf1d49804f35a184b4aa0d3209
Test: build and boot a device

####END####
core/java/android/os/Trace.java

####START####207052c810f4
Merge "Remove dependency on WindowManager-Shell in the animation lib" into sc-dev am: e7701b84d3

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15278139

Change-Id: I91873fd64feef60ce4d364f3289d9ac6d50e39d4

####END####
####START####71089198bf93
Dismiss keyguard on udfps touch if can dismiss LS

In case face auth has suceeded, finger down on the udfps area should
trigger device entry.

Test: atest UdfpsControllerTest
Test: manual
Bug: 192680255
Change-Id: I36fe693bc88a0aa1784cd1ce1b268cd07f6ced4d

####END####
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/UdfpsControllerTest.java

####START####e7701b84d3ba
Merge "Remove dependency on WindowManager-Shell in the animation lib" into sc-dev
####END####
####START####61076ae02c01
Prevent having empty task added back into TDA

Main stage will reparent specfic window mode and activity type tasks
under default task display area as its children.

When user enter some apps then press back to exit, tasks should become
out screen surface, but tasks with no activity reocrd child will
pop out again as children of default task display area while user enter
recent overview screen.

If user active stage split in such status, those tasks except the side
stage target will be reparent to main stage. After split active, if
user press back to exit app, the target task will bring to back but
other children tasks have no activity to show so home screen will
display. However, split screen cannot exit because main stage children
count still larger than 0 and both stage still visible.

For fix such issue, we should prevent empty tasks created and added
back into TDA.

Fix: 193112081
Test: Follow repro step on b/193112081 and check result
Test: atest WmTests
Change-Id: I66fcac68f6231a41b7b142307db2e7d89566cad6

####END####
services/core/java/com/android/server/wm/ActivityTaskManagerService.java

####START####c4d4c056986c
Merge "Fix broken links in javadoc"
####END####
####START####718ea2ba9787
Remove extra article from the comment

SHOW_ROTATION_SUGGESTIONS had a redundant 'the' in its documentation.

BUG: 193762210
Test: N/A since only comment was updated
Change-Id: Iafe3f6e563e4d3663e9dca6b2f3c64a1448a7ac8

####END####
core/java/android/provider/Settings.java

####START####1e7f986e2c3a
Merge "Fixing notifications in split shade when customizing QS" into sc-v2-dev am: bfe708d973 am: ba31c659b6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15259894

Change-Id: I5fa3b96a70419b614cc3e8603c767b07679e5c23

####END####
####START####ba31c659b684
Merge "Fixing notifications in split shade when customizing QS" into sc-v2-dev am: bfe708d973

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15259894

Change-Id: Ifb3b599e0b5b57802a7eb0f5d442517aa93b1978

####END####
####START####264bd6056f27
Merge "Add config param to disable app snapshots."
####END####
####START####bfe708d973ce
Merge "Fixing notifications in split shade when customizing QS" into sc-v2-dev
####END####
####START####87676023b5fe
Merge "Add doc explaining PAC proxies are not supported over VPNs" am: 2f3d6bc593 am: 75e9f0806c am: 452aed7c25 am: 6bc0f4d05c

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767430

Change-Id: Ia63b176389abad7aff716ab9fa91eef71bf133bd

####END####
####START####6bc0f4d05c4b
Merge "Add doc explaining PAC proxies are not supported over VPNs" am: 2f3d6bc593 am: 75e9f0806c am: 452aed7c25

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767430

Change-Id: Ie9d3de762f58f6530be2da05bacc47e47509696f

####END####
####START####452aed7c2592
Merge "Add doc explaining PAC proxies are not supported over VPNs" am: 2f3d6bc593 am: 75e9f0806c

Original change: https://android-review.googlesource.com/c/platform/frameworks/base/+/1767430

Change-Id: Ia763ff8a6ddcbaf86f0dc8220a75819bb2e44858

####END####
####START####ada2fb4ec394
Merge "(Take two) Do not hold lock when calling into NotificationManager" into sc-dev am: ac77fab34c am: b4dbaaf200

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284691

Change-Id: I422795b6a13ac5c5f7d224cd39f434e52bd1463a

####END####
####START####d535d161cc97
Merge "Cache nextPageTokens that a package can use." into sc-dev am: 46db5f1018 am: a29ee04f0f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15190794

Change-Id: I29279df92746bf4cb5631c1759ead5d777373c17

####END####
####START####2fae29528444
Merge "(Take two) Do not hold lock when calling into NotificationManager" into sc-dev am: ac77fab34c am: 77da486513

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284691

Change-Id: I26870595a0e301f762db8f188c9804ff0cb7be33

####END####
####START####e22deee6b21c
Merge "Make system bars appearence logic more generic (3/N)" into sc-v2-dev am: f335f84742 am: 327d3b256a

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14909653

Change-Id: I14876503de79d068d027762165ddb864f8749951

####END####
####START####cb90ace87337
Merge "Migrate rotation animation to shell transition" into sc-v2-dev am: f6b894be70 am: 83f271c548

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15020159

Change-Id: Id14d5445d89c9c30b8657f521347ea9696b60afc

####END####
####START####b4dbaaf20087
Merge "(Take two) Do not hold lock when calling into NotificationManager" into sc-dev am: ac77fab34c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284691

Change-Id: I9bb973c4e94ed7465e7bef459b122b49c2022c4e

####END####
####START####ac77fab34c13
Merge "(Take two) Do not hold lock when calling into NotificationManager" into sc-dev
####END####
####START####5f5112ec2996
Merge "Cache nextPageTokens that a package can use." into sc-dev am: 46db5f1018 am: 88149768d6

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15190794

Change-Id: Ia92c43b25e3bab94b7130720ddc327292c7014c6

####END####
####START####327d3b256a11
Merge "Make system bars appearence logic more generic (3/N)" into sc-v2-dev am: f335f84742

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/14909653

Change-Id: I4b88ade18bf2b06cdb4cc91c6590b40823ee6eb4

####END####
####START####aa2aa62e1530
Merge changes I6f314a65,I8020f029 into sc-dev am: e5c0de0d2e am: 95880e65b1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285881

Change-Id: Ic911638f540b0ac618624c3b2d106bd7f06ad11d

####END####
####START####a29ee04f0f39
Merge "Cache nextPageTokens that a package can use." into sc-dev am: 46db5f1018

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15190794

Change-Id: I0ba1ec3bbb5f806ba82f6b85a2c0d5060310bcbc

####END####
####START####0627a1ddc9ee
Merge "Merge "Fix main stage full screen after lock phone" into sc-v2-dev am: a15c1717b5 am: 3d4b9a863e"
####END####
####START####83f271c548a9
Merge "Migrate rotation animation to shell transition" into sc-v2-dev am: f6b894be70

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15020159

Change-Id: Id8d93c1512db3939abd655bd915b8ca85194465d

####END####
####START####90290d144606
Merge "Fix main stage full screen after lock phone" into sc-v2-dev am: a15c1717b5 am: 3d4b9a863e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283491

Change-Id: Id4475a71d36508d6a4321f1506dd2e599a906682

####END####
####START####745050ad1161
Merge "Don't allow PI crashes on unknown sender types" into sc-dev am: e0c972a2be am: c1f25be116

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245014

Change-Id: Ic000dd83985f4a49013bcab56badacbe429b2395

####END####
####START####3316a2e0da80
Animate in a background for kg unlock icon am: 09923d5eca am: 07478ee95e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289155

Change-Id: Ib4bde3f9c304ae706e6efbe4c8fc4940d79830df

####END####
####START####12b651b469d7
Remove dependency on WindowManager-Shell in the animation lib

Bug: 193569148
Test: atest ActivityLaunchAnimatorTest
Change-Id: I40d9546d14085a2ba3fe6e4ee559e43e463ce08a

####END####
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java

####START####f335f847421d
Merge "Make system bars appearence logic more generic (3/N)" into sc-v2-dev
####END####
####START####bc02830a5931
Clear binder calling identity before calling callback

This change clears calling identities before the
onSubscriptionsChangedListener.onSubscriptionsChanged() callback is
made.

Bug: 193731920
Test: atest TelephonyRegistryManagerTest
Change-Id: I21f14e40a05f76346eb90b8f36608b4d6bdf1a29

####END####
core/java/android/telephony/TelephonyRegistryManager.java

####START####b10b79c6c347
Merge "[Provider Model] Remove the flag of ProviderModel in InternetTile"
####END####
####START####7438a806cff1
Merge changes I6f314a65,I8020f029 into sc-dev am: e5c0de0d2e am: 8b1fb4d93c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285881

Change-Id: I8782a78704f76a510d80412f3c05a8e5f39f0383

####END####
####START####f134c60f312f
Merge "Don't allow PI crashes on unknown sender types" into sc-dev am: e0c972a2be am: bef403f5b9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245014

Change-Id: I92b06b98eabe6f7d201210b452a72bf3e229d518

####END####
####START####262ee3610a07
Animate in a background for kg unlock icon am: 09923d5eca am: 3f8b28f9f0

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289155

Change-Id: I07de3be15bab621005c200b537c44f646560fb35

####END####
####START####06513a360a19
Merge "PIN unlock buttons - contrast issue" into sc-dev am: 4bdb302f09 am: e81a5ac16c

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286561

Change-Id: I106da356d486c65190287044991521f4e3ccd516

####END####
####START####99217d0782b5
Merge "Root UID can synthesize AttributionSource values." into sc-dev am: 9d0ddef67b am: 5d6be79488

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285879

Change-Id: If7f3dec682900d65962238eb2688593e760a5b7d

####END####
####START####c21ca37fab14
Merge "Add SafetyNet logging if a certain broadcast is received by apps." into sc-dev am: 0fd8262e2e am: 6df07a5193

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15129351

Change-Id: I029916d8a3a2270b057450ecf587cadab98d22ef

####END####
####START####06d5160162e8
Merge changes I5d467e8e,I5795f5ad into sc-dev am: e684a19bbb am: f0d6a83ce1

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284263

Change-Id: Ifebc0e3c5f49bde62b7f2ce1e70204bbbadc0799

####END####
####START####051338372a8e
Merge "Separating alarm history for lower quota" into sc-dev am: 977e2adc14 am: a0c063e050

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15264659

Change-Id: I71cb58609eee32c7b7b948c197d042ef36b56692

####END####
####START####aa47b72f36f0
Merge "Add additional clarification regarding nanoapp loading APIs" into sc-dev am: 65731d06ce am: f7eaea5a90

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286092

Change-Id: Ic422dea3b530459a54e6dba3749449cb2bd47823

####END####
####START####a6d5c2b66c51
Merge "Set wallet lockscreen icon tint with text primary color." into sc-dev am: 528aa5fec8 am: 90059200e9

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15274502

Change-Id: I65580ea88e09db7dadb776f9bc985a987135426c

####END####
####START####c7081deb510d
Merge "Fix log spam that got in here somehow." into sc-dev am: 75c9ab5778 am: 1c7a507a47

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285499

Change-Id: Ibf3be9029e8a746a2bc32b8510d2102b330c4e78

####END####
####START####917f69e7795e
Merge "Enable latency metrics"
####END####
####START####d00eea138450
Merge "resolve merge conflicts of c817fdc0e65b865a19a6fb4ff4b2c1cec48d24a6 to sc-v2-dev-plus-aosp" into sc-v2-dev-plus-aosp
####END####
####START####f6b894be70da
Merge "Migrate rotation animation to shell transition" into sc-v2-dev
####END####
####START####da436d4a012f
Clean up previous DA organizer when registering

- There is no guarantee that binderDied() will come in for the old
  process before it tries to re-register. Instead, force clean up
  the existing organizer if another organizer is registered for the
  same feature
- Also unlink the death recipient when unregistering/cleaning up the
  organizer

Bug: 190786551
Test: Kill SysUI and ensure it doesn't throw
Change-Id: I1334076cd385955fac7f518356a9703d1544c9bd

####END####
services/core/java/com/android/server/wm/DisplayAreaOrganizerController.java
services/tests/wmtests/src/com/android/server/wm/DisplayAreaTest.java

####START####5558cb1cc931
Tuner APIs: add locks to avoid crashes caused by NPE

Bug: 193604292
Test: atest android.media.tv.tuner.cts.TunerTest
Change-Id: I08aaf38489ab7ea29f99e416b0e1082a3d0ee249

####END####
media/java/android/media/tv/tuner/Lnb.java
media/java/android/media/tv/tuner/Tuner.java
media/java/android/media/tv/tuner/dvr/DvrPlayback.java
media/java/android/media/tv/tuner/dvr/DvrRecorder.java
media/java/android/media/tv/tuner/filter/Filter.java

####START####3eac2ebe4dca
Add doc explaining PAC proxies are not supported over VPNs

Test: Comment-only change
Bug: 181600172
Change-Id: I3049fa7eafed04858711f8dee0c11dd4656f9106

####END####
core/java/android/net/VpnService.java

####START####46db5f101818
Merge "Cache nextPageTokens that a package can use." into sc-dev
####END####
####START####e301bc3d78c3
Merge "Enable ANGLE as a Game Dashboard Intervention"
####END####
####START####1619bf2aeeae
resolve merge conflicts of c817fdc0e65b865a19a6fb4ff4b2c1cec48d24a6 to sc-v2-dev-plus-aosp

Change-Id: Ie77e99b61d2194177446e144ec523c9d7a82b632
Merged-In: Ibac2282d5c9242ae063adb2247d4297291fa3abf

####END####
####START####3d4b9a863e95
Merge "Fix main stage full screen after lock phone" into sc-v2-dev am: a15c1717b5

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15283491

Change-Id: If638998965e9e712b4636f975d869e69cbe376b8

####END####
####START####8b1fb4d93c3b
Merge changes I6f314a65,I8020f029 into sc-dev am: e5c0de0d2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285881

Change-Id: I2abd391e20572d749e23fa6a98ea38bf59c2bb5c

####END####
####START####bef403f5b9ba
Merge "Don't allow PI crashes on unknown sender types" into sc-dev am: e0c972a2be

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15245014

Change-Id: Iee98ce7d29eba4ae3c484a5d14297522b11db103

####END####
####START####3f8b28f9f0a0
Animate in a background for kg unlock icon am: 09923d5eca

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15289155

Change-Id: Ie48bca757dabd2c84ba05b892afa24d777a120be

####END####
####START####e5c0de0d2e4a
Merge changes I6f314a65,I8020f029 into sc-dev

* changes:
  Properly fix allowlisting restricted permissions for secondary users on app upgrade.
  Revert "Fix allowlisting restricted permissions for secondary users on app"

####END####
####START####e0c972a2be74
Merge "Don't allow PI crashes on unknown sender types" into sc-dev
####END####
####START####b9559a6f8057
Migrate rotation animation to shell transition

Migrate rotation animation in wm core to wm shell and used in
shell transition.

Bug: 190002115
Test: manual rotation the device
Change-Id: Ib3404eeb7ac647774ea3be2707c9515371ab0976

####END####
core/java/android/window/TransitionInfo.java
libs/WindowManager/Shell/src/com/android/wm/shell/transition/DefaultTransitionHandler.java
libs/WindowManager/Shell/src/com/android/wm/shell/transition/ScreenRotationAnimation.java
services/core/java/com/android/server/wm/Transition.java

####START####f20599b631f2
Show Task Surface if it will not be organized

When trying to start an Activity in a new Task in an organzied
TaskFragment, the Task is first created in TaskDisplayArea as a root
Task, and then got reparented to the TaskFragment. As a result,
Task#showSurfaceOnCreation() will return false, and there will not be
other call to show its surface.

Now, we show the Task surface if it can no longer be organized.

Fix: 193681081
Test: manually test following the reproduce steps with sample app
Change-Id: Ie3da5f1c789d25bcb828b3f1191867a346a508e8

####END####
services/core/java/com/android/server/wm/Task.java

####START####a15c1717b5b9
Merge "Fix main stage full screen after lock phone" into sc-v2-dev
####END####
####START####16eafe2624e0
Merge "Avoid redundant InputConnection#reportFullscreenMode() callback"
####END####
####START####556f54c7e4ee
Merge "PIN unlock buttons - contrast issue" into sc-dev am: 4bdb302f09 am: eb6cfc1b15

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286561

Change-Id: Idadcc48e9755df48e983523e239d74d1e44660c0

####END####
####START####09923d5eca02
Animate in a background for kg unlock icon

- to indicate it is tappable
- update background drawable on color change to update
color

Test: manual
Fixes: 192403524
Change-Id: I34255e3f7cc7b1dfc246c4e2441822129abdf819

####END####
packages/SystemUI/src/com/android/keyguard/LockIconView.java
packages/SystemUI/src/com/android/keyguard/LockIconViewController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsKeyguardView.java

####START####8aa8ef8201e0
Merge "Makes injectLocation a system api to suport car stack mainline updatability."
####END####
####START####b3884d53eb7c
Encapsulate parsing class fields

This hides all fields as private in preparation for exposing as
interfaces for mainline-ability and for automatic getter/setter testing
through kotlin-reflect.

Bug: 178852754

Test: atest com.android.server.pm.test.parsing.parcelling

Change-Id: I8f36898694368ce60b7efd4b099986c0ea29aba0

####END####
core/java/android/content/pm/parsing/PackageInfoWithoutStateUtils.java
core/java/android/content/pm/parsing/ParsingPackageImpl.java
core/java/android/content/pm/parsing/ParsingPackageUtils.java
core/java/android/content/pm/parsing/component/ComponentParseUtils.java
core/java/android/content/pm/parsing/component/ParsedActivity.java
core/java/android/content/pm/parsing/component/ParsedActivityUtils.java
core/java/android/content/pm/parsing/component/ParsedAttribution.java
core/java/android/content/pm/parsing/component/ParsedComponent.java
core/java/android/content/pm/parsing/component/ParsedComponentUtils.java
core/java/android/content/pm/parsing/component/ParsedInstrumentation.java
core/java/android/content/pm/parsing/component/ParsedInstrumentationUtils.java
core/java/android/content/pm/parsing/component/ParsedIntentInfo.java
core/java/android/content/pm/parsing/component/ParsedIntentInfoUtils.java
core/java/android/content/pm/parsing/component/ParsedMainComponent.java
core/java/android/content/pm/parsing/component/ParsedMainComponentUtils.java
core/java/android/content/pm/parsing/component/ParsedPermission.java
core/java/android/content/pm/parsing/component/ParsedPermissionGroup.java
core/java/android/content/pm/parsing/component/ParsedPermissionUtils.java
core/java/android/content/pm/parsing/component/ParsedProcess.java
core/java/android/content/pm/parsing/component/ParsedProcessUtils.java
core/java/android/content/pm/parsing/component/ParsedProvider.java
core/java/android/content/pm/parsing/component/ParsedProviderUtils.java
core/java/android/content/pm/parsing/component/ParsedService.java
core/java/android/content/pm/parsing/component/ParsedServiceUtils.java
core/java/android/content/pm/parsing/component/ParsedUsesPermission.java
services/core/java/com/android/server/appop/AppOpsService.java
services/core/java/com/android/server/pm/PackageManagerService.java
services/core/java/com/android/server/pm/parsing/pkg/PackageImpl.java
services/core/java/com/android/server/pm/parsing/pkg/ParsedPackage.java
services/core/java/com/android/server/pm/permission/PermissionManagerService.java
services/tests/servicestests/src/com/android/server/pm/PackageParserTest.java
services/tests/servicestests/src/com/android/server/pm/ScanTests.java

####START####e81a5ac16c89
Merge "PIN unlock buttons - contrast issue" into sc-dev am: 4bdb302f09

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15286561

Change-Id: Icea4edb04402a7ad0ce8bcbd9449fb946019f757

####END####
####START####955b64a6e71e
Revert "wifidisplay: restrict broadcast by the proper permission"

This reverts commit cff8340c84ad1d6c0b3deae6a42f781e7db64082.

Reason for revert: Remove from July 2021 Android Security Bulletin due to break existing applications.

Bug: 176541017
Change-Id: Iacef744056630e85fb43d838a72abfae331cbaf4
Test: install WFD application and check whether it works normally.

####END####
core/java/android/hardware/display/DisplayManager.java
services/core/java/com/android/server/display/WifiDisplayAdapter.java

####START####4bdb302f096f
Merge "PIN unlock buttons - contrast issue" into sc-dev
####END####
####START####3057504bee36
Merge "Fix letterbox issue when auto-enter-pip from landscape" into sc-dev am: 5a59072018

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15264487

Change-Id: Ibe24016daf3ee670b498a24eb80ae3dc2f1df0b3

####END####
####START####cf0f6809096d
Enable latency metrics

The metrics were disabled in S because the WeakReference bugs could not
be fixed in time.

Enable them in T, which should allow sufficient time for the other teams
to resolve the WeakReference problems.

Bug: 169866723
Test: adb shell dumpsys input, watch for latency tracker starting to
collect data

Change-Id: I67c4028e7cb8b5e26616ab90b8b60fc871bf4407

####END####
core/java/android/view/ViewRootImpl.java

####START####5a5907201851
Merge "Fix letterbox issue when auto-enter-pip from landscape" into sc-dev
####END####
####START####57a8f9431ecc
Merge "Root UID can synthesize AttributionSource values." into sc-dev am: 9d0ddef67b am: e4f4fa91e2

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285879

Change-Id: I967ed6c8b891e0ba03e10f001ef108ced62572b8

####END####
####START####5d6be79488e8
Merge "Root UID can synthesize AttributionSource values." into sc-dev am: 9d0ddef67b

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285879

Change-Id: Id4254922cb486ba49eebe55caa74249583c4d5bd

####END####
####START####9d0ddef67b6b
Merge "Root UID can synthesize AttributionSource values." into sc-dev
####END####
####START####fb134455ce75
Make StatusBar purely optional

To be able to inject Optional.empty() to Optional<StatusBar>, this CL

 - removes raw StatusBar references and replaces it with Optional<StatusBar>
 - replaces Optional<Lazy<StatusBar>> to Lazy<Optional<StatusBar>>

Bug: 144309772
Bug: 138625582
Bug: 187111275
Bug: 187111293
Test: atest SystemUITests
Change-Id: I07b63e417dd4cc75a17951619065ba0f234bc2aa
Merged-In: I07b63e417dd4cc75a17951619065ba0f234bc2aa

####END####
packages/SystemUI/src/com/android/systemui/ActivityStarterDelegate.java
packages/SystemUI/src/com/android/systemui/Dependency.java
packages/SystemUI/src/com/android/systemui/accessibility/SystemActions.java
packages/SystemUI/src/com/android/systemui/assist/PhoneStateMonitor.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsAnimationViewController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsBpViewController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsEnrollViewController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsFpmOtherViewController.java
packages/SystemUI/src/com/android/systemui/biometrics/UdfpsKeyguardViewController.java
packages/SystemUI/src/com/android/systemui/dagger/DependencyProvider.java
packages/SystemUI/src/com/android/systemui/globalactions/GlobalActionsDialog.java
packages/SystemUI/src/com/android/systemui/globalactions/GlobalActionsDialogLite.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBar.java
packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarController.java
packages/SystemUI/src/com/android/systemui/power/PowerUI.java
packages/SystemUI/src/com/android/systemui/recents/OverviewProxyRecentsImpl.java
packages/SystemUI/src/com/android/systemui/recents/OverviewProxyService.java
packages/SystemUI/src/com/android/systemui/recents/ScreenPinningRequest.java
packages/SystemUI/src/com/android/systemui/statusbar/NotificationMediaManager.java
packages/SystemUI/src/com/android/systemui/statusbar/NotificationRemoteInputManager.java
packages/SystemUI/src/com/android/systemui/statusbar/dagger/StatusBarDependenciesModule.java
packages/SystemUI/src/com/android/systemui/statusbar/notification/dagger/NotificationsModule.java
packages/SystemUI/src/com/android/systemui/statusbar/notification/row/NotificationGutsManager.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/CollapsedStatusBarFragment.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/ShadeControllerImpl.java
packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/UdfpsControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/biometrics/UdfpsKeyguardViewControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/globalactions/GlobalActionsDialogLiteTest.java
packages/SystemUI/tests/src/com/android/systemui/globalactions/GlobalActionsDialogTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/navigationbar/NavigationBarTest.java
packages/SystemUI/tests/src/com/android/systemui/power/PowerUITest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/NotificationRemoteInputManagerTest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/SmartReplyControllerTest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/notification/row/NotificationGutsManagerTest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/CollapsedStatusBarFragmentTest.java
packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarTest.java

####START####97a9cc212e1e
Merge "UserController/Manager loglines"
####END####
####START####1da6f0eb4965
Makes injectLocation a system api to suport car stack mainline
updatability.

The detailed reason why we do this is explained in the bug.

Bug: 192377485
Test: build

Change-Id: If5a800257cd3a875de208f8142ef5b4e88a05dbe

####END####
location/java/android/location/LocationManager.java

####START####e1f245bf5484
Merge "Add SafetyNet logging if a certain broadcast is received by apps." into sc-dev am: 0fd8262e2e am: 8c1b823b5e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15129351

Change-Id: Id36facb4b377b2f15b7c145890ccd8d99dee1840

####END####
####START####98e08ee93384
PIN unlock buttons - contrast issue

When the dark theme is adjusted, the correct color was not being
reloaded. Without this fix, the back/enter buttons would not be
discernible.

Fixes: 193043693
Test: manual (toggle dark theme)
Change-Id: Ie41549c6b7d8f49be62ce0fb8e7e3b7399784c44

####END####
packages/SystemUI/src/com/android/keyguard/NumPadButton.java

####START####6df07a51933f
Merge "Add SafetyNet logging if a certain broadcast is received by apps." into sc-dev am: 0fd8262e2e

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15129351

Change-Id: I74b93b7fa91c64ad5417e5fd269df7a0d309586d

####END####
####START####168bd5f3e6da
Merge "Rework thermal throttling."
####END####
####START####0fd8262e2ed5
Merge "Add SafetyNet logging if a certain broadcast is received by apps." into sc-dev
####END####
####START####bf91ebda60d6
(Take two) Do not hold lock when calling into NotificationManager

setNetworkLoggingActiveInternal() is being called at a few places
where lock has already been acquired, so it's not sufficient to
just move around NotificationManager calls within
setNetworkLoggingActiveInternal. Post those calls to a handler
thread as a quick fix for now.

Bug: 192435507
Test: atest DeviceOwnerTest#testAdminActionBookkeeping
Test: atest DeviceOwnerTest#testNetworkLoggingWithSingleUser
Test: atest DeviceOwnerTest#testNetworkLogging_multipleBatches
Test: atest DeviceOwnerTest#testNetworkLoggingWithTwoUsers
Test: atest DeviceOwnerTest#testNetworkLogging_rebootResetsId
Test: atest OrgOwnedProfileOwnerTest#testNetworkLoggingLogged
Test: atest OrgOwnedProfileOwnerTest#testNetworkLoggingDelegate
Test: atest OrgOwnedProfileOwnerTest#testNetworkLogging
Test: atest DeviceOwnerPlusProfileOwnerTest#testNetworkAndSecurityLoggingAvailableIfAffiliated
Test: atest MixedDeviceOwnerTest#testDelegation
Test: CTSVerifier: Device Owner Tests -> Network Logging U
Change-Id: I34d90c933525a9bf31a1ab9a40866006790796ad

####END####
services/devicepolicy/java/com/android/server/devicepolicy/DevicePolicyManagerService.java

####START####84fb4ed5e798
Remove unused portal code

The portal feature is gone, so let's delete the dead code that remains.

Bug: 167946720
Test: m framework
Change-Id: I888fe07bd2987c36c061ef369e82bb6544301ce4

####END####
services/core/java/com/android/server/wm/DisplayContent.java

####START####ecec60e0e119
Add API to get GPU private memory

Remove getGpuDmabufUsageKb since the kernel no longer
supports the sysfs nodes that this depends on.

Add getGpuPrivateMemoryKb which uses the memtrack hal
to report the system-wide GPU private memory.

Bug: 193226716
Bug: 193465681
Bug: 192621117
Test: dumpsys meminfo
Change-Id: Ib90505ec184339d5acbcd42c67dad3ad65dbd933
Merged-In: Ib90505ec184339d5acbcd42c67dad3ad65dbd933

####END####
core/java/android/os/Debug.java
services/core/java/com/android/server/am/ActivityManagerService.java

####START####075de7ea1daa
Ensure notification visibility on stopForeground(false)

If an FGS notification has been deferred but the app needs it to remain
present after the service exits the FGS mode, make sure that it gets
shown.

Bug: 193665032
Test: atest CtsAppTestCases:android.app.cts.ServiceTest#testForegroundService_deferThenKeepNotification
Change-Id: I1e9c5f1b27dd670639bd5e02b7f79839cfb5362e

####END####
services/core/java/com/android/server/am/ActiveServices.java

####START####c6deb0fd9d00
Add API to get GPU private memory

Remove getGpuDmabufUsageKb since the kernel no longer
supports the sysfs nodes that this depends on.

Add getGpuPrivateMemoryKb which uses the memtrack hal
to report the system-wide GPU private memory.

Bug: 193226716
Bug: 193465681
Bug: 192621117
Test: dumpsys meminfo
Change-Id: Ib90505ec184339d5acbcd42c67dad3ad65dbd933

####END####
core/java/android/os/Debug.java
services/core/java/com/android/server/am/ActivityManagerService.java
services/core/java/com/android/server/am/AppProfiler.java
services/core/java/com/android/server/stats/pull/SystemMemoryUtil.java

####START####937ef38cd708
Merge "Fix letterbox issue when auto-enter-pip from landscape" into sc-v2-dev am: 109a5be4e7 am: 45f528ddae

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275746

Change-Id: Idbc7d08d54d0f102bb76032681155aeee729768a

####END####
####START####45f528ddaeca
Merge "Fix letterbox issue when auto-enter-pip from landscape" into sc-v2-dev am: 109a5be4e7

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15275746

Change-Id: I4d86b1588965c99baf00d4f7d6d0066ce7df89f9

####END####
####START####c2a7d6e5c773
Merge "Merge "Interpolate corner to 0 when recording screen" into sc-dev am: e98202ed30 am: 8223a28b3e" into sc-v2-dev am: 9c1015d305 am: d665b68f96

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285270

Change-Id: I83d062269a5639fb5dc6aaaee3f3f2239999e454

####END####
####START####160508ed0a0c
Properly fix allowlisting restricted permissions for secondary users
on app upgrade.

More context is available in the original fix ag/15166603 which is
being reverted due to b/193206356. The root cause of the regression is
that unlike one may assume, we do keep a per-user permission state
even if an app is never installed in that user, however ag/15166603
broken that assumption because it's only initializing the permission
state for the installed users.

We actually never respected whether a package is installed for a user
when checking or mutating a permission state, and networking has kernel
code that relies on the user 0 permission state, so we have to keep the
original behavior at least in S.

So to properly fix the original b/191381905, we should:

1. Still limit the restorePermissionState() call in
setAllowlistedRestrictedPermissionsInternal() to the user that it's
operating upon, so that it's not accidentally calling
restorePermissionState() before the allowlist is set.

2. Make the onPackageInstalled()/onPackageUninstalled() callbacks
called only once so that we do one updatePermissions() for all users
to initialize the permission state for all of them. Actually the
install/uninstall request can only happen for either one user or
USER_ALL, so we can keep the current callback signature and just allow
USER_ALL in addition to normal users.

BYPASS_INCLUSIVE_LANGUAGE_REASON=Touching space around old API names.

Bug: 191381905
Bug: 193206356
Test: atest SplitPermissionTest --user-type secondary_user
Test: atest CtsPermission2TestCases
Test: atest CtsPermission2TestCases --user-type secondary_user
Test: atest CtsPermission3TestCases
Test: atest CtsPermission3TestCases --user-type secondary_user
Test: atest MixedManagedProfileOwnerTest#testAlwaysOnVpn
Change-Id: I6f314a65247c35f86ea4b8e8bf9f458c1332e29c

####END####
services/core/java/com/android/server/pm/PackageManagerService.java
services/core/java/com/android/server/pm/permission/PermissionManagerService.java

####START####109a5be4e74f
Merge "Fix letterbox issue when auto-enter-pip from landscape" into sc-v2-dev
####END####
####START####d665b68f9680
Merge "Merge "Interpolate corner to 0 when recording screen" into sc-dev am: e98202ed30 am: 8223a28b3e" into sc-v2-dev am: 9c1015d305

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15285270

Change-Id: I2c81f15f1bf1970c26f0dc239dc63e04221e149a

####END####
####START####6b48911f530c
Rework thermal throttling.

1. Stop limiting thermal restriction to only connectivity jobs
2. Throttle all non-EJ background jobs when the status is SEVERE
3. Throttle all bg jobs (including EJ) when the status is CRITICAL

Bug: 193269111
Test: atest frameworks/base/services/tests/mockingservicestests/src/com/android/server/job
Test: atest frameworks/base/services/tests/servicestests/src/com/android/server/job
Test: atest CtsJobSchedulerTestCases
Change-Id: I306a199e2ec6441075c69858000c28f8266eefad

####END####
apex/jobscheduler/service/java/com/android/server/job/restrictions/JobRestriction.java
apex/jobscheduler/service/java/com/android/server/job/restrictions/ThermalStatusRestriction.java

####START####e38dffebbd14
Revert "Fix allowlisting restricted permissions for secondary users on app"

This reverts commit 49e179cb7f983cae566d35e15e10ca9de0085c44.

Reason for revert: b/193206356

Bug: 193206356
Change-Id: I8020f0292c1a867ad53278f73296ac2aaef974bd

####END####
services/core/java/com/android/server/pm/permission/PermissionManagerService.java

####START####98ca834f31a6
Merge changes I5d467e8e,I5795f5ad into sc-dev am: e684a19bbb am: 42c20d997f

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284263

Change-Id: I965319075cad5c7234fa9499fb4ab28bdf5df0e2

####END####
####START####c0b1a5b3daa6
TouchExplorer: log malformed events instead of crashing.

Bug: 193092818
Test: atest GestureManifoldTest TouchExplorerTest AccessibilityGestureDetectorTest
Change-Id: I5aee4e253479b7d3b2cbdc573b335c6edf389eb9

####END####
services/accessibility/java/com/android/server/accessibility/gestures/TouchExplorer.java

####START####971cd16e747f
Merge "Separating alarm history for lower quota" into sc-dev am: 977e2adc14 am: 7c426b22ef

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15264659

Change-Id: I4608ecde8fc317e5dd2772bc7925dea2b7fd8b8b

####END####
####START####9c1015d305bd
Merge "Merge "Interpolate corner to 0 when recording screen" into sc-dev am: e98202ed30 am: 8223a28b3e" into sc-v2-dev
####END####
####START####38ffbde17ee7
Root UID can synthesize AttributionSource values.

We trust any incoming value from the system UID, so we should also
trust values coming from the root UID, which includes many shell
commands such as "svc".

Bug: 193659633
Test: atest BluetoothInstrumentationTests:com.android.bluetooth.btservice.AdapterServiceTest --rerun-until-failure 100
Change-Id: Ied07731345f08fc3c4df465a3773e35c8df7c59a

####END####
core/java/android/content/AttributionSource.java

####START####f0d6a83ce1a6
Merge changes I5d467e8e,I5795f5ad into sc-dev am: e684a19bbb

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15284263

Change-Id: Iaa891545035e8be0be12e1487b510d5f6d2c1480

####END####
####START####a0c063e050b7
Merge "Separating alarm history for lower quota" into sc-dev am: 977e2adc14

Original change: https://googleplex-android-review.googlesource.com/c/platform/frameworks/base/+/15264659

Change-Id: Id477baaa0b8df977b61a6db98afe4f9301581092

####END####